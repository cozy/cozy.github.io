



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cozy documentation">
      
      
        <link rel="canonical" href="https://docs.cozy.io/tutorials/konnector/">
      
      
        <meta name="author" content="CozyCloud - https://cozy.io">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[^a-zа-яё0-9\-\.]">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>How to write a connector</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    <script type="text/javascript">
        // Used in extra.js, we have to define the variable here since
        // we need access to the "config" jinja variable
        window.outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
    </script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Ubuntu+Mono&display=fallback">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Cozy Developer Documentation
            </span>
            <span class="md-header-nav__topic">
              
                How to write a connector
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cozy/cozy.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Cozy Developer Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cozy/cozy.github.io/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../app/" title="Create Your Application" class="md-nav__link">
      Create Your Application
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Develop a Connector
      </label>
    
    <a href="./" title="Develop a Connector" class="md-nav__link md-nav__link--active">
      Develop a Connector
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-it-work" title="How does it work?" class="md-nav__link">
    How does it work?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-create-our-first-connector" title="Let’s create our first connector" class="md-nav__link">
    Let’s create our first connector
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-the-sample" title="Run the sample" class="md-nav__link">
    Run the sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-your-connector" title="Implement your connector" class="md-nav__link">
    Implement your connector
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-data" title="Request data" class="md-nav__link">
    Request data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse-the-document" title="Parse the document" class="md-nav__link">
    Parse the document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-data-to-cozy-stack" title="Save data to Cozy Stack" class="md-nav__link">
    Save data to Cozy Stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#going-further" title="Going further" class="md-nav__link">
    Going further
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connector-structure" title="Connector structure" class="md-nav__link">
    Connector structure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-workflow" title="Typical workflow" class="md-nav__link">
    Typical workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" title="Error handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cozy-konnector-libs" title="cozy-konnector-libs" class="md-nav__link">
    cozy-konnector-libs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-your-connector-to-a-cozy-dev-mode" title="Linking your connector to a cozy : dev mode" class="md-nav__link">
    Linking your connector to a cozy : dev mode
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-manifest" title="The manifest" class="md-nav__link">
    The manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#konnector-dev-configjson" title="konnector-dev-config.json" class="md-nav__link">
    konnector-dev-config.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-dev-mode" title="Run the dev mode" class="md-nav__link">
    Run the dev mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-in-the-store-for-all-the-users" title="Integration in the store for all the users" class="md-nav__link">
    Integration in the store for all the users
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#icon" title="Icon" class="md-nav__link">
    Icon
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packagejson" title="Package.json" class="md-nav__link">
    Package.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifestkonnector" title="Manifest.konnector" class="md-nav__link">
    Manifest.konnector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" title="FAQ" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-i-run-my-connector-a-ghost-node-process-eats-all-my-memory" title="When I run my connector, a ghost node process eats all my memory" class="md-nav__link">
    When I run my connector, a ghost node process eats all my memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-scrap-a-website" title="How do I scrap a website" class="md-nav__link">
    How do I scrap a website
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-does-the-yarn-deploy-command-do" title="What does the yarn deploy command do ?" class="md-nav__link">
    What does the yarn deploy command do ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-want-to-pass-secret-variables-to-my-connector-without-hardcoding-it-in-the-source-code" title="I want to pass secret variables to my connector without hardcoding it in the source code" class="md-nav__link">
    I want to pass secret variables to my connector without hardcoding it in the source code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../selfhost-debian/" title="Self-Host on Debian" class="md-nav__link">
      Self-Host on Debian
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How-to
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How-to
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Dev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Dev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/runCozyDocker/" title="Run an App in a Cozy using Docker" class="md-nav__link">
      Run an App in a Cozy using Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/hmr/" title="Use Hot Module Replacement in Your App" class="md-nav__link">
      Use Hot Module Replacement in Your App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/cordova/" title="Make a Mobile App Using Cordova" class="md-nav__link">
      Make a Mobile App Using Cordova
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/connect-mobile-app-local-stack/" title="Connect a Mobile App to Your Local Stack" class="md-nav__link">
      Connect a Mobile App to Your Local Stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/sendmail/" title="Send and Receive E-mails in Development" class="md-nav__link">
      Send and Receive E-mails in Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../references/git-flow/" title="Our Front-End Git Flow" class="md-nav__link">
      Our Front-End Git Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../references/tech-intro/" title="Technical introduction to the Cozy platform" class="md-nav__link">
      Technical introduction to the Cozy platform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Synchronize
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Synchronize
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/sync/linux/" title="Install Cozy Drive on GNU/Linux" class="md-nav__link">
      Install Cozy Drive on GNU/Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Libraries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Libraries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Develop an application
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Develop an application
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-1" type="checkbox" id="nav-4-1-1">
    
    <label class="md-nav__link" for="nav-4-1-1">
      Define data (doctypes)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-1">
        Define data (doctypes)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/" title="Accounts" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.apps/" title="Apps" class="md-nav__link">
      Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.bank/" title="Banking doctypes" class="md-nav__link">
      Banking doctypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.bills/" title="Bills" class="md-nav__link">
      Bills
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/" title="Connectors" class="md-nav__link">
      Connectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/" title="Contacts" class="md-nav__link">
      Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.files/" title="Files" class="md-nav__link">
      Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.files_metadata/" title="Files metadata" class="md-nav__link">
      Files metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.identities/" title="Identities" class="md-nav__link">
      Identities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/" title="Notifications" class="md-nav__link">
      Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/" title="Remote requests" class="md-nav__link">
      Remote requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/" title="Session logins" class="md-nav__link">
      Session logins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/" title="Photos Albums" class="md-nav__link">
      Photos Albums
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.procedures/" title="Procedures" class="md-nav__link">
      Procedures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/" title="Sessions Logins" class="md-nav__link">
      Sessions Logins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/" title="Sharings" class="md-nav__link">
      Sharings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.account_types/" title="Accounts Types" class="md-nav__link">
      Accounts Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/cc.cozycloud.autocategorization/" title="Autocategorization" class="md-nav__link">
      Autocategorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.exports/" title="Exports" class="md-nav__link">
      Exports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.oauth.clients/" title="OAuth Clients" class="md-nav__link">
      OAuth Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.oauth.access_codes/" title="OAuth Access Codes" class="md-nav__link">
      OAuth Access Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/" title="Triggers" class="md-nav__link">
      Triggers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.triggers.state/" title="Triggers state" class="md-nav__link">
      Triggers state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/" title="Remote requests" class="md-nav__link">
      Remote requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sessions/" title="Sessions" class="md-nav__link">
      Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.shared/" title="Shared" class="md-nav__link">
      Shared
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.terms/" title="Terms" class="md-nav__link">
      Terms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/com.unibet.bets/" title="Bets Unibet" class="md-nav__link">
      Bets Unibet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-2" type="checkbox" id="nav-4-1-2">
    
    <label class="md-nav__link" for="nav-4-1-2">
      Access data (client)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-2">
        Access data (client)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/relationships/" title="Using relationships" class="md-nav__link">
      Using relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/metadata/" title="cozyMetadata maintenance" class="md-nav__link">
      cozyMetadata maintenance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/react-integration/" title="React integration" class="md-nav__link">
      React integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/details/" title="Other details" class="md-nav__link">
      Other details
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/api/cozy-client/" title="Cozy Client API" class="md-nav__link">
      Cozy Client API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/api/cozy-pouch-link/" title="Cozy Pouch Link API" class="md-nav__link">
      Cozy Pouch Link API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/api/cozy-stack-client/" title="Cozy Stack Client API" class="md-nav__link">
      Cozy Stack Client API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-ui/" title="Build a UI (ui)" class="md-nav__link">
      Build a UI (ui)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-4" type="checkbox" id="nav-4-1-4">
    
    <label class="md-nav__link" for="nav-4-1-4">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-4">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-realtime/" title="Realtime data (realtime)" class="md-nav__link">
      Realtime data (realtime)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-device-helper/" title="Native devices (device-helper)" class="md-nav__link">
      Native devices (device-helper)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Develop a konnector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Develop a konnector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2-1" type="checkbox" id="nav-4-2-1">
    
    <label class="md-nav__link" for="nav-4-2-1">
      Scrape data (konnector-libs)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-2-1">
        Scrape data (konnector-libs)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/dev/" title="Develop" class="md-nav__link">
      Develop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/operation-linking/" title="Operation linking" class="md-nav__link">
      Operation linking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/synchronization/" title="Synchronization" class="md-nav__link">
      Synchronization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konitor/cli/" title="konitor" class="md-nav__link">
      konitor
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-app-publish/" title="Publish on the store (app-publish)" class="md-nav__link">
      Publish on the store (app-publish)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Dev tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Dev tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../babel-preset-cozy-app/" title="Babel preset" class="md-nav__link">
      Babel preset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../commitlint-config-cozy/" title="Commitlint" class="md-nav__link">
      Commitlint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../eslint-config-cozy-app/" title="ESLint" class="md-nav__link">
      ESLint
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5-1" type="checkbox" id="nav-4-5-1">
    
    <label class="md-nav__link" for="nav-4-5-1">
      Stack server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-5-1">
        Stack server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5-1-2" type="checkbox" id="nav-4-5-1-2">
    
    <label class="md-nav__link" for="nav-4-5-1-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-5-1-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/INSTALL/" title="Install the cozy-stack" class="md-nav__link">
      Install the cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/config/" title="Configuration file" class="md-nav__link">
      Configuration file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/instance/" title="Managing Instances" class="md-nav__link">
      Managing Instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/cli/cozy-stack/" title="Manpages of the command-line tool" class="md-nav__link">
      Manpages of the command-line tool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5-1-3" type="checkbox" id="nav-4-5-1-3">
    
    <label class="md-nav__link" for="nav-4-5-1-3">
      How-to guides for developpers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-5-1-3">
        How-to guides for developpers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/client-app-dev/" title="Develop a client-side app" class="md-nav__link">
      Develop a client-side app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/docker/" title="Running and building Docker images" class="md-nav__link">
      Running and building Docker images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/doctype/" title="Adding a new doctype" class="md-nav__link">
      Adding a new doctype
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/assets/" title="Working with the stack assets" class="md-nav__link">
      Working with the stack assets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/release/" title="Build a release" class="md-nav__link">
      Build a release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/CONTRIBUTING/" title="The contributing guide" class="md-nav__link">
      The contributing guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5-1-4" type="checkbox" id="nav-4-5-1-4">
    
    <label class="md-nav__link" for="nav-4-5-1-4">
      Explanations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-5-1-4">
        Explanations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/sharing-design/" title="Sharing design" class="md-nav__link">
      Sharing design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/konnectors-workflow/" title="Workflow of the konnectors" class="md-nav__link">
      Workflow of the konnectors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5-1-5" type="checkbox" id="nav-4-5-1-5">
    
    <label class="md-nav__link" for="nav-4-5-1-5">
      List of services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-5-1-5">
        List of services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/auth/" title="/auth - Authentication & OAuth" class="md-nav__link">
      /auth - Authentication & OAuth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/apps/" title="/apps - Applications Management" class="md-nav__link">
      /apps - Applications Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/registry/" title="/apps - Apps registry" class="md-nav__link">
       /apps - Apps registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/konnectors/" title="/apps - Konnectors" class="md-nav__link">
       /apps - Konnectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/data-system/" title="/data - Data System" class="md-nav__link">
      /data - Data System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/mango/" title="/data - Mango" class="md-nav__link">
       /data - Mango
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/couchdb-quirks/" title="/data - CouchDB Quirks" class="md-nav__link">
       /data - CouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/pouchdb-quirks/" title="/data - PouchDB Quirks" class="md-nav__link">
       /data - PouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/files/" title="/files - Virtual File System" class="md-nav__link">
      /files - Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/references-docs-in-vfs/" title="/files - References of documents in VFS" class="md-nav__link">
       /files - References of documents in VFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/intents/" title="/intents - Intents" class="md-nav__link">
      /intents - Intents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/jobs/" title="/jobs - Jobs" class="md-nav__link">
      /jobs - Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/workers/" title="/jobs - Workers" class="md-nav__link">
       /jobs - Workers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/move/" title="/move - Move, export and import an instance" class="md-nav__link">
      /move - Move, export and import an instance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/notifications/" title="/notifications - Notifications" class="md-nav__link">
      /notifications - Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/public/" title="/public - Public" class="md-nav__link">
      /public - Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/permissions/" title="/permissions - Permissions" class="md-nav__link">
      /permissions - Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/realtime/" title="/realtime - Realtime" class="md-nav__link">
      /realtime - Realtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/remote/" title="/remote - Proxy for remote data/API" class="md-nav__link">
      /remote - Proxy for remote data/API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/settings/" title="/settings - Settings" class="md-nav__link">
      /settings - Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/user-action-required/" title="/settings - Terms of Services" class="md-nav__link">
       /settings - Terms of Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-stack/sharing/" title="/sharings - Sharing" class="md-nav__link">
      /sharings - Sharing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-apps-registry/" title="Registry server" class="md-nav__link">
      Registry server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-it-work" title="How does it work?" class="md-nav__link">
    How does it work?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-create-our-first-connector" title="Let’s create our first connector" class="md-nav__link">
    Let’s create our first connector
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-the-sample" title="Run the sample" class="md-nav__link">
    Run the sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-your-connector" title="Implement your connector" class="md-nav__link">
    Implement your connector
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-data" title="Request data" class="md-nav__link">
    Request data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse-the-document" title="Parse the document" class="md-nav__link">
    Parse the document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-data-to-cozy-stack" title="Save data to Cozy Stack" class="md-nav__link">
    Save data to Cozy Stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#going-further" title="Going further" class="md-nav__link">
    Going further
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connector-structure" title="Connector structure" class="md-nav__link">
    Connector structure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-workflow" title="Typical workflow" class="md-nav__link">
    Typical workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" title="Error handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cozy-konnector-libs" title="cozy-konnector-libs" class="md-nav__link">
    cozy-konnector-libs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-your-connector-to-a-cozy-dev-mode" title="Linking your connector to a cozy : dev mode" class="md-nav__link">
    Linking your connector to a cozy : dev mode
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-manifest" title="The manifest" class="md-nav__link">
    The manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#konnector-dev-configjson" title="konnector-dev-config.json" class="md-nav__link">
    konnector-dev-config.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-dev-mode" title="Run the dev mode" class="md-nav__link">
    Run the dev mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-in-the-store-for-all-the-users" title="Integration in the store for all the users" class="md-nav__link">
    Integration in the store for all the users
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#icon" title="Icon" class="md-nav__link">
    Icon
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packagejson" title="Package.json" class="md-nav__link">
    Package.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifestkonnector" title="Manifest.konnector" class="md-nav__link">
    Manifest.konnector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" title="FAQ" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-i-run-my-connector-a-ghost-node-process-eats-all-my-memory" title="When I run my connector, a ghost node process eats all my memory" class="md-nav__link">
    When I run my connector, a ghost node process eats all my memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-scrap-a-website" title="How do I scrap a website" class="md-nav__link">
    How do I scrap a website
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-does-the-yarn-deploy-command-do" title="What does the yarn deploy command do ?" class="md-nav__link">
    What does the yarn deploy command do ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-want-to-pass-secret-variables-to-my-connector-without-hardcoding-it-in-the-source-code" title="I want to pass secret variables to my connector without hardcoding it in the source code" class="md-nav__link">
    I want to pass secret variables to my connector without hardcoding it in the source code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cozy/cozy.github.io/edit/dev/src/tutorials/konnector.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Develop a Connector</h1>
                
                <h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>A connector (also known as <em>konnector</em>) is a script that imports data from another web service and put those data into your cozy.
Each connector is an independent application, managed by the <a href="https://github.com/cozy/cozy-home">Cozy Home</a> application.</p>
<p>To protect your data, each connector runs inside a container in order to sandbox all their interactions with your data.</p>
<blockquote>
<p>⚠️ For historical reasons, in the Cozy codebase, a cozy connector is named konnector, please follow this convention if modifying an existing application.</p>
</blockquote>
<h2 id="how-does-it-work">How does it work?<a class="headerlink" href="#how-does-it-work" title="Permanent link">&para;</a></h2>
<p>A connector is a NodeJS script.
The target node version used to run your connector is the version 8.</p>
<p>Like client side apps, connectors communicate with the <a href="https://docs.cozy.io/en/cozy-stack/README/">Cozy Stack</a> using its HTTP API, and get a unique auth token every time they start.
They need to register with a manifest, and ask the user for permissions.</p>
<p>To facilitate connector development, a npm package, <a href="https://github.com/konnectors/libs">cozy-konnector-libs</a>, provides some shared libraries that are adapted to be used for a connector:</p>
<ul>
<li><a href="https://cheerio.js.org">cheerio</a> to easily query a HTML page</li>
<li><a href="https://github.com/request/request-promise">request-promise</a>: <a href="https://github.com/request/request">request</a> with Promise support</li>
<li><a href="https://github.com/request/request-debug">request-debug</a> that displays all the requests and responses in the standard output.
   Toggle <em>debug</em> option in <a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md#module_requestFactory">requestFactory options</a></li>
</ul>
<p>Besides, you&rsquo;ll probably need some other npm packages to help you run your connector:</p>
<ul>
<li><a href="http://momentjs.com/docs/">momentjs</a> or <a href="https://date-fns.org">date-fns</a> to manage dates</li>
<li><a href="http://bluebirdjs.com">bluebird</a> to get enhanced promises</li>
</ul>
<p>When the connector is started, it also receives some data via environment variables:</p>
<ul>
<li><code>COZY_CREDENTIALS</code>: an auth token used by <a href="https://github.com/cozy/cozy-client-js/">cozy-client-js</a> to communicate with the server</li>
<li><code>COZY_URL</code>: the Cozy Stack API entry point</li>
<li><code>COZY_FIELDS</code>: settings coming from <a href="https://github.com/cozy/cozy-home">Cozy Home</a> and filled by the user (login, password, directory path).</li>
</ul>
<p>These variables are used by the connector and the cozy-client to configure the connection to the <a href="https://docs.cozy.io/en/cozy-stack/README/">Cozy Stack</a> with the right permissions as defined in the connector manifest.
They are simulated in standalone mode so that you do not need a real Cozy Stack to develop a connector.
[<a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#basekonnector">More about BaseKonnector</a>]</p>
<p>From the server point of view, each connector is a <code>job</code> which is executed periodically via a <code>trigger</code>.
[<a href="https://docs.cozy.io/en/cozy-stack/jobs/">More about Cozy Stack jobs</a>]</p>
<h2 id="lets-create-our-first-connector">Let’s create our first connector<a class="headerlink" href="#lets-create-our-first-connector" title="Permanent link">&para;</a></h2>
<p>The easiest way to create a new connector is to use <a href="https://github.com/konnectors/cozy-konnector-template">cozy-konnector-template</a>:</p>
<p>ℹ There is also a <a href="https://www.youtube.com/watch?v=gp0cE8kHEBc&amp;list=PLBgB0F1WGyOXMqKZe-Q1ql0Fz-ohPkq6-">(french) youtube video to create your first connector</a></p>
<h3 id="run-the-sample">Run the sample<a class="headerlink" href="#run-the-sample" title="Permanent link">&para;</a></h3>
<p>First of all, <a href="https://github.com/konnectors/cozy-konnector-template/archive/master.zip">download</a> or clone the repository:</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/konnectors/cozy-konnector-template cozy-konnector-newservice
<span class="nb">cd</span> cozy-konnector-newservice
rm -rf .git
git init
yarn install <span class="c1"># or npm install</span>
</pre></div>


<p><em>note: we use <code>yarn</code>, but if you prefer <code>npm</code>, keep using it, everything should work.</em></p>
<p>The connector is ready to run with sample code.
As a demo we will scrape a fictional website: <a href="http://books.toscrape.com">books.toscrape.com</a>, for which <strong>you do not need credentials</strong>.</p>
<p>As indicated in the <code>README.md</code> file, just run:</p>
<div class="codehilite"><pre><span></span>yarn standalone <span class="c1"># or npm run standalone</span>
</pre></div>


<p>The very first run will create a <code>konnector-dev-config.json</code> file that allows you to configure the connector input when executing it with the CLI.
This configuration comes from [Cozy Collect] when deployed.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;COZY_URL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://cozy.tools:8080&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="err">//</span> <span class="err">configuration</span> <span class="err">injected</span> <span class="err">to</span> <span class="err">the</span> <span class="err">start</span> <span class="err">function</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The <code>fields</code> property allows you to set credentials for the targeted web service, such as <code>login</code> and <code>password</code> as if they come from <a href="https://docs.cozy.io/en/cozy-stack/README/">Cozy Stack</a> (so from a real Cozy Cloud instance). You can add as many fields as the targeted service needs.
The <code>COZY_URL</code> property will be used later. You do not need to change it for now.</p>
<p>As explained earlier, the demo website <a href="http://books.toscrape.com">books.toscrape.com</a> does not need any credentials.
But for the code to run without error, you need to register a <em>fake</em> login and a <em>fake</em> password:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;COZY_URL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://cozy.tools:8080&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;zuck.m@rk.fb&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;123456&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><strong>In the template, this configuration file is already added to <code>.gitignore</code> file to be sure your credentials stay private.</strong></p>
<p>Now you can run the connector again in <em>standalone</em> mode to see how jpg and related data are downloaded.
In this mode, [<code>cozy-client-js</code>] is stubbed and all data meant to be saved in a cozy are displayed in the standard output and files are saved in the ./data directory of the connector.
This is useful to start developing your connector without handling the state of a real <a href="https://docs.cozy.io/en/cozy-stack/README/">Cozy Stack</a>.</p>
<p>Please check <a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/cli.md">CLI section of the documentation</a> for more information.</p>
<h3 id="implement-your-connector">Implement your connector<a class="headerlink" href="#implement-your-connector" title="Permanent link">&para;</a></h3>
<p>There are four steps for a connector to save data to <a href="https://docs.cozy.io/en/cozy-stack/README/">Cozy Stack</a>:</p>
<ol>
<li>authentication</li>
<li>request data</li>
<li>parse and format data</li>
<li>save data to cozy stack</li>
</ol>
<p>You can see these steps in the <code>src/index.js</code> in the <a href="https://github.com/konnectors/template/blob/master/src/index.js">konnectors/template</a>:</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">start</span><span class="p">(</span><span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// step 1.</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Authenticating ...&#39;</span><span class="p">)</span>
  <span class="nx">await</span> <span class="nx">authenticate</span><span class="p">(</span><span class="nx">fields</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Successfully logged in&#39;</span><span class="p">)</span>

  <span class="c1">// step 2.</span>
  <span class="c1">// The BaseKonnector instance expects a Promise as return of the function</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Fetching the list of documents&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">/index.html`</span><span class="p">)</span>

  <span class="c1">// step 3.</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Parsing list of documents&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">parseDocuments</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span>

  <span class="c1">// step 4.</span>
  <span class="c1">// here we use the saveBills function even if what we fetch are not bills, but this is the most</span>
  <span class="c1">// common case in connectors</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Saving data to Cozy&#39;</span><span class="p">)</span>
  <span class="nx">await</span> <span class="nx">saveBills</span><span class="p">(</span><span class="nx">documents</span><span class="p">,</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">folderPath</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// this is a bank identifier which will be used to link bills to bank operations. These</span>
    <span class="c1">// identifiers should be at least a word found in the title of a bank operation related to this</span>
    <span class="c1">// bill. It is not case sensitive.</span>
    <span class="nx">identifiers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;books&#39;</span><span class="p">]</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<h4 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h4>
<p>Open the <code>src/index.js</code> file, there are comments to guide you through it.
The very first step is to be able to authenticate to the remote service, this is done with the line:</p>
<p><em>note: don&rsquo;t forget to add your additional fields if you have some.</em></p>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">authenticate</span><span class="p">(</span><span class="nx">fields</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>
</pre></div>


<p>There are many obstacles at this level:</p>
<ul>
<li>is there a captcha?</li>
<li>is there a 2FA?</li>
<li>how is the <code>&lt;form&gt;</code>?</li>
</ul>
<p><em>note: if the remote service exposes an API, you should use classical <a href="https://github.com/request/request-promise">request</a> call.</em></p>
<p>Let&rsquo;s say the remote service exposes a simple classical form like https://www.trainline.eu/signin:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;signin-form&quot;</span> <span class="na">novalidate</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__form&quot;</span> <span class="na">data-ember-action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">data-ember-action-680</span><span class="o">=</span><span class="s">&quot;680&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&quot;on&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Email Address&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ember691&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ember-text-field textfield ember-view&quot;</span>
    <span class="na">data-enpass</span><span class="err">.</span><span class="na">usermodified</span><span class="o">=</span><span class="s">&quot;yes&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&quot;on&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ember696&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ember-text-field textfield ember-view&quot;</span>
    <span class="na">data-enpass</span><span class="err">.</span><span class="na">usermodified</span><span class="o">=</span><span class="s">&quot;yes&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__forgot&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-ember-action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">data-ember-action-697</span><span class="o">=</span><span class="s">&quot;697&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ember698&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ember-view&quot;</span><span class="p">&gt;</span> Forgot your password?
      <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__buttons &quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__buttons-block&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__button&quot;</span><span class="p">&gt;</span>
        Sign In
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>


<p>Find a CSS selector for the form tag: <code>form#signin-form</code>.
Find the <strong>name</strong> of the input tags used to host user&rsquo;s credentials: <code>email</code> and <code>password</code>.</p>
<p>You are ready to complete the <code>signin(options)</code> object called in the <code>authenticate(username, password)</code> function:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">authenticate</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">signin</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="sb">`https://www.trainline.eu/signin`</span><span class="p">,</span>
    <span class="nx">formSelector</span><span class="o">:</span> <span class="s1">&#39;form#signin-form&#39;</span><span class="p">,</span>
    <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">},</span> <span class="c1">// &quot;email&quot; and &quot;password&quot; correspond to the name attribut of the HTML inputs</span>
    <span class="nx">validate</span><span class="o">:</span> <span class="p">(</span><span class="nx">statusCode</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// write some code to validate the form submission</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<p>To implement the <code>validate</code> function, you need to check what is happening on a successful login and on an unsuccessful login.
With the https://www.trainline.eu/signin example, fill the form with wrong credentials, open your browser&rsquo;s devtools (and check the network tab) and submit the form.
Here it is clear, on incorrect credentials, the response have a status code <code>422</code>:</p>
<div class="codehilite"><pre><span></span><span class="err">HTTP/2.0 422 No Reason Phrase</span>
</pre></div>


<p>Do the same with valid credentials.</p>
<div class="codehilite"><pre><span></span><span class="err">HTTP/2.0 200 OK</span>
</pre></div>


<p>Then you can write a simple and straight forward <code>validate</code> code:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">authenticate</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">signin</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="sb">`https://www.trainline.eu/signin`</span><span class="p">,</span>
    <span class="nx">formSelector</span><span class="o">:</span> <span class="s1">&#39;form#signin-form&#39;</span><span class="p">,</span>
    <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">},</span>
    <span class="nx">validate</span><span class="o">:</span> <span class="p">(</span><span class="nx">statusCode</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">statusCode</span> <span class="o">===</span> <span class="mi">200</span> <span class="o">||</span> <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<p>However if the target website doesn&rsquo;t use <code>statusCode</code> correctly you can also use <code>fullResponse.request.uri.href</code> to check if there is a redirection to a page that requires to be logged in :</p>
<div class="codehilite"><pre><span></span><span class="nx">validate</span><span class="o">:</span> <span class="p">(</span><span class="nx">statusCode</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">fullResponse</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fullResponse</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">uri</span><span class="p">.</span><span class="nx">href</span> <span class="o">==</span> <span class="s1">&#39;https://example.com/account&#39;</span> <span class="o">||</span> <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>It is also possible to use Cheerio to check if an HTML element is present in the web page or not :</p>
<div class="codehilite"><pre><span></span><span class="nx">validate</span><span class="o">:</span> <span class="p">(</span><span class="nx">statusCode</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a[href=&quot;https://example.com/logout&quot;]&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>


<h4 id="request-data">Request data<a class="headerlink" href="#request-data" title="Permanent link">&para;</a></h4>
<p>Once the connector is able to be authenticated by the online service, the next step is to fetch data.
The most common case is that the invoices we want to fetch are listed in a HTML page.
So to request data, we fetch the target webpage that contains invoices list.</p>
<p>But sometimes, the webpage is a JavaScript page that uses a JSON API URL.
JSON is easier to parse than full HTML webpages.</p>
<p>For the purpose of this guide, let&rsquo;s consider we are in the case of a full HTML webpage, like the service given as an example in the template: http://books.toscrape.com</p>
<p>This is the easiest part, just fetch the webpage:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://books.toscrape.com/index.html&#39;</span><span class="p">)</span>
</pre></div>


<p>The <code>$</code> variable is set to a <a href="https://cheerio.js.org/">cheerio</a> object with <a href="https://github.com/request/request-promise#crawl-a-webpage-better">useful API to crawl the webpage</a>.</p>
<p>ℹ You can name this variable as you want and create as many as you want Cheerio variables such as : <code>$doc</code> or <code>$page</code>.</p>
<p>That object will be very useful for the next step.</p>
<h4 id="parse-the-document">Parse the document<a class="headerlink" href="#parse-the-document" title="Permanent link">&para;</a></h4>
<p>We want to get every <code>&lt;article /&gt;</code> of the page in a JavaScript Array:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">articles</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">map</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">,</span> <span class="nx">node</span> <span class="p">=&gt;</span> <span class="nx">node</span><span class="p">))</span>
</pre></div>


<p>For every book, we want to catch the title attribute of this tag <code>article h3 a</code>.
This is a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_object_model/Locating_DOM_elements_using_selectors">CSS Selector</a> that <a href="https://cheerio.js.org/">cheerio</a> understands to select some part of the tree.
In order to crawl a list of items to create an Array of JSON object, we can create our own function or use the function <a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md#scrape">scrape from the connector libs</a>:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="nx">scrape</span><span class="p">(</span>
  <span class="nx">$</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">sel</span><span class="o">:</span> <span class="s1">&#39;h3 a&#39;</span><span class="p">,</span>
      <span class="nx">attr</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span>
    <span class="p">},</span>
    <span class="nx">amount</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">sel</span><span class="o">:</span> <span class="s1">&#39;.price_color&#39;</span><span class="p">,</span>
      <span class="nx">parse</span><span class="o">:</span> <span class="nx">normalizePrice</span>
    <span class="p">},</span>
    <span class="nx">url</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">sel</span><span class="o">:</span> <span class="s1">&#39;h3 a&#39;</span><span class="p">,</span>
      <span class="nx">attr</span><span class="o">:</span> <span class="s1">&#39;href&#39;</span><span class="p">,</span>
      <span class="nx">parse</span><span class="o">:</span> <span class="nx">url</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span>
    <span class="p">},</span>
    <span class="nx">fileurl</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">sel</span><span class="o">:</span> <span class="s1">&#39;img&#39;</span><span class="p">,</span>
      <span class="nx">attr</span><span class="o">:</span> <span class="s1">&#39;src&#39;</span><span class="p">,</span>
      <span class="nx">parse</span><span class="o">:</span> <span class="nx">src</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">src</span><span class="si">}</span><span class="sb">`</span>
    <span class="p">},</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">sel</span><span class="o">:</span> <span class="s1">&#39;h3 a&#39;</span><span class="p">,</span>
      <span class="nx">attr</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
      <span class="nx">parse</span><span class="o">:</span> <span class="nx">title</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">.jpg`</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s1">&#39;article&#39;</span>
<span class="p">)</span>
</pre></div>


<blockquote>
<p>Keep in mind that there are many useful CSS <a href="https://developer.mozilla.org/en-US/docs/Learn/CSS/Introduction_to_CSS/Pseudo-classes_and_pseudo-elements">Pseudo-classes</a> and <a href="https://developer.mozilla.org/en-US/docs/Learn/CSS/Introduction_to_CSS/Combinators_and_multiple_selectors">Combinators</a>  that you can use in your CSS selectors to help you select HTML elements.</p>
</blockquote>
<p>This code will loop on <code>&lt;article /&gt;</code> and for each item will create a JSON object with the selector <code>sel</code> and the value of attribute <code>attr</code> if specified, otherwise it takes the value of the child node, this value can be edited with the <code>parse</code> function.
Here is a sample for the following markup from http://books.toscrape.com:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">article</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;product_pod&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;image_container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;catalogue/a-light-in-the-attic_1000/index.html&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;media/cache/2c/da/2cdad67c44b002e7ead0cc35693c0e8b.jpg&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;A Light in the Attic&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;thumbnail&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;star-rating Three&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-star&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-star&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-star&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-star&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-star&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;catalogue/a-light-in-the-attic_1000/index.html&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;A Light in the Attic&quot;</span><span class="p">&gt;</span>A Light in the ...<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;product_price&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;price_color&quot;</span><span class="p">&gt;</span>£51.77<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;instock availability&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;icon-ok&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
      In stock
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary btn-block&quot;</span> <span class="na">data-loading-text</span><span class="o">=</span><span class="s">&quot;Adding...&quot;</span><span class="p">&gt;</span>Add to basket<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>
</pre></div>


<p>And we will get the following JSON object:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;A Light in the Attic&quot;</span><span class="p">,</span>
  <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">51.77</span><span class="p">,</span>
  <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://books.toscrape.com/catalogue/a-light-in-the-attic_1000/index.html&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fileurl&quot;</span><span class="p">:</span> <span class="s2">&quot;http://books.toscrape.com/media/cache/2c/da/2cdad67c44b002e7ead0cc35693c0e8b.jpg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;A Light in the Attic.jpg&quot;</span>
<span class="p">}</span>
</pre></div>


<p><code>fileurl</code> is used to tell Cozy where to find the file (here an image) to retreive. Then you can save it to Cozy Stack (see section below).</p>
<p>There are many <a href="https://github.com/cozy/cozy-doctypes">document types</a> (Doctypes) you can store in your Cozy, such as :
- <a href="https://github.com/cozy/cozy-doctypes/blob/master/docs/io.cozy.bills.md">Bills</a>
- <a href="https://github.com/cozy/cozy-doctypes/blob/master/docs/io.cozy.contacts.md">Contacts</a>
- <a href="https://github.com/cozy/cozy-doctypes/blob/master/docs/io.cozy.bank.md">Bank</a>
- and so on…</p>
<p>The code sample includes some other function to manipulate the result object, but we have the idea.
Once we build a correct object, we can save it to Cozy Stack.</p>
<h4 id="save-data-to-cozy-stack">Save data to Cozy Stack<a class="headerlink" href="#save-data-to-cozy-stack" title="Permanent link">&para;</a></h4>
<p>In the example we use some built-in function to save a bill to the Cozy Stack.
But there is a bunch of functions available depending on what you want:</p>
<ul>
<li><a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md#adddata"><code>addData</code></a></li>
<li><a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md#module_hydrateAndFilter"><code>hydrateAndFilter</code></a></li>
<li><a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md#module_saveBills"><code>saveBills</code></a> to save invoices files (this function use <code>saveFiles</code>) that can be linked to your bank transactions.</li>
<li><a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md#module_saveFiles"><code>saveFiles</code></a> to upload files to Cozy Drive.</li>
<li>and so on…</li>
</ul>
<p>For example, to save bills to Cozy you have to start by recovering all required fields for a data type <a href="https://github.com/cozy/cozy-doctypes/blob/master/docs/io.cozy.bills.md">io.cozy.bills</a> using the <code>scrape</code> function, and then you can use the function <code>saveBills</code> to save your docs to Cozy Stack as shown below:</p>
<div class="codehilite"><pre><span></span><span class="nx">await</span> <span class="nx">saveBills</span><span class="p">(</span><span class="nx">documents</span><span class="p">,</span> <span class="nx">fields</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">idenditifiers</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">],</span> <span class="c1">// name of the target website</span>
  <span class="nx">contentType</span><span class="o">:</span> <span class="s1">&#39;application/pdf&#39;</span>
<span class="p">})</span>
</pre></div>


<p><em><code>documents</code> is the list of bills returned by the function <code>parseDocuments</code> after the page scraping</em>.</p>
<p>We can find more information in the <a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/docs/api.md">libs repository</a>.</p>
<p><strong>Now that we pass on every steps, it is time to test the connector with <code>yarn standalone</code>.</strong>
We will see next how to connect it effectively to a Cozy Stack.</p>
<hr />
<h2 id="going-further">Going further<a class="headerlink" href="#going-further" title="Permanent link">&para;</a></h2>
<h3 id="connector-structure">Connector structure<a class="headerlink" href="#connector-structure" title="Permanent link">&para;</a></h3>
<p>Basically, a connector is just a function passed to the <code>BaseKonnector</code> constructor, and which
eventually returns a promise:</p>
<p>To create the connector, just create a new instance of <code>BaseKonnector</code> with a function as argument:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">BaseKonnector</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseKonnector</span><span class="p">(</span><span class="nx">fields</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// use fields to get user credentials and choices</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fields</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>


<h4 id="typical-workflow">Typical workflow<a class="headerlink" href="#typical-workflow" title="Permanent link">&para;</a></h4>
<p>Everytime the connector is run, it will call the function and wait for the resolution of the returned promise.
This function can then:</p>
<ul>
<li>log into the target website,</li>
<li>fetch data,</li>
<li>and save them as an array of objects with specific attributes expected by the save function (<code>saveFiles</code>, <code>addData</code>, <code>hydrateAndFilter</code>, <code>saveBills</code>).</li>
</ul>
<p>A basic connector workflow involves:</p>
<ol>
<li>authenticate on the website or API. Might be tricky, but that&rsquo;s the fun :-)</li>
<li>getting data from the online service. You can get the data by calling an API or scraping the webpage. Check if the webpage itself is not using an API to retrieve data, might speed up our job. Mobile phones applications usually connects to an API that might be a reliable source of data.
 </br>A quick <a href="#How-do-I-scrape-my-data-from-a-website">exemple of a scraper here</a>.</li>
<li>filtering data to remove the ones already present inside the database using <a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#module_hydrateAndFilter">hydrateAndFilter</a></li>
<li>save the filtered data into the database (<a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#adddata">addData</a>)</li>
<li>save the related files using (<a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#savefiles">saveFiles</a>)</li>
</ol>
<h4 id="error-handling">Error handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h4>
<p>If your connector hits an issue fetching or saving the data, it can return an error code by throwing it as an error. The error codes are defined inside the [Cozy Collect] application and will display an explicit error to the user:</p>
<ul>
<li><code>LOGIN_FAILED</code>: the connector could not login</li>
<li><code>NOT_EXISTING_DIRECTORY</code>: the folder specified as folder_to_save does not exist (checked automatically by the BaseKonnector)</li>
<li><code>UNKNOWN_ERROR</code>: there was an unexpected error, please take a look at the logs to know what happened</li>
<li><code>VENDOR_DOWN</code>: the target web site is down now</li>
<li><code>USER_ACTION_NEEDED</code>: The user needs to login to the service to do manual actions (could be Terms Of Service to validate)</li>
</ul>
<p>You can get the list of error codes in <code>require('cozy-konnector-libs').errors</code> (<a href="https://github.com/konnectors/libs/blob/master/packages/cozy-konnector-libs/src/helpers/errors.js">source</a>)</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">BaseKonnector</span><span class="p">,</span> <span class="nx">errors</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseKonnector</span><span class="p">(</span><span class="nx">fields</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here, the following message will be displayed in cozy-collect : &quot;Bad credentials. Check the konnector fields and run the connection again.&quot;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">LOGIN_FAILED</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>


<h4 id="cozy-konnector-libs"><a href="https://github.com/cozy/cozy-konnector-libs">cozy-konnector-libs</a><a class="headerlink" href="#cozy-konnector-libs" title="Permanent link">&para;</a></h4>
<p>The Cozy Konnector Libs provide several useful methods for common tasks:</p>
<ul>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#basekonnector">BaseKonnector</a>: creates the connector and fetches from the stack the connector&rsquo;s parameters (COZY_FIELDS&hellip;)</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#cozyclient">cozyClient</a> gives an instance of <a href="https://github.com/cozy/cozy-client-js/">cozy-client-js</a> already initialized according to <code>COZY_URL</code>, and <code>COZY_CREDENTIALS</code>. Your code can immediately interact with the server thanks to this client.</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#module_requestFactory">requestFactory</a> a function which returns an instance of request-promise initialized with defaults often used in connector development.</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/3cad316bac1898ef3c2656577af786f6549b40b0/packages/cozy-logger/src/index.js#L35-L41">log</a> allows to log messages with different levels</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#hydrateAndFilter">hydrateAndFilter</a> to filter data</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#adddata">addData</a> to store the retrieved data into the cozy</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#linkbankoperations">linkBankOperations</a> to link a bill to a bank operation</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#savebills">saveBills</a> which uses hydrateAndFilter, addData, saveFiles and linkBankOperations and which is specific to bills</li>
<li><a href="https://github.com/cozy/cozy-konnector-libs/blob/master/packages/cozy-konnector-libs/docs/api.md#updateorcreate">updateOrCreate</a> create or update documents inside database</li>
<li><a href="">htmlToPDF</a> to convert HTML code to PDF content to insert into a PDF file created with the <code>createCozyPDFDocument</code> function</li>
<li><a href="">createCozyPDFDocument</a> to create a new PDF file to pass to <code>htmlToPDF</code></li>
</ul>
<h2 id="linking-your-connector-to-a-cozy-dev-mode">Linking your connector to a cozy : <code>dev mode</code><a class="headerlink" href="#linking-your-connector-to-a-cozy-dev-mode" title="Permanent link">&para;</a></h2>
<p>After several <code>yarn standalone</code>, your connector is able to automaticaly gather data from the targeted web service. </br>It&rsquo;s time now to put this data in a real cozy. </br>Here comes the <em>dev mode</em>.</p>
<p>For that your connector needs more setup :
<em> a <code>manifest.konnector</code> file
</em> a <code>COZY_URL</code> section in <code>konnector-dev-config.json</code></p>
<h3 id="the-manifest">The manifest<a class="headerlink" href="#the-manifest" title="Permanent link">&para;</a></h3>
<p>Each connector is described by a manifest. This is a JSON file named <code>manifest.konnector</code> at the root of your code folder. It should include the following minimal information:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;konnector name&quot;</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span>
  <span class="nt">&quot;slug&quot;</span><span class="p">:</span> <span class="s2">&quot;konnectorslug&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span>
  <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;git://github.com/cozy/cozy-konnector-thename.git&quot;</span><span class="p">,</span>
  <span class="nt">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Required to get the account&#39;s data&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.accounts&quot;</span><span class="p">,</span>
      <span class="nt">&quot;verbs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><a href="https://github.com/cozy/cozy-konnector-template">cozy-konnector-template</a> already has a manifest which you can customize.</p>
<p>You may add some permissions for your own doctype. <a href="https://docs.cozy.io/en/cozy-stack/konnectors/#the-manifest">Here</a> is the detailed list of fields for a
connector manifest file.</p>
<p>You can also get more information on permissions in the official <a href="https://github.com/cozy/cozy-stack/blob/master/docs/permissions.md">cozy-stack documentation</a></p>
<h3 id="konnector-dev-configjson">konnector-dev-config.json<a class="headerlink" href="#konnector-dev-configjson" title="Permanent link">&para;</a></h3>
<p>If you want to put data from your connector to a real cozy, your must define where to find this
cozy, and this must be a cozy for which you have the credentials.</p>
<p>Here comes the <code>COZY_URL</code> in konnector-dev-config.json which defines just that.</p>
<h3 id="run-the-dev-mode">Run the dev mode<a class="headerlink" href="#run-the-dev-mode" title="Permanent link">&para;</a></h3>
<p>Then you just have to run:</p>
<div class="codehilite"><pre><span></span>yarn dev
</pre></div>


<p>For the first run, the CLI will open a tab in your browser asking you to grant permissions to the
connector. The connector will then save data directly into your cozy. This will validate that your
manifest has the needed permissions on the data you want to save.</p>
<p>This is the <em>dev</em> mode.</p>
<h2 id="integration-in-the-store-for-all-the-users">Integration in the store for all the users<a class="headerlink" href="#integration-in-the-store-for-all-the-users" title="Permanent link">&para;</a></h2>
<p>To run a connector, we do not want the cozy to install all dependencies of the connector each time
it installs it.</p>
<p>To avoid this, the connectors need to be compiled into one file in a dedicated branch of the
repository and the repository needs to be a public git repository. The <code>package.json</code> file
from <a href="https://github.com/cozy/cozy-konnector-template">cozy-konnector-template</a> gives you the commands to do this : <code>yarn build</code> and <code>yarn deploy</code>
but the last one needs to be configured in <code>package.json</code></p>
<p>Once your public git repository is configured, you only have to declare it.</p>
<p>Cozy will soon have a store for connectors and you will be able to publish connectors yourself. But
at the moment, you need to declare your new connector on the <a href="https://forum.cozy.io">cozy forum</a>.
The Cozy team will review your code and add your connector to the [Cozy Collect] application.</p>
<p>To make the connector available more quickly for all cozys, you can follow this few steps of
packaging:</p>
<h3 id="icon">Icon<a class="headerlink" href="#icon" title="Permanent link">&para;</a></h3>
<p>You need to push an icon in <code>assets/</code>. Please respect this rules :</p>
<ul>
<li>Square icon, possibly a png or svg</li>
<li>Try the Apple app store icon if needed</li>
</ul>
<h3 id="packagejson">Package.json<a class="headerlink" href="#packagejson" title="Permanent link">&para;</a></h3>
<ul>
<li>Edit the name to be cozy-konnector-&lt;slug></li>
<li>Edit the repository URL</li>
<li>Edit the command <code>deploy</code> with the correct repository URL</li>
</ul>
<h3 id="manifestkonnector">Manifest.konnector<a class="headerlink" href="#manifestkonnector" title="Permanent link">&para;</a></h3>
<ul>
<li>Edit the name with a nice name (Capitals and spaces allowed here)</li>
<li>Edit icon as needed</li>
<li>Edit slug (no capitals and no spaces here)</li>
<li>Edit source with the correct repository URL</li>
<li>Add a correct vendor link</li>
<li>Choose one or more categories (used to sort connectors in Cozy Store)  in this list : <code>banking, shopping, insurance, isp, telecom, energy, public_service, other</code>.</li>
<li>If needed, change the input type the target website use to login the user: <code>text</code>, <code>email</code> or <code>phone</code> for instance, this will enforce pre-checking</li>
<li>Edit for both locales <code>en</code> and <code>fr</code> the short description and long description</li>
</ul>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">&para;</a></h2>
<h3 id="when-i-run-my-connector-a-ghost-node-process-eats-all-my-memory">When I run my connector, a ghost node process eats all my memory<a class="headerlink" href="#when-i-run-my-connector-a-ghost-node-process-eats-all-my-memory" title="Permanent link">&para;</a></h3>
<p>Cozy-konnector-libs uses <a href="https://cheerio.js.org">cheerio</a> which is great but causes some problems
when you try to console.log a cheerio object.</p>
<p>In standalone or dev mode, the BaseKonnector tries to catch errors and display a maximum of details
about them. But when the error contains a cheerio object, the problem happens.</p>
<p>If you get this problem, catch the error yourself and only display the message :</p>
<div class="codehilite"><pre><span></span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="c1">// good</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">// bad</span>
<span class="p">}</span>
</pre></div>


<h3 id="how-do-i-scrap-a-website">How do I scrap a website<a class="headerlink" href="#how-do-i-scrap-a-website" title="Permanent link">&para;</a></h3>
<p>Use the request function from <a href="https://github.com/cozy/cozy-konnector-libs">cozy-konnector-libs</a> with the proper options.</p>
<p>Here’s a sample code that will fetch the login page to get the value of the anti-CSRF token, submit the login form, browse to the bills page and fetch a bill:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">BaseKonnector</span><span class="p">,</span> <span class="nx">requestFactory</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cozy-konnector-libs&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">rq</span> <span class="o">=</span> <span class="nx">requestFactory</span><span class="p">({</span>
  <span class="nx">jar</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// handle the cookies like a browser</span>
  <span class="nx">json</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// do not try to parse the result as a json document</span>
  <span class="nx">cheerio</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// automatically parse the result with [cheerio](https://github.com/cheeriojs/cheerio)</span>
<span class="p">})</span>
<span class="kr">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseKonnector</span><span class="p">(</span><span class="kd">function</span> <span class="nx">fetch</span> <span class="p">(</span><span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">rq</span><span class="p">(</span><span class="s2">&quot;https://login.remote.web&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">$</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// the result is automatically wrapped with cheerio and you can use it like jQuery</span>
    <span class="kr">const</span> <span class="nx">form</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">form</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">login</span><span class="o">:</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span>
        <span class="nx">password</span><span class="o">:</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
        <span class="nx">csrf_token</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[name=&quot;csrf_token&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">rq</span><span class="p">({</span>
      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
      <span class="nx">form</span>
    <span class="p">})</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">$</span> <span class="p">=&gt;</span> <span class="nx">rq</span><span class="p">(</span><span class="s2">&quot;https://admin.remote.web/bills&quot;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">$</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[{</span><span class="nx">date</span><span class="o">:</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#bill_date&quot;</span><span class="p">)),</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#bill_value&quot;</span><span class="p">)}]</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">entries</span> <span class="p">=&gt;</span> <span class="nx">addData</span><span class="p">(</span><span class="nx">entries</span><span class="p">,</span> <span class="s1">&#39;io.cozy.bills&#39;</span><span class="p">))</span>
<span class="p">})</span>
</pre></div>


<h3 id="what-does-the-yarn-deploy-command-do">What does the <code>yarn deploy</code> command do ?<a class="headerlink" href="#what-does-the-yarn-deploy-command-do" title="Permanent link">&para;</a></h3>
<p>This will deploy a compiled version of your connector in a dedicated branch of your git repository
using <a href="https://github.com/lukekarrys/git-directory-deploy">git-directory-deploy</a>.
This deployed version can then be referenced to
<a href="https://github.com/cozy/cozy-libs/tree/master/packages/cozy-app-publish">cozy-app-publish</a> to deploy your
connector to the registry.</p>
<h3 id="i-want-to-pass-secret-variables-to-my-connector-without-hardcoding-it-in-the-source-code">I want to pass secret variables to my connector without hardcoding it in the source code<a class="headerlink" href="#i-want-to-pass-secret-variables-to-my-connector-without-hardcoding-it-in-the-source-code" title="Permanent link">&para;</a></h3>
<p><strong>COZY_PARAMETERS</strong> environment variable will help you.</p>
<p>In standalone mode or dev mode, you can init it in konnector-dev-config.json :</p>
<div class="codehilite"><pre><span></span>  <span class="s2">&quot;COZY_PARAMETERS&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;secret&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;mySecretKey&quot;</span><span class="p">:</span> <span class="s2">&quot;s3cr3tk3y&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>


<p>In your connector, you will get these secrets as a second parameter in your main function.</p>
<div class="codehilite"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseKonnector</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">start</span><span class="p">(</span><span class="nx">fields</span><span class="p">,</span> <span class="nx">cozyParameters</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="nx">cozyParameters</span><span class="p">.</span><span class="nx">secret</span><span class="p">.</span><span class="nx">mySecretKey</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// -&gt; &quot;s3cr3tk3y&quot;</span>
</pre></div>


<p>If you want to know how this works in a real cozy, you can find more information on <a href="https://docs.cozy.io/en/cozy-stack/konnectors-workflow/#secrets-that-are-not-oauth">Stack documentation</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../app/" title="Create Your Application" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Create Your Application
              </span>
            </div>
          </a>
        
        
          <a href="../selfhost-debian/" title="Self-Host on Debian" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Self-Host on Debian
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../extra.js"></script>
      
    
  </body>
</html>