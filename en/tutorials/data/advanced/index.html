



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cozy documentation">
      
      
        <link rel="canonical" href="https://docs.cozy.io/tutorials/data/advanced/">
      
      
        <meta name="author" content="CozyCloud - https://cozy.io">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[^a-zа-яё0-9\-\.]">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-4.4.0">
    
    
      
        <title>Advanced - Cozy Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    <script type="text/javascript">
        // Used in extra.js, we have to define the variable here since
        // we need access to the "config" jinja variable
        window.outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-app-publish"}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/cozy/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "cozy-desktop", "repo": "https://github.com/cozy-labs/cozy-desktop.git", "subdir": "doc"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-notifications", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-notifications"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}, {"name": "cozy-banks", "repo": "https://github.com/cozy/cozy-banks.git", "subdir": "."}, {"name": "cozy-home", "repo": "https://github.com/cozy/cozy-home.git", "subdir": "."}, {"name": "ach", "repo": "https://github.com/cozy/ach.git", "subdir": "."}]
    </script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Ubuntu+Mono&display=fallback">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#advanced-concepts" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Cozy Developer Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Advanced
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cozy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../app/" title="Tutorials" class="md-tabs__link md-tabs__link--active">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../howTos/dev/runCozyDocker/" title="How-to" class="md-tabs__link">
          How-to
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../cozy-client/getting-started/" title="Libraries" class="md-tabs__link">
          Libraries
        </a>
      
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../projects/" title="Projects" class="md-tabs__link">
          Projects
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Cozy Developer Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cozy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../app/" title="Create Your Application" class="md-nav__link">
      Create Your Application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Develop a Connector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Develop a Connector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/getting-started/" title="Basic structure" class="md-nav__link">
      Basic structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/scrape-data/" title="Scrape data" class="md-nav__link">
      Scrape data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/save-data/" title="Save data" class="md-nav__link">
      Save data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/packaging/" title="Package your connector" class="md-nav__link">
      Package your connector
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Develop a Client-Side Connector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Develop a Client-Side Connector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/clisk-creation/" title="CliSK Creation" class="md-nav__link">
      CliSK Creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/clisk-lib-doc/" title="Library Documentation" class="md-nav__link">
      Library Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/best-practice/" title="Best Practice" class="md-nav__link">
      Best Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/contributions/" title="Contributions" class="md-nav__link">
      Contributions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../client-side-konnector/additional-ressources/" title="Additional Ressources" class="md-nav__link">
      Additional Ressources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4" checked>
    
    <label class="md-nav__link" for="nav-2-4">
      Manipulate data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Manipulate data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pouchdb/" title="PouchDB" class="md-nav__link">
      PouchDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../doctypes/" title="DocTypes" class="md-nav__link">
      DocTypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../qualification/" title="Qualification" class="md-nav__link">
      Qualification
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Advanced
      </label>
    
    <a href="./" title="Advanced" class="md-nav__link md-nav__link--active">
      Advanced
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#indexes-concepts" title="Indexes: concepts" class="md-nav__link">
    Indexes: concepts
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#but-why-though" title="But why, though?" class="md-nav__link">
    But why, though?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-tree" title="B+ Tree" class="md-nav__link">
    B+ Tree
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indexes-why-is-my-document-not-being-retrieved" title="Indexes: why is my document not being retrieved?" class="md-nav__link">
    Indexes: why is my document not being retrieved?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indexes-performances-and-design" title="Indexes: performances and design" class="md-nav__link">
    Indexes: performances and design
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partial-indexes" title="Partial indexes" class="md-nav__link">
    Partial indexes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mango-pagination-performances" title="Mango pagination: performances" class="md-nav__link">
    Mango pagination: performances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views-performances" title="Views: performances" class="md-nav__link">
    Views: performances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views-pagination" title="Views: pagination" class="md-nav__link">
    Views: pagination
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revisions" title="Revisions" class="md-nav__link">
    Revisions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conflicts" title="Conflicts" class="md-nav__link">
    Conflicts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#couchdb-performances" title="CouchDB performances" class="md-nav__link">
    CouchDB performances
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../translate/" title="Translate Apps" class="md-nav__link">
      Translate Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Self-Hosting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        Self-Hosting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/docker/" title="Running inside Docker" class="md-nav__link">
      Running inside Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6-3" type="checkbox" id="nav-2-6-3">
    
    <label class="md-nav__link" for="nav-2-6-3">
      Traditional installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-6-3">
        Traditional installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6-3-1" type="checkbox" id="nav-2-6-3-1">
    
    <label class="md-nav__link" for="nav-2-6-3-1">
      Requirements
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-6-3-1">
        Requirements
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/requirements/" title="What you need" class="md-nav__link">
      What you need
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/requirements/couchdb/" title="Installing CouchDB" class="md-nav__link">
      Installing CouchDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/requirements/nodejs/" title="Installing NodeJS" class="md-nav__link">
      Installing NodeJS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6-3-2" type="checkbox" id="nav-2-6-3-2">
    
    <label class="md-nav__link" for="nav-2-6-3-2">
      Installing cozy-stack
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-6-3-2">
        Installing cozy-stack
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/install/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/install/package/" title="From precompiled package" class="md-nav__link">
      From precompiled package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/install/sources/" title="From sources" class="md-nav__link">
      From sources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6-3-3" type="checkbox" id="nav-2-6-3-3">
    
    <label class="md-nav__link" for="nav-2-6-3-3">
      Finalize installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-6-3-3">
        Finalize installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/finalize/nginx/" title="Nginx and certificates" class="md-nav__link">
      Nginx and certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/finalize/apache/" title="Using Apache instead of Nginx" class="md-nav__link">
      Using Apache instead of Nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/finalize/create_instance/" title="Create first instance" class="md-nav__link">
      Create first instance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6-3-4" type="checkbox" id="nav-2-6-3-4">
    
    <label class="md-nav__link" for="nav-2-6-3-4">
      Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-6-3-4">
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/administration/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/administration/more_instances/" title="Create more instances" class="md-nav__link">
      Create more instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/administration/upgrade/" title="Upgrade cozy-stack" class="md-nav__link">
      Upgrade cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/administration/mail/" title="Configure mail sending" class="md-nav__link">
      Configure mail sending
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/administration/office/" title="Online edition of office documents" class="md-nav__link">
      Online edition of office documents
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How-to
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How-to
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Dev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Dev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/runCozyDocker/" title="Run an App in a Cozy using Docker" class="md-nav__link">
      Run an App in a Cozy using Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/services/" title="Develop a service from your application" class="md-nav__link">
      Develop a service from your application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/hmr/" title="Use Hot Module Replacement in Your App" class="md-nav__link">
      Use Hot Module Replacement in Your App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/cordova/" title="Make a Mobile App Using Cordova" class="md-nav__link">
      Make a Mobile App Using Cordova
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/connect-mobile-app-local-stack/" title="Connect a Mobile App to Your Local Stack" class="md-nav__link">
      Connect a Mobile App to Your Local Stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/run-connectors-on-local-cozy-stack/" title="Run Connectors With a Local cozy-stack" class="md-nav__link">
      Run Connectors With a Local cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/sendmail/" title="Send and Receive E-mails in Development" class="md-nav__link">
      Send and Receive E-mails in Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../references/git-flow/" title="Our Front-End Git Flow" class="md-nav__link">
      Our Front-End Git Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../references/tech-intro/" title="Technical introduction to the Cozy platform" class="md-nav__link">
      Technical introduction to the Cozy platform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Synchronize
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Synchronize
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/sync/linux/" title="Install Cozy Drive on GNU/Linux" class="md-nav__link">
      Install Cozy Drive on GNU/Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Libraries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Libraries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Develop an application
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Develop an application
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-1" type="checkbox" id="nav-4-1-1">
    
    <label class="md-nav__link" for="nav-4-1-1">
      Access data (client)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-1">
        Access data (client)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/relationships/" title="Using relationships" class="md-nav__link">
      Using relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/timeseries/" title="Using time series" class="md-nav__link">
      Using time series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/react-integration/" title="React integration" class="md-nav__link">
      React integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/hooks/" title="Hooks" class="md-nav__link">
      Hooks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/metadata/" title="Metadata" class="md-nav__link">
      Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/node/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/api/cozy-client/" title="Cozy Client API" class="md-nav__link">
      Cozy Client API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/api/cozy-pouch-link.md" title="Cozy Pouch Link API" class="md-nav__link">
      Cozy Pouch Link API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/api/cozy-stack-client/" title="Cozy Stack Client API" class="md-nav__link">
      Cozy Stack Client API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-ui/" title="Build the user interface (ui)" class="md-nav__link">
      Build the user interface (ui)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-3" type="checkbox" id="nav-4-1-3">
    
    <label class="md-nav__link" for="nav-4-1-3">
      Define data (doctypes)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-3">
        Define data (doctypes)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.accounts/" title="Accounts" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.ai.chat.conversations/" title="AI" class="md-nav__link">
      AI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.apps/" title="Apps" class="md-nav__link">
      Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.apps.suggestions/" title="App suggestions" class="md-nav__link">
      App suggestions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.bank/" title="Banking doctypes" class="md-nav__link">
      Banking doctypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.bills/" title="Bills" class="md-nav__link">
      Bills
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.calendar/" title="Calendar" class="md-nav__link">
      Calendar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.konnectors/" title="Connectors" class="md-nav__link">
      Connectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.coachco2/" title="CoachCO2" class="md-nav__link">
      CoachCO2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.contacts/" title="Contacts" class="md-nav__link">
      Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.docrules/" title="DocRules" class="md-nav__link">
      DocRules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.files/" title="Files" class="md-nav__link">
      Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.files_metadata/" title="Files metadata" class="md-nav__link">
      Files metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.home.settings/" title="Home settings" class="md-nav__link">
      Home settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.identities/" title="Identities" class="md-nav__link">
      Identities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.notifications/" title="Notifications" class="md-nav__link">
      Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.photos/" title="Photos" class="md-nav__link">
      Photos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.procedures/" title="Procedures" class="md-nav__link">
      Procedures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.sessions.logins/" title="Sessions Logins" class="md-nav__link">
      Sessions Logins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.sharings/" title="Sharings" class="md-nav__link">
      Sharings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.tags/" title="Tags" class="md-nav__link">
      Tags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.timeseries/" title="Time series" class="md-nav__link">
      Time series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.todos/" title="Todos" class="md-nav__link">
      Todos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.account_types/" title="Accounts Types" class="md-nav__link">
      Accounts Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/cc.cozycloud.autocategorization/" title="Autocategorization" class="md-nav__link">
      Autocategorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.exports/" title="Exports" class="md-nav__link">
      Exports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.oauth.clients/" title="OAuth Clients" class="md-nav__link">
      OAuth Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.oauth.access_codes/" title="OAuth Access Codes" class="md-nav__link">
      OAuth Access Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.triggers/" title="Triggers" class="md-nav__link">
      Triggers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.triggers.state/" title="Triggers state" class="md-nav__link">
      Triggers state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.remote.nextcloud.files/" title="Remote NextCloud files" class="md-nav__link">
      Remote NextCloud files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.remote.requests/" title="Remote requests" class="md-nav__link">
      Remote requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.sessions/" title="Sessions" class="md-nav__link">
      Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.shared/" title="Shared" class="md-nav__link">
      Shared
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.terms/" title="Terms" class="md-nav__link">
      Terms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.ciphers/" title="Bitwarden ciphers" class="md-nav__link">
      Bitwarden ciphers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.folders/" title="Bitwarden folders" class="md-nav__link">
      Bitwarden folders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.organizations/" title="Bitwarden organizations" class="md-nav__link">
      Bitwarden organizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.contacts/" title="Bitwarden contacts" class="md-nav__link">
      Bitwarden contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.unibet.bets/" title="Bets Unibet" class="md-nav__link">
      Bets Unibet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/cc.cozycloud.announcements/" title="Announcements" class="md-nav__link">
      Announcements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-realtime/" title="Realtime data (realtime)" class="md-nav__link">
      Realtime data (realtime)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-device-helper/" title="Native devices (device-helper)" class="md-nav__link">
      Native devices (device-helper)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Develop a konnector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Develop a konnector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/dev/" title="Develop" class="md-nav__link">
      Develop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/operation-linking/" title="Operation linking" class="md-nav__link">
      Operation linking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/synchronization/" title="Synchronization" class="md-nav__link">
      Synchronization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-app-publish/" title="Publish on the store (app-publish)" class="md-nav__link">
      Publish on the store (app-publish)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-notifications/" title="Send notifications (cozy-notifications)" class="md-nav__link">
      Send notifications (cozy-notifications)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Dev tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Dev tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../babel-preset-cozy-app/" title="Babel preset" class="md-nav__link">
      Babel preset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../commitlint-config-cozy/" title="Commitlint" class="md-nav__link">
      Commitlint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../eslint-config-cozy-app/" title="ESLint" class="md-nav__link">
      ESLint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ach/" title="ACH" class="md-nav__link">
      ACH
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1" type="checkbox" id="nav-4-6-1">
    
    <label class="md-nav__link" for="nav-4-6-1">
      Stack server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-6-1">
        Stack server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-2" type="checkbox" id="nav-4-6-1-2">
    
    <label class="md-nav__link" for="nav-4-6-1-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/INSTALL/" title="Install the cozy-stack" class="md-nav__link">
      Install the cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/config/" title="Configuration file" class="md-nav__link">
      Configuration file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/instance/" title="Managing Instances" class="md-nav__link">
      Managing Instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/cli/cozy-stack/" title="Manpages of the command-line tool" class="md-nav__link">
      Manpages of the command-line tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/admin/" title="Using the admin API" class="md-nav__link">
      Using the admin API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/important-changes/" title="Important changes" class="md-nav__link">
      Important changes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-3" type="checkbox" id="nav-4-6-1-3">
    
    <label class="md-nav__link" for="nav-4-6-1-3">
      How-to guides for developpers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-3">
        How-to guides for developpers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/http-api/" title="Using the HTTP API" class="md-nav__link">
      Using the HTTP API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/client-app-dev/" title="Develop a client-side app" class="md-nav__link">
      Develop a client-side app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/docker/" title="Running and building Docker images" class="md-nav__link">
      Running and building Docker images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/konnectors-dev/" title="Running a konnector locally" class="md-nav__link">
      Running a konnector locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/doctype/" title="Adding a new doctype" class="md-nav__link">
      Adding a new doctype
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/assets/" title="Working with the stack assets" class="md-nav__link">
      Working with the stack assets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/release/" title="Build a release" class="md-nav__link">
      Build a release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/CONTRIBUTING/" title="The contributing guide" class="md-nav__link">
      The contributing guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-4" type="checkbox" id="nav-4-6-1-4">
    
    <label class="md-nav__link" for="nav-4-6-1-4">
      Explanations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-4">
        Explanations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/flagship/" title="Flagship app" class="md-nav__link">
      Flagship app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/move-design/" title="Move design" class="md-nav__link">
      Move design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/realtime-internals/" title="Realtime internals" class="md-nav__link">
      Realtime internals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/sharing-design/" title="Sharing design" class="md-nav__link">
      Sharing design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/konnectors-workflow/" title="Workflow of the konnectors" class="md-nav__link">
      Workflow of the konnectors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-5" type="checkbox" id="nav-4-6-1-5">
    
    <label class="md-nav__link" for="nav-4-6-1-5">
      List of services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-5">
        List of services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/ai/" title="/ai - AI" class="md-nav__link">
      /ai - AI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/auth/" title="/auth - Authentication & OAuth" class="md-nav__link">
      /auth - Authentication & OAuth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/delegated-auth/" title="/oidc - Delegated authentication" class="md-nav__link">
       /oidc - Delegated authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/apps/" title="/apps - Applications Management" class="md-nav__link">
      /apps - Applications Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/registry/" title="/apps - Apps registry" class="md-nav__link">
       /apps - Apps registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/bitwarden/" title="/bitwarden - Bitwarden" class="md-nav__link">
      /bitwarden - Bitwarden
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/connection-check/" title="/connection_check - Connection check" class="md-nav__link">
      /connection_check - Connection check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/contacts/" title="/contacts - Contacts" class="md-nav__link">
      /contacts - Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/data-system/" title="/data - Data System" class="md-nav__link">
      /data - Data System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/mango/" title="/data - Mango" class="md-nav__link">
       /data - Mango
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/couchdb-quirks/" title="/data - CouchDB Quirks" class="md-nav__link">
       /data - CouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/pouchdb-quirks/" title="/data - PouchDB Quirks" class="md-nav__link">
       /data - PouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/files/" title="/files - Virtual File System" class="md-nav__link">
      /files - Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/not-synchronized-vfs/" title="/files - Not synchronized directories" class="md-nav__link">
       /files - Not synchronized directories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/references-docs-in-vfs/" title="/files - References of documents in VFS" class="md-nav__link">
       /files - References of documents in VFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/intents/" title="/intents - Intents" class="md-nav__link">
      /intents - Intents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/jobs/" title="/jobs - Jobs" class="md-nav__link">
      /jobs - Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/workers/" title="/jobs - Workers" class="md-nav__link">
       /jobs - Workers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/konnectors/" title="/konnectors - Konnectors" class="md-nav__link">
      /konnectors - Konnectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/move/" title="/move - Move, export and import an instance" class="md-nav__link">
      /move - Move, export and import an instance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/notes/" title="/notes - Notes for collaborative edition" class="md-nav__link">
      /notes - Notes for collaborative edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/notifications/" title="/notifications - Notifications" class="md-nav__link">
      /notifications - Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/office/" title="/office - Collaborative edition of Office documents" class="md-nav__link">
      /office - Collaborative edition of Office documents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/public/" title="/public - Public" class="md-nav__link">
      /public - Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/permissions/" title="/permissions - Permissions" class="md-nav__link">
      /permissions - Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/realtime/" title="/realtime - Realtime" class="md-nav__link">
      /realtime - Realtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/remote/" title="/remote - Proxy for remote data/API" class="md-nav__link">
      /remote - Proxy for remote data/API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/nextcloud/" title="/remote/nextcloud - NextCloud" class="md-nav__link">
       /remote/nextcloud - NextCloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/settings/" title="/settings - Settings" class="md-nav__link">
      /settings - Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/user-action-required/" title="/settings - Terms of Services" class="md-nav__link">
       /settings - Terms of Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/sharing/" title="/sharings - Sharing" class="md-nav__link">
      /sharings - Sharing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/shortcuts/" title="/shortcuts - Shortcuts" class="md-nav__link">
      /shortcuts - Shortcuts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/wellknown/" title="/.well-known - Well-known" class="md-nav__link">
      /.well-known - Well-known
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-apps-registry/" title="Registry server" class="md-nav__link">
      Registry server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Projects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../projects/" title="Documentations" class="md-nav__link">
      Documentations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Cozy Desktop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Cozy Desktop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2-2" type="checkbox" id="nav-5-2-2">
    
    <label class="md-nav__link" for="nav-5-2-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/file_systems/" title="Filesystems" class="md-nav__link">
      Filesystems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/ignore_files/" title="Ignore files" class="md-nav__link">
      Ignore files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/inotify/" title="inotify" class="md-nav__link">
      inotify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/limitations/" title="Limitations" class="md-nav__link">
      Limitations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/macos/" title="MacOS" class="md-nav__link">
      MacOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/usage/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2-3" type="checkbox" id="nav-5-2-3">
    
    <label class="md-nav__link" for="nav-5-2-3">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2-3">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/api_doc/" title="API Documentation" class="md-nav__link">
      API Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/coffeescript.md" title="Cofeescript" class="md-nav__link">
      Cofeescript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/log_analysis/" title="Log analysis" class="md-nav__link">
      Log analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/requirements/" title="Requirements" class="md-nav__link">
      Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/developer/setup/" title="Test" class="md-nav__link">
      Test
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-desktop/feedback/" title="Feddback" class="md-nav__link">
      Feddback
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#indexes-concepts" title="Indexes: concepts" class="md-nav__link">
    Indexes: concepts
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#but-why-though" title="But why, though?" class="md-nav__link">
    But why, though?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-tree" title="B+ Tree" class="md-nav__link">
    B+ Tree
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indexes-why-is-my-document-not-being-retrieved" title="Indexes: why is my document not being retrieved?" class="md-nav__link">
    Indexes: why is my document not being retrieved?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indexes-performances-and-design" title="Indexes: performances and design" class="md-nav__link">
    Indexes: performances and design
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partial-indexes" title="Partial indexes" class="md-nav__link">
    Partial indexes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mango-pagination-performances" title="Mango pagination: performances" class="md-nav__link">
    Mango pagination: performances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views-performances" title="Views: performances" class="md-nav__link">
    Views: performances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views-pagination" title="Views: pagination" class="md-nav__link">
    Views: pagination
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revisions" title="Revisions" class="md-nav__link">
    Revisions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conflicts" title="Conflicts" class="md-nav__link">
    Conflicts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#couchdb-performances" title="CouchDB performances" class="md-nav__link">
    CouchDB performances
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cozy/cozy.github.io/edit/dev/src/tutorials/data/advanced.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="advanced-concepts">Advanced concepts<a class="headerlink" href="#advanced-concepts" title="Permanent link">&para;</a></h1>
<h2 id="indexes-concepts">Indexes: concepts<a class="headerlink" href="#indexes-concepts" title="Permanent link">&para;</a></h2>
<h3 id="but-why-though">But why, though?<a class="headerlink" href="#but-why-though" title="Permanent link">&para;</a></h3>
<p>In order to efficiently filter documents through selectors and sort them, it is important to correctly index data. An index is a way to organize documents in order to retrieve them faster.</p>
<p>To give a simple and non-database comparison, a recipe book might have an index listing all the recipes by their name with their page number. If the reader is looking for a particular recipe, this index avoids him to scan the full book to find it.</p>
<p>The principle is the same for databases index: we want to avoid scanning the whole database each time we are looking for specific data expressed by a selector: even though computers are way faster than humans to scan data, this task can be very time-consuming when dealing with thousands or millions of documents.</p>
<p>In more formal terms, time complexity of a query run on a database with <code>n</code> documents will be <code>O(n)</code> without index, as it requires to scan all documents. In CouchDB, the indexes are actually <a href="https://en.wikipedia.org/wiki/B%2B_tree">B+ Trees</a>, a structure derived from the <a href="https://en.wikipedia.org/wiki/B-tree">B-Trees</a>, that perform in <code>O(log(n))</code> in average, which guarantees a very fast access time even in large datasets.</p>
<blockquote>
<p>From a practical point of view, B-trees, therefore, guarantee an access time of less than 10 ms even for extremely large datasets.</p>
<p>—Dr. Rudolf Bayer, inventor of the B-tree</p>
</blockquote>
<h3 id="b-tree">B+ Tree<a class="headerlink" href="#b-tree" title="Permanent link">&para;</a></h3>
<p>CouchDB indexes are B+ Trees. It means that indexed fields, here <em>keys</em>, are organized as a tree, with the documents stored in the leafs nodes. So, finding a particular document means browsing the tree, from the root to the leaf.<br />
In each node, a key has two children: the left child has all its keys inferior to the parent, while the right child has all its keys superior to the parent.</p>
<p>In the Figure below, borrowed from the <a href="https://guide.couchdb.org/editions/1/en/btree.html">CouchDB guide</a>, you see that each node has three keys. In CouchDB implementation, a B+ Tree node can actually store more than 1600 keys.</p>
<div align="center">
  <img src="../../../img/dev/manipulate-data/b-tree.png" />
  <figcaption>B+ Tree</figcaption>
</div>

<p>This design is very efficient for range queries: in the example above, a query looking for documents having an indexed field between 1 and 3 will browse the tree to find the first document position (with a key of 1) and then get the next two contiguous documents.</p>
<p>ℹ️ CouchDB has an append-only design: it means that there is no in-place update. Each time a document is updated, its new version is appended to the database file, and the B+ Tree is updated to reflect the change.</p>
<p>ℹ️ It is not necessary to master the B+ Tree logic to query data, but it is good to at least be aware of the main concepts to understand the indexing logic, especially when designing complex queries.</p>
<p>ℹ️ When indexing several document fields in the same index, the key is actually an array of those fields, e.g. an index on <code>["category", "created_at"]</code> would give keys such as <code>["sport", "2019-01-01"]</code>.</p>
<p>ℹ️ A key does not have to be unique. Actually, it is often useful to group document per key, e.g. a <code>category</code> key can return many document with the same key value, like <code>sport</code>, <code>work</code>, etc.</p>
<h2 id="indexes-why-is-my-document-not-being-retrieved">Indexes: why is my document not being retrieved?<a class="headerlink" href="#indexes-why-is-my-document-not-being-retrieved" title="Permanent link">&para;</a></h2>
<p>At indexing time, CouchDB evaluates if a new document should be indexed by checking if its fields match an existing index. It means that <strong>all the indexed fields must exist in the document</strong> to index it. It can be problematic for queries that need to check if a particular field exists or not.</p>
<p>For example, this query won’t work:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">queryDef</span> <span class="o">=</span> <span class="nx">client</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">({</span>
    <span class="nx">category</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$exists</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">indexFields</span><span class="p">([</span><span class="s2">&quot;category&quot;</span><span class="p">]);</span>
</pre></div>


<p>Here, we want to get all the todos without a <code>category</code> field. However, those documents will never be indexed, precisely because the field is missing.</p>
<p>Hence, think carefully about your data before hand and do not use queries with <code>$exists: false</code> whenever possible. If a field is missing, it might be better to add a <code>null</code> value so that your documents do not have any missing fields. If this is not possible for some reasons, here is another possible solution - yet not very efficient:</p>
<p>⚠️ Not efficient workaround</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">queryDef</span> <span class="o">=</span> <span class="nx">client</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">({</span>
    <span class="nx">_id</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$gt</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">category</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$exists</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">indexFields</span><span class="p">([</span><span class="s2">&quot;_id&quot;</span><span class="p">]);</span>
</pre></div>


<p>Here, we force an index on the <code>_id</code>, which always exists in any CouchDB document, and ask all the documents with <code>"_id": { "$gt": null }</code>. The <code>category</code> is not indexed so the documents without this field will enter the index.
This is not efficient as it implies that the <code>"category": { "$exists": false }</code> condition will be evaluated in memory by CouchDB for all the documents of the database, thus making a full index scan.</p>
<h2 id="indexes-performances-and-design">Indexes: performances and design<a class="headerlink" href="#indexes-performances-and-design" title="Permanent link">&para;</a></h2>
<p>When designing indexes on several fields, one should keep in mind that they are actually B+ Tree, as explained in this <a href="#indexes-concepts">section</a>. This can be helpful to design efficient queries and avoid performance traps.</p>
<p>To illustrate this, let’s assume you have declared this query, to get all the &ldquo;work&rdquo; todos created in 2019:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">queryDef</span> <span class="o">=</span> <span class="nx">client</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">({</span>
    <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$ge</span><span class="o">:</span> <span class="s2">&quot;2019-01-01&quot;</span><span class="p">,</span>
      <span class="nx">$lt</span><span class="o">:</span> <span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">category</span><span class="o">:</span> <span class="s2">&quot;work&quot;</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">indexFields</span><span class="p">([</span><span class="s2">&quot;created_at&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">]);</span>
</pre></div>


<p>⚠️ This query is actually sub-optimal. To understand this, let’s represent some sample data:</p>
<table>
  <thead>
  <tr>
    <th>created_at</th>
    <th>category</th>
  </tr>
  </thead>
  <tbody>
    <tr>
      <td>2019-01-01</td>
      <td>family</td>
    </tr>
    <tr>
      <td>2019-01-01</td>
      <td>sport</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>2019-01-01</td>
      <td>work</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>2019-01-01</td>
      <td>work</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>2019-01-02</td>
      <td>work</td>
    </tr>
    <tr>
      <td>2019-01-03</td>
      <td>sport</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>2019-01-04</td>
      <td>work</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
    </tr>
    <tr>
      <td>2020-01-01</td>
      <td>family</td>
    </tr>
  </tbody>
</table>

<p>This shows how the data is organized in the index: it is primarily sorted by <code>created_at</code> and then by <code>category</code>. First, the query is looking for all the todos starting from <code>"2019-01-01"</code> and before <code>"2020-01-01"</code>. It easily finds this range in the B+ Tree; but now it must also filter all the results to only keep the rows with <code>category: work</code>.
And this cannot be done through the B+ Tree, because matching rows are not contiguous, as shown in green in the table: this means that CouchDB is forced to perform the <code>category</code> condition in memory, leading to bad performances.</p>
<p>💡 Hopefully, this example can be easily be solved by switching the index fields order:</p>
<p><code>.indexFields(["category", "created_at"])</code></p>
<p>The data is now organized as follow:</p>
<table>
  <thead>
  <tr>
    <th>category</th>
    <th>created_at</th>
  </tr>
  </thead>
  <tbody>
    <tr>
      <td>family</td>
      <td>2019-01-01</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>sport</td>
      <td>2019-01-01</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>work</td>
      <td>2019-01-01</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>work</td>
      <td>2019-01-01</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>work</td>
      <td>2019-01-02</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>work</td>
      <td>2019-01-03</td>
    </tr>
    <tr style="background-color:#b5dcaf">
      <td>work</td>
      <td>2019-01-04</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
    </tr>
    <tr>
      <td>work</td>
      <td>2020-01-01</td>
    </tr>
  </tbody>
</table>

<p>Now, the very same query can be efficiently processed: the <code>category: work</code> is first evaluated in the B+ Tree, which return all the relevant rows, sorted by <code>created_at</code>. Then, the range is easily found now that all the rows are contiguous.</p>
<p>💡 The main takeaway here is: when dealing with a query with both equality and range, you must first index the equality field.
If you are interested about this, you can learn more <a href="https://use-the-index-luke.com/sql/where-clause/searching-for-ranges/greater-less-between-tuning-sql-access-filter-predicates">here</a>. Even though it is SQL-oriented, it also applies for CouchDB as the B-Tree indexing logic is the same.</p>
<p>💡 When creating an index, carefully think about how your data will be organized and which query will need to perfom. The performances can dramatically vary depending on your design, with several orders of magnitude.</p>
<p>💡 The problematic and consequences of the not contiguous rows is further explain in the partial indexes <a href="#partial-indexes">section</a>.</p>
<h2 id="partial-indexes">Partial indexes<a class="headerlink" href="#partial-indexes" title="Permanent link">&para;</a></h2>
<p>In CouchDB, a document is indexed only if its fields matches an existing index. As a consequence, it is not possible to perform efficient queries on non-existing fields.</p>
<p>For instance, the query below does not work, because it searches for document without the <code>category</code> field, but the absence of this field will cause such documents to never be indexed, as previously explained <a href="#indexes-why-is-my-document-not-being-retrieved">here</a>:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">queryDef</span> <span class="o">=</span> <span class="nx">client</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">({</span>
    <span class="nx">category</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$exists</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">indexFields</span><span class="p">([</span><span class="s2">&quot;category&quot;</span><span class="p">]);</span>
</pre></div>


<p>In the same manner, queries implying non-contiguous rows in the B+ Tree are sub-optimal. Typically, queries with a non-egal operator, <code>$ne</code>:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">queryDef</span> <span class="o">=</span> <span class="nx">client</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Exercices&quot;</span><span class="p">,</span>
    <span class="nx">category</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$ne</span><span class="o">:</span> <span class="s2">&quot;sport&quot;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">indexFields</span><span class="p">([</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">]);</span>
</pre></div>


<p>As the <code>$ne</code> operator cannot guarantee contiguous rows, it needs to scan all the index on documents with the <code>"title": "Exercices"</code> to find those that are not in the sport <code>category</code>.</p>
<p><a href="https://docs.couchdb.org/en/3.2.2/api/database/find.html#find-partial-indexes">Partial indexes</a> are a way to circumvent this issue. They allow to define a partial selector condition that will be evaluated at the indexing time, and will add the document in the index if it matches the condition.
Thanks to this, it becomes possible to tell CouchDB at indexing time to exlude documents that do not match the condition, e.g. <code>"category": { "$exists": false}</code> or <code>"category": { "$ne": "sport"}</code>.</p>
<p>Hence, the produced index will only include documents that already matched the partial filter selector, making it possible to query them, as this selector enforces contiguous rows or documents with missing fields.</p>
<p>You can declare a partial index in cozy-client like this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">queryDef</span> <span class="o">=</span> <span class="nx">client</span>
  <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Exercices&quot;</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">partialIndex</span><span class="p">({</span>
    <span class="nx">category</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">$ne</span><span class="o">:</span> <span class="s2">&quot;sport&quot;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">indexFields</span><span class="p">([</span><span class="s2">&quot;title&quot;</span><span class="p">]);</span>
</pre></div>


<p><code>partialIndex</code> supports the same syntax than the <code>where</code>, so you can easily move inefficient selectors into partial indexes.</p>
<p>Note in this example, it is no longer necessary to index the <code>category</code> field, as the field is now evaluated at indexing time, rather than during the query. Hence, a partial index is also useful to design less heavy indexes.</p>
<h2 id="mango-pagination-performances">Mango pagination: performances<a class="headerlink" href="#mango-pagination-performances" title="Permanent link">&para;</a></h2>
<p>With mango queries, the recommanded method to paginate is through the <code>bookmark</code> parameter. However, one could also notice the <code>skip</code> parameter in the CouchDB <a href="https://docs.couchdb.org/en/3.2.2/api/database/find.html">API</a> and be tempted to paginate with it.</p>
<p>We detail here why you should <strong>never use</strong> <code>skip</code> to paginate and use <code>bookmark</code> instead. We explain it for exhaustiveness and to prevent developers to fall into this trap.</p>
<p>This method consists of specifying a <code>limit</code> to the query, which is the maximum number of documents to return, and a <code>skip</code> parameter that is the number of documents returned so far. With cozy-client, its is expressed through <code>limitBy</code> and <code>offset</code>.</p>
<p>⚠️ Do not use this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">let</span> <span class="nx">resp</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">next</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="p">[]</span> <span class="p">};</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">&amp;&amp;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
    <span class="nx">Q</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">).</span><span class="nx">limitBy</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">offset</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
  <span class="p">);</span>
  <span class="nx">docs</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">resp</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>This method is very bad for performances because it actually breaks the B+ Tree indexing logic: there is no way to efficiently skip a fixed number of data in such a tree, so skipping documents consists of normally running the query and then splitting the results starting from the <code>skip</code> number of documents. Thus, the performances quickly degrade when there are many documents to skip.</p>
<p>On the contrary, the <code>bookmark</code> method is very efficient as it preserves the B+ Tree logic. One can see a <code>bookmark</code> as a pointer to start the query in the tree.</p>
<p>💡 Use this:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">let</span> <span class="nx">resp</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">next</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">&amp;&amp;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
    <span class="nx">Q</span><span class="p">(</span><span class="s2">&quot;io.cozy.todos&quot;</span><span class="p">).</span><span class="nx">limitBy</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">offsetBookmark</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">bookmark</span><span class="p">)</span>
  <span class="p">);</span>
  <span class="nx">docs</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">resp</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h2 id="views-performances">Views: performances<a class="headerlink" href="#views-performances" title="Permanent link">&para;</a></h2>
<p>In Cozy, we disabled by default the possibility to create views from applications. This is because we experienced severe performances issues as soon as several views were used: building the views is very slow.</p>
<p>This is mainly because CouchDB itself is written in Erlang, while views are JavaScript <a href="https://en.wikipedia.org/wiki/User-defined_function">UDF</a> and are executed in isolated JavaScript query processes to serialize the map-reduce functions. The communication between thoses processes and CouchDB is done through <code>stdio</code> , which is synchronous and thus require to process one doc at a time.
For more details, see this great <a href="https://www.garrensmith.com/blogs/fortuna-rs-couchdb-view-server">blog post</a> from a CouchDB contributor.</p>
<p>See also the <a href="./#couchdb-performances">CouchDB benchmark</a> we performed.</p>
<p>As quoted from the <a href="https://docs.couchdb.org/en/3.2.2/maintenance/performance.html#views-generation">CouchDB documentation</a>:</p>
<blockquote>
<p>Views with the JavaScript query server are extremely slow to generate when there are a non-trivial number of documents to process.</p>
<p>A 10 million document database took about 4 hours to do view generation</p>
</blockquote>
<p>Let alone the very slow indexing time, this also requires a lot of server CPU to build views. Hence, applications cannot create views to ensure the scalability of Cozy.</p>
<p>ℹ️ Mango queries are directly interpreted in Erlang and therefore do not suffer from the same limitations.</p>
<p>❌ It is possible to express views in Erlang and thus circumvent this performance issues. However, this is completely forbidden in Cozy, because of the security: doing so requires to enable the Erlang query server that needs root access to the CouchDB server, as explained in the <a href="https://docs.couchdb.org/en/3.2.2/config/query-servers.html#config-native-query-servers">CouchDB documentation</a>. This would break the isolation system and let open the possibilty to define adversary UDF functions.</p>
<h2 id="views-pagination">Views: pagination<a class="headerlink" href="#views-pagination" title="Permanent link">&para;</a></h2>
<p>The CouchDB views does not implement the Mango queries <code>bookmark</code> system. However, it is still possible to paginate results efficiently by using a <code>cursor</code>.
This method, described in the <a href="https://docs.couchdb.org/en/3.2.2//ddocs/views/pagination.html#paging-alternate-method">CouchDB documentation</a>, combines the <code>startkey</code> and <code>startkey_docid</code> parameters.</p>
<p>For each query, get the last returned document and extract the searched key as well as the <code>_id</code> to respectively set the next <code>startkey</code> and <code>startkey_docid</code> query parameters.</p>
<p>See this <a href="https://github.com/cozy/cozy-client/blob/0a31ec888c16d9ec1620aae3a1ec001274c0eea4/packages/cozy-client/src/associations/HasManyFiles.js#L12-L42">cursor pagination example</a> in cozy-client.</p>
<h2 id="revisions">Revisions<a class="headerlink" href="#revisions" title="Permanent link">&para;</a></h2>
<p>CouchDB keeps for each document a list of its revision (or more exactly a tree with replication and conflicts).
It&rsquo;s possible to ask to the <a href="https://docs.cozy.io/en/cozy-stack/">cozy-stack</a> the list of the old revisions of a document with <code>[GET /db/{docid}?revs_info=true](http://docs.couchdb.org/en/stable/api/document/common.html#get--db-docid)</code>. It works only if the document has not been deleted. For a deleted document, <a href="https://stackoverflow.com/questions/10854883/retrieve-just-deleted-document/10857330#10857330">a trick</a> is to query the changes feed to know the last revision of the document, and to recreate the document from this revision.</p>
<p>With an old revision, it&rsquo;s possible to get the content of the document at this revision with <code>GET /db/{docid}?rev={rev}</code> if the database was not compacted. On CouchDB 3.x, compaction happen automatically on all databases from times to times.</p>
<p>A <code>purge</code> operation consists to remove the tombstone for the deleted documents. It is a manual operation, triggered by a <code>[POST /db/_purge](http://docs.couchdb.org/en/stable/api/database/misc.html)</code>.</p>
<h2 id="conflicts">Conflicts<a class="headerlink" href="#conflicts" title="Permanent link">&para;</a></h2>
<p>It is possible to create a conflict on CouchDB like it does for the replication by using <code>new_edits: false</code>, but it is not well documented to say the least. The more accurate description was in the old wiki, that <a href="https://wiki.apache.org/couchdb/HTTP_Bulk_Document_API#Posting_Existing_Revisions">no longer exists</a>. Here is a copy of what it said:</p>
<blockquote>
<p>The replicator uses a special mode of _bulk_docs. The documents it writes to the destination database already have revision IDs that need to be preserved for the two databases to be in sync (otherwise it would not be possible to tell that the two represent the same revision.) To prevent the database from assigning them new revision IDs, a &ldquo;new_edits&rdquo;:false property is added to the JSON request body.
Note that this changes the interpretation of the _rev parameter in each document: rather than being the parent revision ID to be matched against, it&rsquo;s the existing revision ID that will be saved as-is into the database. And since it&rsquo;s important to retain revision history when adding to the database, each document body in this mode should have a _revisions property that lists its revision history; the format of this property is described on the HTTP document API. For example:
<code>curl -X POST -d '{"new_edits":false,"docs":[{"_id":"person","_rev":"2-3595405","_revisions":{"start":2,"ids":["3595405","877727288"]},"name":"jim"}]}' "$OTHER_DB/_bulk_docs"</code>
This command will replicate one of the revisions created above, into a separate database <code>OTHER_DB</code>. It will have the same revision ID as in <code>DB</code>, <code>2-3595405</code>, and it will be known to have a parent revision with ID <code>1-877727288</code>. (Even though <code>OTHER_DB</code> will not have the body of that revision, the history will help it detect conflicts in future replications.)
As with _all_or_nothing, this mode can create conflicts; in fact, this is where the conflicts created by replication come from. In short, it&rsquo;s a <code>PUT /doc/{id}?new_edits=false</code> with <code>_rev</code> the new revision of the document, and <code>_revisions</code> the parents of this revision in the revisions tree of this document.</p>
</blockquote>
<p><strong>Conflict example</strong>
Here is an example of a CouchDB conflict.
Let&rsquo;s assume the following document with the revision history <code>[1-abc, 2-def]</code> saved in database:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
  <span class="nt">&quot;_rev&quot;</span><span class="p">:</span> <span class="s2">&quot;2-def&quot;</span><span class="p">,</span>
  <span class="nt">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;tender&quot;</span><span class="p">,</span>
  <span class="nt">&quot;_revisions&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;def&quot;</span><span class="p">,</span> <span class="s2">&quot;abc&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The <code>_revisions</code> block is returned when passing <code>revs=true</code> to the query and gives all the revision ids, which the revision part after the dash. For instance, in <code>2-def</code>, <code>2</code> is called the &ldquo;generation&rdquo; and <code>def</code> the &ldquo;id&rdquo;.
We update the document with a <code>POST /bulk_docs</code> query, with the following content:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;docs&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
      <span class="nt">&quot;_rev&quot;</span><span class="p">:</span> <span class="s2">&quot;3-ghi&quot;</span><span class="p">,</span>
      <span class="nt">&quot;_revisions&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nt">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ghi&quot;</span><span class="p">,</span> <span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;abc&quot;</span><span class="p">]</span> <span class="p">},</span>
      <span class="nt">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;racuda&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;new_edits&quot;</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>


<p>This produces a conflict bewteen <code>2-def</code> and <code>2-xyz</code>: the former was first saved in database, but we forced the latter to be a new child of <code>1-abc</code>. Hence, this document will have two revisions branches: <code>1-abc, 2-def</code> and <code>1-abc, 2-xyz, 3-ghi</code>.</p>
<p><strong>Sharing</strong>
In the <a href="https://docs.cozy.io/en/cozy-stack/sharing-design/">sharing protocol</a>, we implement this behaviour as we follow the CouchDB replication model. However, we prevent CouchDB conflicts for files and directories: see <a href="https://docs.cozy.io/en/cozy-stack/sharing-design/#couchdb-conflicts">this explanation</a></p>
<h2 id="couchdb-performances">CouchDB performances<a class="headerlink" href="#couchdb-performances" title="Permanent link">&para;</a></h2>
<p>Here is a benchmark performed on a CouchDB 2.3, running on a Thinkpad T480, i7-8550U , 16 Go RAM with 256Go SSD.</p>
<p>The document insertion is performed in bulk, by batch of 100K documents maximum.</p>
<p>Each doc has the following structure:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
  <span class="nt">&quot;_rev&quot;</span><span class="p">:</span> <span class="s2">&quot;yyy&quot;</span><span class="p">,</span>
  <span class="nt">&quot;count1&quot;</span><span class="p">:</span> <span class="err">x</span><span class="p">,</span>
  <span class="nt">&quot;count2&quot;</span><span class="p">:</span> <span class="err">x</span>
<span class="p">}</span>
</pre></div>


<p><code>count1</code> is indexed by a Mango index and a JavaScript view, while <code>count2</code> is indexed by an Erlang view. Both of those fields are incremented at each document insertion.</p>
<p>Each query is paginated to retrieve 100 documents at a time. We measured the time taken for each query, to see variations depending on the database volumetry.</p>
<p>To measure the mango and views build time, we performed a single query just after their creation.</p>
<p>ℹ️ The X and Y axis are logarithmic.</p>
<div align="center">
  <img src="../../../img/dev/manipulate-data/performances.png" />
  <figcaption>CouchDB performances</figcaption>
</div>

<p>ℹ️ The code used to perfom this benchmark is available on <a href="https://github.com/paultranvan/couchdb-playground">Github</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../qualification/" title="Qualification" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Qualification
              </span>
            </div>
          </a>
        
        
          <a href="../../translate/" title="Translate Apps" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Translate Apps
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href="/en/privacy">privacy</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.2.3",url:{base:"../../.."}})</script>
      
        <script src="../../../extra.js"></script>
      
    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="https://matomo.cozycloud.cc/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '25']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->

  </body>
</html>