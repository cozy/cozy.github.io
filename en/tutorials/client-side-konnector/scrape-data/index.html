



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cozy documentation">
      
      
        <link rel="canonical" href="https://docs.cozy.io/tutorials/client-side-konnector/scrape-data/">
      
      
        <meta name="author" content="CozyCloud - https://cozy.io">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[^a-zа-яё0-9\-\.]">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Scrape data - Cozy Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    <script type="text/javascript">
        // Used in extra.js, we have to define the variable here since
        // we need access to the "config" jinja variable
        window.outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-app-publish"}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/cozy/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-notifications", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-notifications"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}, {"name": "cozy-banks", "repo": "https://github.com/cozy/cozy-banks.git", "subdir": "."}, {"name": "cozy-home", "repo": "https://github.com/cozy/cozy-home.git", "subdir": "."}, {"name": "ach", "repo": "https://github.com/cozy/ach.git", "subdir": "."}, {"name": "cozy-coclyco", "repo": "https://github.com/cozy/cozy-coclyco.git", "subdir": "."}]
    </script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Ubuntu+Mono&display=fallback">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#implement-your-konnector" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Cozy Developer Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Scrape data
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cozy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../app/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../howTos/dev/runCozyDocker/" title="How-to" class="md-tabs__link">
          How-to
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../cozy-client/getting-started/" title="Libraries" class="md-tabs__link">
          Libraries
        </a>
      
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../projects/" title="Projects" class="md-tabs__link">
          Projects
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Cozy Developer Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cozy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../app/" title="Create Your Application" class="md-nav__link">
      Create Your Application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Develop a Connector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Develop a Connector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/getting-started/" title="Basic structure" class="md-nav__link">
      Basic structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/scrape-data/" title="Scrape data" class="md-nav__link">
      Scrape data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/save-data/" title="Save data" class="md-nav__link">
      Save data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../konnector/packaging/" title="Package your connector" class="md-nav__link">
      Package your connector
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Manipulate data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Manipulate data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/pouchdb/" title="PouchDB" class="md-nav__link">
      PouchDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/doctypes/" title="DocTypes" class="md-nav__link">
      DocTypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/qualification/" title="Qualification" class="md-nav__link">
      Qualification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/advanced/" title="Advanced" class="md-nav__link">
      Advanced
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Self-Hosting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Self-Hosting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/selfhost-debian-pkg/" title="on Debian with packages" class="md-nav__link">
      on Debian with packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/selfhost-ubuntu-sources-en/" title="on Ubuntu from sources (en)" class="md-nav__link">
      on Ubuntu from sources (en)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../selfhosting/selfhost-ubuntu-sources-fr/" title="on Ubuntu from sources (fr)" class="md-nav__link">
      on Ubuntu from sources (fr)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How-to
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How-to
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Dev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Dev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/runCozyDocker/" title="Run an App in a Cozy using Docker" class="md-nav__link">
      Run an App in a Cozy using Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/services/" title="Develop a service from your application" class="md-nav__link">
      Develop a service from your application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/hmr/" title="Use Hot Module Replacement in Your App" class="md-nav__link">
      Use Hot Module Replacement in Your App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/cordova/" title="Make a Mobile App Using Cordova" class="md-nav__link">
      Make a Mobile App Using Cordova
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/connect-mobile-app-local-stack/" title="Connect a Mobile App to Your Local Stack" class="md-nav__link">
      Connect a Mobile App to Your Local Stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/run-connectors-on-local-cozy-stack/" title="Run Connectors With a Local cozy-stack" class="md-nav__link">
      Run Connectors With a Local cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/dev/sendmail/" title="Send and Receive E-mails in Development" class="md-nav__link">
      Send and Receive E-mails in Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../references/git-flow/" title="Our Front-End Git Flow" class="md-nav__link">
      Our Front-End Git Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../references/tech-intro/" title="Technical introduction to the Cozy platform" class="md-nav__link">
      Technical introduction to the Cozy platform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Synchronize
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Synchronize
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howTos/sync/linux/" title="Install Cozy Drive on GNU/Linux" class="md-nav__link">
      Install Cozy Drive on GNU/Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Libraries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Libraries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Develop an application
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Develop an application
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-1" type="checkbox" id="nav-4-1-1">
    
    <label class="md-nav__link" for="nav-4-1-1">
      Access data (client)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-1">
        Access data (client)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/relationships/" title="Using relationships" class="md-nav__link">
      Using relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/timeseries/" title="Using time series" class="md-nav__link">
      Using time series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/react-integration/" title="React integration" class="md-nav__link">
      React integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/hooks/" title="Hooks" class="md-nav__link">
      Hooks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/devtools/" title="Devtools" class="md-nav__link">
      Devtools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/metadata/" title="Metadata" class="md-nav__link">
      Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/node/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/api/cozy-client/" title="Cozy Client API" class="md-nav__link">
      Cozy Client API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/api/cozy-pouch-link/" title="Cozy Pouch Link API" class="md-nav__link">
      Cozy Pouch Link API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-client/api/cozy-stack-client/" title="Cozy Stack Client API" class="md-nav__link">
      Cozy Stack Client API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-ui/" title="Build the user interface (ui)" class="md-nav__link">
      Build the user interface (ui)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-3" type="checkbox" id="nav-4-1-3">
    
    <label class="md-nav__link" for="nav-4-1-3">
      Define data (doctypes)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-3">
        Define data (doctypes)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.accounts/" title="Accounts" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.apps/" title="Apps" class="md-nav__link">
      Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.apps.suggestions/" title="App suggestions" class="md-nav__link">
      App suggestions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.bank/" title="Banking doctypes" class="md-nav__link">
      Banking doctypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.bills/" title="Bills" class="md-nav__link">
      Bills
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.konnectors/" title="Connectors" class="md-nav__link">
      Connectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.contacts/" title="Contacts" class="md-nav__link">
      Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.docrules/" title="DocRules" class="md-nav__link">
      DocRules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.files/" title="Files" class="md-nav__link">
      Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.files_metadata/" title="Files metadata" class="md-nav__link">
      Files metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.home.settings/" title="Home settings" class="md-nav__link">
      Home settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.identities/" title="Identities" class="md-nav__link">
      Identities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.notifications/" title="Notifications" class="md-nav__link">
      Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.photos/" title="Photos" class="md-nav__link">
      Photos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.procedures/" title="Procedures" class="md-nav__link">
      Procedures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.sessions.logins/" title="Sessions Logins" class="md-nav__link">
      Sessions Logins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.sharings/" title="Sharings" class="md-nav__link">
      Sharings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.tags/" title="Tags" class="md-nav__link">
      Tags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.timeseries/" title="Time series" class="md-nav__link">
      Time series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.todos/" title="Todos" class="md-nav__link">
      Todos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.account_types/" title="Accounts Types" class="md-nav__link">
      Accounts Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/cc.cozycloud.autocategorization/" title="Autocategorization" class="md-nav__link">
      Autocategorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.exports/" title="Exports" class="md-nav__link">
      Exports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.oauth.clients/" title="OAuth Clients" class="md-nav__link">
      OAuth Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.oauth.access_codes/" title="OAuth Access Codes" class="md-nav__link">
      OAuth Access Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.triggers/" title="Triggers" class="md-nav__link">
      Triggers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.triggers.state/" title="Triggers state" class="md-nav__link">
      Triggers state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.remote.requests/" title="Remote requests" class="md-nav__link">
      Remote requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.sessions/" title="Sessions" class="md-nav__link">
      Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.shared/" title="Shared" class="md-nav__link">
      Shared
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/io.cozy.terms/" title="Terms" class="md-nav__link">
      Terms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.ciphers/" title="Bitwarden ciphers" class="md-nav__link">
      Bitwarden ciphers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.folders/" title="Bitwarden folders" class="md-nav__link">
      Bitwarden folders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.organizations/" title="Bitwarden organizations" class="md-nav__link">
      Bitwarden organizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.bitwarden.contacts/" title="Bitwarden contacts" class="md-nav__link">
      Bitwarden contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-doctypes/docs/com.unibet.bets/" title="Bets Unibet" class="md-nav__link">
      Bets Unibet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-realtime/" title="Realtime data (realtime)" class="md-nav__link">
      Realtime data (realtime)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-device-helper/" title="Native devices (device-helper)" class="md-nav__link">
      Native devices (device-helper)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Develop a konnector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Develop a konnector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/dev/" title="Develop" class="md-nav__link">
      Develop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/operation-linking/" title="Operation linking" class="md-nav__link">
      Operation linking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-konnector-libs/synchronization/" title="Synchronization" class="md-nav__link">
      Synchronization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-app-publish/" title="Publish on the store (app-publish)" class="md-nav__link">
      Publish on the store (app-publish)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-notifications/" title="Send notifications (cozy-notifications)" class="md-nav__link">
      Send notifications (cozy-notifications)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Dev tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Dev tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../babel-preset-cozy-app/" title="Babel preset" class="md-nav__link">
      Babel preset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../commitlint-config-cozy/" title="Commitlint" class="md-nav__link">
      Commitlint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../eslint-config-cozy-app/" title="ESLint" class="md-nav__link">
      ESLint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ach/" title="ACH" class="md-nav__link">
      ACH
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1" type="checkbox" id="nav-4-6-1">
    
    <label class="md-nav__link" for="nav-4-6-1">
      Stack server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-6-1">
        Stack server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-2" type="checkbox" id="nav-4-6-1-2">
    
    <label class="md-nav__link" for="nav-4-6-1-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/INSTALL/" title="Install the cozy-stack" class="md-nav__link">
      Install the cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/config/" title="Configuration file" class="md-nav__link">
      Configuration file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/instance/" title="Managing Instances" class="md-nav__link">
      Managing Instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/cli/cozy-stack/" title="Manpages of the command-line tool" class="md-nav__link">
      Manpages of the command-line tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/admin/" title="Using the admin API" class="md-nav__link">
      Using the admin API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/important-changes/" title="Important changes" class="md-nav__link">
      Important changes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-3" type="checkbox" id="nav-4-6-1-3">
    
    <label class="md-nav__link" for="nav-4-6-1-3">
      How-to guides for developpers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-3">
        How-to guides for developpers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/http-api/" title="Using the HTTP API" class="md-nav__link">
      Using the HTTP API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/client-app-dev/" title="Develop a client-side app" class="md-nav__link">
      Develop a client-side app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/docker/" title="Running and building Docker images" class="md-nav__link">
      Running and building Docker images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/doctype/" title="Adding a new doctype" class="md-nav__link">
      Adding a new doctype
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/assets/" title="Working with the stack assets" class="md-nav__link">
      Working with the stack assets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/release/" title="Build a release" class="md-nav__link">
      Build a release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/CONTRIBUTING/" title="The contributing guide" class="md-nav__link">
      The contributing guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-4" type="checkbox" id="nav-4-6-1-4">
    
    <label class="md-nav__link" for="nav-4-6-1-4">
      Explanations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-4">
        Explanations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/flagship/" title="Flagship app" class="md-nav__link">
      Flagship app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/move-design/" title="Move design" class="md-nav__link">
      Move design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/realtime-internals/" title="Realtime internals" class="md-nav__link">
      Realtime internals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/sharing-design/" title="Sharing design" class="md-nav__link">
      Sharing design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/konnectors-workflow/" title="Workflow of the konnectors" class="md-nav__link">
      Workflow of the konnectors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-5" type="checkbox" id="nav-4-6-1-5">
    
    <label class="md-nav__link" for="nav-4-6-1-5">
      List of services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-5">
        List of services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/auth/" title="/auth - Authentication & OAuth" class="md-nav__link">
      /auth - Authentication & OAuth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/delegated-auth/" title="/oidc - Delegated authentication" class="md-nav__link">
       /oidc - Delegated authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/apps/" title="/apps - Applications Management" class="md-nav__link">
      /apps - Applications Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/registry/" title="/apps - Apps registry" class="md-nav__link">
       /apps - Apps registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/bitwarden/" title="/bitwarden - Bitwarden" class="md-nav__link">
      /bitwarden - Bitwarden
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/connection-check/" title="/connection_check - Connection check" class="md-nav__link">
      /connection_check - Connection check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/contacts/" title="/contacts - Contacts" class="md-nav__link">
      /contacts - Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/data-system/" title="/data - Data System" class="md-nav__link">
      /data - Data System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/mango/" title="/data - Mango" class="md-nav__link">
       /data - Mango
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/couchdb-quirks/" title="/data - CouchDB Quirks" class="md-nav__link">
       /data - CouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/pouchdb-quirks/" title="/data - PouchDB Quirks" class="md-nav__link">
       /data - PouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/files/" title="/files - Virtual File System" class="md-nav__link">
      /files - Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/not-synchronized-vfs/" title="/files - Not synchronized directories" class="md-nav__link">
       /files - Not synchronized directories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/references-docs-in-vfs/" title="/files - References of documents in VFS" class="md-nav__link">
       /files - References of documents in VFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/intents/" title="/intents - Intents" class="md-nav__link">
      /intents - Intents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/jobs/" title="/jobs - Jobs" class="md-nav__link">
      /jobs - Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/workers/" title="/jobs - Workers" class="md-nav__link">
       /jobs - Workers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/konnectors/" title="/konnectors - Konnectors" class="md-nav__link">
      /konnectors - Konnectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/move/" title="/move - Move, export and import an instance" class="md-nav__link">
      /move - Move, export and import an instance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/notes/" title="/notes - Notes for collaborative edition" class="md-nav__link">
      /notes - Notes for collaborative edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/notifications/" title="/notifications - Notifications" class="md-nav__link">
      /notifications - Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/office/" title="/office - Collaborative edition of Office documents" class="md-nav__link">
      /office - Collaborative edition of Office documents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/public/" title="/public - Public" class="md-nav__link">
      /public - Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/permissions/" title="/permissions - Permissions" class="md-nav__link">
      /permissions - Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/realtime/" title="/realtime - Realtime" class="md-nav__link">
      /realtime - Realtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/remote/" title="/remote - Proxy for remote data/API" class="md-nav__link">
      /remote - Proxy for remote data/API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/settings/" title="/settings - Settings" class="md-nav__link">
      /settings - Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/user-action-required/" title="/settings - Terms of Services" class="md-nav__link">
       /settings - Terms of Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/sharing/" title="/sharings - Sharing" class="md-nav__link">
      /sharings - Sharing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/shortcuts/" title="/shortcuts - Shortcuts" class="md-nav__link">
      /shortcuts - Shortcuts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-stack/wellknown/" title="/.well-known - Well-known" class="md-nav__link">
      /.well-known - Well-known
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cozy-apps-registry/" title="Registry server" class="md-nav__link">
      Registry server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Projects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../projects/" title="Documentations" class="md-nav__link">
      Documentations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implement-your-konnector" title="Implement your konnector" class="md-nav__link">
    Implement your konnector
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-pilotworker-principle" title="The pilot/worker principle" class="md-nav__link">
    The pilot/worker principle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-data" title="Getting the data" class="md-nav__link">
    Getting the data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-the-data" title="Saving the data" class="md-nav__link">
    Saving the data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cozy/edit/dev/src/tutorials/client-side-konnector/scrape-data.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Scrape data</h1>
                
                <p>In this part, we are going to see how to scrape data from the service you want to retrieve your data from. If not done yet, you want to check the <a href="../getting-started/">getting started guide</a>. </p>
<h2 id="implement-your-konnector">Implement your konnector<a class="headerlink" href="#implement-your-konnector" title="Permanent link">&para;</a></h2>
<blockquote>
<p>For the purpose of this guide, let&rsquo;s consider we are in the case of a full HTML webpage, like the service given as an example in the template: <a href="http://books.toscrape.com">books to scrape</a>.</p>
</blockquote>
<p>There are few steps for a konnector to save data to <a href="https://github.com/cozy/cozy-stack">Cozy Stack</a>:</p>
<ol>
<li>Authentication</li>
<li>Scrap and/or request data</li>
<li>Parse and format data</li>
<li>Save data to cozy stack</li>
</ol>
<p>In a <em>client-side connector</em> those steps are mainly done by the following three functions called by the <a href="https://github.com/cozy/cozy-flagship-app/blob/master/connectors/connectorLibs/ContentScript.js">ContentScript.js</a> each and every time the konnector is triggered.</p>
<div class="codehilite"><pre><span></span><span class="c1">/////////</span>
<span class="c1">//PILOT//</span>

<span class="nx">async</span> <span class="nx">ensureAuthenticated</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// First step</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Second step &amp;</span>
    <span class="c1">// Third step</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Fourth step</span>
<span class="p">}</span>
</pre></div>


<p>As mentionned, those three fundamental functions are called every time the konnector is executing, but it is up to you to custom them regarding your needs and the service you are expecting to take the data from.</p>
<blockquote>
<h3 id="the-pilotworker-principle">The pilot/worker principle<a class="headerlink" href="#the-pilotworker-principle" title="Permanent link">&para;</a></h3>
<p>A very specific and important notion to keep in mind:</p>
<p>We are using two webviews to make a konnector run
- a <code>Pilot</code>
- and a <code>Worker</code></p>
<p>As explicit as the name can be, the <code>Pilot</code> treats with the cozy-stack, the <code>Worker</code> interacts with the webservice and sends information to the <code>Pilot</code>.
Both accesses the <code>ContentScript.js</code> methods, but some methods are designed to be restricted (like <code>runInWorker</code>, only usable in the <code>Pilot</code>) but we&rsquo;ll come to that in details during this tutorial.</p>
</blockquote>
<hr />
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<p>Open the <code>src/index.js</code> file, there are comments to guide you through it.
The very first step is to be able to define if the user is authenticated to the remote service. This is done with:</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">ensureAuthenticated</span><span class="p">()</span> <span class="p">{}</span>
</pre></div>


<p>As <code>books.toscrape.com</code> does not have any login form, let&rsquo;s say the remote service exposes a simple classical form like <a href="https://www.trainline.eu/signin">trainline.eu</a> :</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;signin-form&quot;</span> <span class="na">novalidate</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__form&quot;</span> <span class="na">data-ember-action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">data-ember-action-680</span><span class="o">=</span><span class="s">&quot;680&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&quot;on&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Email Address&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ember691&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ember-text-field textfield ember-view&quot;</span>
    <span class="na">data-enpass</span><span class="err">.</span><span class="na">usermodified</span><span class="o">=</span><span class="s">&quot;yes&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&quot;on&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ember696&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ember-text-field textfield ember-view&quot;</span>
    <span class="na">data-enpass</span><span class="err">.</span><span class="na">usermodified</span><span class="o">=</span><span class="s">&quot;yes&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__forgot&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-ember-action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">data-ember-action-697</span><span class="o">=</span><span class="s">&quot;697&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ember698&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ember-view&quot;</span><span class="p">&gt;</span> Forgot your password?
      <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__buttons &quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__buttons-block&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;signin__button&quot;</span><span class="p">&gt;</span>
        Sign In
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>


<p>At this point, you got to tell the <code>Pilot</code> to set the <code>Worker</code> on the wanted web page (baseUrl). To be sure the page is loaded properly, you need to wait for an HTML element (here, let&rsquo;s say it is the button leading you to the quotes page).</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">ensureAuthenticated</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span> <span class="c1">// Set the worker on the baseUrl</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">defaultSelector</span><span class="p">)</span> <span class="c1">// Wait for quotes link element in the worker</span>
  <span class="p">}</span>
</pre></div>


<p>Once <code>waitForElementInWorker</code> will respond, you try to click on this button and wait for another element telling you the page is loaded. Here we are waiting for either a button to a login page or the logout button.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">ensureAuthenticated</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">defaultSelector</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">defaultSelector</span><span class="p">)</span> <span class="c1">// Click on quotes link element in the worker</span>

    <span class="nx">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">race</span><span class="p">([</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">loginLinkSelector</span><span class="p">),</span> 
      <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">logoutLinkSelector</span><span class="p">)</span>
    <span class="p">])</span> <span class="c1">// Wait for both logout or login link to be sure to check authentication when ready</span>
  <span class="p">}</span>
</pre></div>


<p>When one of them is true, you need to check if the user is already logged in or not. If not, we trigger the <code>showLoginFormAndWaitForAuthentication</code> function.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">ensureAuthenticated</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">defaultSelector</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">defaultSelector</span><span class="p">)</span>
    <span class="nx">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">race</span><span class="p">([</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">loginLinkSelector</span><span class="p">),</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">logoutLinkSelector</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="kr">const</span> <span class="nx">authenticated</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkAuthenticated&#39;</span><span class="p">)</span> <span class="c1">// Checking authentication</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">authenticated</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;not authenticated&#39;</span><span class="p">)</span>
      <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">showLoginFormAndWaitForAuthentication</span><span class="p">()</span> <span class="c1">// Triggering the user authentication process</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span> <span class="c1">// Return true to continue konnector execution</span>
  <span class="p">}</span>
</pre></div>


<p>The <code>showLoginFormAndWaitForAuthentication</code> function will remain at least like this: </p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">showLoginFormAndWaitForAuthentication</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">setWorkerState</span><span class="p">({</span> <span class="nx">visible</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span> <span class="c1">// Show the webview to the user</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorkerUntilTrue</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;waitForAuthenticated&#39;</span> <span class="p">})</span> <span class="c1">// Wait for user to connect</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">setWorkerState</span><span class="p">({</span> <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span> <span class="c1">// Hide the webview to the user</span>
  <span class="p">}</span>
</pre></div>


<p>You can always add more actions to it if you need so, but those three are mandatory.</p>
<ul>
<li>First will show to the user the <code>Worker</code> webview.</li>
<li>Second will actually wait for the user manual authentication. This will trigger <code>waitForAuthenticated</code> which wait for <code>checkAuthenticated</code> to return true from the worker (more about it in an instant). This allows us to bypass eventual captcha/2FA or anti-bot securities. </li>
<li>Last will hide the <code>Worker</code> webview from the user before continuing execution.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">showLoginFormAndWaitForAuthentication</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;showLoginFormAndWaitForAuthentication start&#39;</span><span class="p">)</span> <span class="c1">// You can add some logs of course</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">loginLinkSelector</span><span class="p">,</span> <span class="s1">&#39;#username&#39;</span><span class="p">)</span> <span class="c1">// Or an action before or after . Here we clicking on the loginPage element and wait for the username input of the form</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">setWorkerState</span><span class="p">({</span> <span class="nx">visible</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorkerUntilTrue</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;waitForAuthenticated&#39;</span> <span class="p">})</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">setWorkerState</span><span class="p">({</span> <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
  <span class="p">}</span>
</pre></div>


<p><code>checkAuthenticated</code> is a <code>ContentScript.js</code> method that you need to customize and it needs to return true at some point. This is a check to determine if the user login had been successful or not and as it is launched with <code>runInWorkerUntilTrue</code>, it will run again and again until&hellip; Well, until it responds <code>true</code>!</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">checkAuthenticated</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">logoutLinkSelector</span><span class="p">)){</span> 
      <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Auth Check succeeded&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span>
</pre></div>


<p>In the block example above, if we find the <code>logoutLinkSelector</code>, it means the user is actually connected, so the function might return <code>true</code>.</p>
<hr />
<h3 id="getting-the-data">Getting the data<a class="headerlink" href="#getting-the-data" title="Permanent link">&para;</a></h3>
<p>Once the user has been authenticated, the konnector is able to navigate on the web service to fetch data. The most common case is that the documents, e.g. invoices, we want to fetch are listed in a HTML page. So to fetch data, we navigate to the target webpage that contains the invoices, just like a user would.</p>
<p>But sometimes, the webpage is a JavaScript page that uses a JSON API URL. We&rsquo;ll cover this case later in this tutorial.</p>
<p>First you need to customize the <code>getUserDataFromWebsite</code> function. Remember, any required action to access the data you are looking for, must be executed in the <code>Worker</code> webview. Some functions are already foreseen in the <code>ContentScript</code>, but for more complex action, you will need to make your own. So, how does it works?</p>
<p>In this example, we wanna scrap data of the user but also the <code>Music</code> section. </p>
<p>Let&rsquo;s start with the books section</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">musicSectionSelector</span><span class="p">)</span> <span class="c1">// Calling ContentScript method &#39;click&#39; in the worker</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Now we need to check if the landing page is what we expected. On this website, one of the way to do this is to see if the element with the class <code>section-header</code> is containing the string &ldquo;Music&rdquo;. To do this, we&rsquo;ll need a more powerful function than the ones we have in the <code>ContentScript</code>. Let&rsquo;s do this.</p>
<p>First, you will need to declare this function to the <code>ContentScript</code>, so it knows it exist and it can be triggered. At the very bottom of the <code>index.js</code>, you can find the <code>connector.init</code> function taking one argument with an array <code>additionalExposedMethodsNames</code>.</p>
<p>Everytime you will need to build a new function for the pilot to give to the worker, you will need to declare it in this array like so:</p>
<div class="codehilite"><pre><span></span><span class="nx">connector</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="nx">additionalExposedMethodsNames</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">,</span>
<span class="p">]</span> <span class="p">})</span>
</pre></div>


<p>Now it is done, we can give it to the <code>Worker</code>: </p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">musicSectionSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>And define what the function will do.</p>
<div class="codehilite"><pre><span></span><span class="c1">// Homemade function can be async too</span>
<span class="nx">checkIfRightPage</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">selectorContent</span> <span class="o">=</span>  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">).</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">selectorContent</span> <span class="o">===</span> <span class="s2">&quot;Music&quot;</span><span class="p">){</span>
    <span class="k">return</span> <span class="kc">true</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>


<p>At this point, your new function should return true, so let&rsquo;s continue.</p>
<p>Because you are checking and returning a value, you can now decide what to do depending on the response.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">musicSectionSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">isRight</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">isRight</span><span class="p">){</span>
    <span class="kd">let</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getBooksData&#39;</span><span class="p">)</span> <span class="c1">// Another custom function, with an argument</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Something went wrong when accessing the Music section&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Dont forget to declare it!</p>
<div class="codehilite"><pre><span></span><span class="nx">connector</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="nx">additionalExposedMethodsNames</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">,</span>
  <span class="s1">&#39;getBooksData&#39;</span><span class="p">,</span>
<span class="p">]</span> <span class="p">})</span>
</pre></div>


<p>And define what it will do.</p>
<div class="codehilite"><pre><span></span><span class="nx">getBooksData</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">bookList</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">musicBooksSelector</span><span class="p">)</span>
  <span class="nx">allBooks</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">book</span> <span class="k">of</span> <span class="nx">bookList</span><span class="p">){</span>
    <span class="kr">const</span> <span class="nx">aBook</span> <span class="o">=</span> <span class="nx">book</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="kr">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">aBook</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">starRating</span> <span class="o">=</span> <span class="nx">aBook</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="kr">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">aBook</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">textContent</span>
    <span class="kr">const</span> <span class="nx">inStock</span> <span class="o">=</span> <span class="nx">aBook</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;In stock&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">fileurl</span> <span class="o">=</span> <span class="nx">aBook</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">title</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ /g</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">starRating</span><span class="si">}</span><span class="sb">-stars_</span><span class="si">${</span><span class="nx">price</span><span class="si">}</span><span class="sb">.pdf`</span>
    <span class="kr">const</span> <span class="nx">newBook</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">fileurl</span><span class="p">,</span>
      <span class="nx">filename</span><span class="p">,</span>
      <span class="nx">title</span><span class="p">,</span>
      <span class="nx">starRating</span><span class="p">,</span>
      <span class="nx">price</span><span class="p">,</span>
      <span class="nx">inStock</span>
    <span class="p">}</span>
    <span class="nx">allBooks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newBook</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">sendToPilot</span><span class="p">({</span><span class="nx">allBooks</span><span class="p">})</span> 
<span class="p">}</span>
</pre></div>


<blockquote>
<p>Once you are at the <code>Worker</code> level, if you need more functions, these ones do not need to be declared in <code>additionalExposedMethodsNames</code>, just add it into the Class.</p>
</blockquote>
<p>Now the <code>Music</code> section has been scraped and the result of this scraping is returned and stored in the <code>musicBooks</code> variable, let&rsquo;s do the same for the user data.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">musicSectionSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">isRight</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">isRight</span><span class="p">){</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getMusicBooksData&#39;</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">personnalInfoSectionSelector</span><span class="p">,</span> <span class="nx">sectionHeaderSelector</span><span class="p">)</span> <span class="c1">// Once again you can test the page, we won&#39;t do this here for clarity</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getUserData&#39;</span><span class="p">)</span> <span class="c1">// One more custom function</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Something went wrong when accessing the Music section&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Never forget to declare it.</p>
<div class="codehilite"><pre><span></span><span class="nx">connector</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="nx">additionalExposedMethodsNames</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">,</span>
  <span class="s1">&#39;getMusicBooksData&#39;</span><span class="p">,</span>
  <span class="s1">&#39;getUserData&#39;</span><span class="p">,</span>
<span class="p">]</span> <span class="p">})</span>
</pre></div>


<p>And define what it will do. In this website, there is no  possible login so there is no user&rsquo;s information page. We&rsquo;ll just act like there is one.</p>
<div class="codehilite"><pre><span></span><span class="nx">getUserData</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">userInfos</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">userInfosSelector</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">street</span><span class="p">,</span> <span class="nx">city</span><span class="p">,</span> <span class="nx">postCode</span><span class="p">,</span> <span class="nx">country</span><span class="p">]</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">mobilePhoneNumber</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">textContent</span>
  <span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">textContent</span>
  <span class="c1">// This is the standard format for a cozy identity</span>
  <span class="kr">const</span> <span class="nx">userIdentity</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">email</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span><span class="p">{</span>
      <span class="nx">firstName</span><span class="p">,</span>
      <span class="nx">lastName</span><span class="p">,</span>
      <span class="nx">fullName</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">firstName</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">lastName</span><span class="si">}</span><span class="sb">`</span>
    <span class="p">},</span>
    <span class="nx">address</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">formattedAddress</span> <span class="o">:</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
        <span class="nx">street</span><span class="p">,</span>
        <span class="nx">city</span><span class="p">,</span>
        <span class="nx">postCode</span><span class="p">,</span>
        <span class="nx">country</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nx">phone</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
        <span class="nx">number</span> <span class="o">:</span> <span class="nx">mobilePhoneNumber</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">sendToPilot</span><span class="p">(</span><span class="nx">userIdentity</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>There we have both wanted data, let&rsquo;s speak about the <code>sendToPilot</code>.</p>
<p>As mentioned earlier, the <code>Pilot</code> <em>do not</em> see what&rsquo;s happening in the <code>Worker</code>. It cannot access the page like the <code>Worker</code> does so it cannot find and manipulate the data by itself. It is a way for us to ensure that there is no communication between the website and your cozy. The <code>Pilot</code> is the only one who can save data into your cozy, but the <code>Worker</code> is the only one who can access this data. The only way to access any type of data manipulation in the <code>Pilot</code> is to pass the data from the <code>Worker</code> to the <code>Pilot</code>. This is done with <code>sendToPilot</code>.</p>
<p>This function will trigger a <code>storeFromWorker</code> function on the <code>Pilot</code> side and will save the data into the <code>store</code>. You will be able to access this data anywhere in the execution now, in the <code>Pilot</code> with <code>this.store</code> and in the <code>Worker</code> when passing the store as an argument of a function.</p>
<p>To properly finish the <code>getUserDataFromWebsite</code> function, the stack is waiting for a <code>sourceAccountIdentifier</code> to get returned.</p>
<p>If you found an email while scraping the user&rsquo;s data, it is usually what is used. If you don&rsquo;t end up with an email for some reason, you got to define at the beginning of the code a <code>DEFAULT_SOURCE_ACCOUNT_IDENTIFIER</code> with the vendor&rsquo;s name.</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">DEFAULT_SOURCE_ACCOUNT_IDENTIFIER</span> <span class="o">=</span> <span class="s2">&quot;bookstoscrape&quot;</span>

<span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">musicSectionSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">isRight</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">isRight</span><span class="p">){</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getMusicBooksData&#39;</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">personnalInfoSectionSelector</span><span class="p">,</span> <span class="nx">sectionHeaderSelector</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getUserData&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">userIdentity</span><span class="p">.</span><span class="nx">email</span><span class="p">){</span> <span class="c1">// getUserData is supposed to have sent the userIdentity to the pilot, so we check the store</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">sourceAccountIdentifier</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">userIdentity</span><span class="p">.</span><span class="nx">email</span> <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get a sourceAccountIdentifier, using default&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">sourceAccountIdentifier</span><span class="o">:</span> <span class="nx">DEFAULT_SOURCE_ACCOUNT_IDENTIFIER</span> <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>


<p>Well done, you just finished the data part!
Now let&rsquo;s save it with the <code>fetch</code> method, the last step in freeing your data with a client-side konnector.</p>
<hr />
<h3 id="saving-the-data">Saving the data<a class="headerlink" href="#saving-the-data" title="Permanent link">&para;</a></h3>
<p>Saving data is pretty easy after the work done above and it&rsquo;s done within <code>fetch</code>.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{}</span>
</pre></div>


<p>One thing you will need everytime when you save files in your cozy is the <code>context</code>. This allows the <code>Pilot</code> to use the same context as the <code>Worker</code>, meaning the download call will look like it is made from the same webview as the navigation was made.</p>
<p>Next, you have some questions to ask to yourself before actually saving those data on your cozy.</p>
<ul>
<li>What kind of data is it?</li>
</ul>
<p>For now, we&rsquo;ll consider you are dealing with files.
You need to define if the file you are about to save is either a <em>bill</em> or a <em>file</em>.
The specificity of the <em>bill</em> is that it represents actual invoices. It could be linked to operations in your Cozy Banks, but it will need some data like an <code>amount</code> and a <code>vendor</code> added . Here we gonna save the books &ldquo;themselves&rdquo;, as there is no actual file to download, we&rsquo;ll pretend we&rsquo;re saving the <code>.pdf</code> of the books so let&rsquo;s go with a <code>saveFiles</code>.</p>
<ul>
<li>What is the content-type of the file?</li>
</ul>
<p>Usually something you can find in headers, describing what type of content is supposed to be downloaded. For us it&rsquo;s a <code>pdf</code>, but it can be anything : zip, photos, excel sheets &hellip;</p>
<ul>
<li>What will be the attribute on which the deduplication will base its logic?</li>
</ul>
<p>The <code>fileIdAttribute</code> will use the given attribute to know if the file needed to be saved or if it had already been downloaded. The simpliest way to differentiate two files is by their name, but in some cases (like <em>linked bills</em>) you will need something more revelant for the linking operation to hold all the bills for a same month and still save one file per month.</p>
<ul>
<li>What is the qualification label for these documents?</li>
</ul>
<p>Cozy follows certains conventions regarding the documents qualification. You can find the list of <a href="https://github.com/cozy/cozy-client/blob/master/packages/cozy-client/src/assets/qualifications.json">available qualifications</a> and see if something is fitting your needs. Those qualification attributes are very useful to enrich the fetched documents with metadata and use them in apps.
Here, let&rsquo;s use a fictive qualification label, named &ldquo;digital_book&rdquo;.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;fetch starts&quot;</span><span class="p">)</span>
    <span class="c1">// Passing our scraping result containing all our books and their data to saveFiles</span>
    <span class="c1">// And options Object with the answers of our interrogations</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">saveFiles</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">allBooks</span><span class="p">,</span> <span class="p">{</span> 
      <span class="nx">context</span><span class="p">,</span>
      <span class="nx">contentType</span><span class="o">:</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
      <span class="nx">fileIdAttributes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
      <span class="nx">qualificationLabel</span><span class="o">:</span> <span class="s1">&#39;digital_book&#39;</span>
    <span class="p">})</span>
  <span class="p">}</span>
</pre></div>


<p>If needed, you can add some actions in <code>fetch</code> before or after the <code>saveFiles</code>.
Here we&rsquo;ll pretend we need to disconnect from the webservice after retrieving the data.</p>
<p>For that, we can simply click on the logout button in the worker and wait for the button leading you to the login form.</p>
<div class="codehilite"><pre><span></span><span class="nx">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;fetch starts&quot;</span><span class="p">)</span>
    <span class="c1">// Passing our scraping result containing all our books and their data to saveFiles</span>
    <span class="c1">// And options Object with the answers of our interrogations</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">saveFiles</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">allBooks</span><span class="p">,</span> <span class="p">{</span> 
      <span class="nx">context</span><span class="p">,</span>
      <span class="nx">contentType</span><span class="o">:</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
      <span class="nx">fileIdAttributes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
      <span class="nx">qualificationLabel</span><span class="o">:</span> <span class="s1">&#39;digital_book&#39;</span>
    <span class="p">})</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">logoutButtonSelector</span><span class="p">,</span> <span class="nx">loginButtonSelector</span><span class="p">)</span>
  <span class="p">}</span>
</pre></div>


<p>And that&rsquo;s all done! You successfully saved your data, you now have new books to read in your cozy!</p>
<p>This is the basics of freeing your data with a client-side konnector. In the future, we will address a topic about more specific cases requiring other <code>ContentScript</code> methods and other technics to get back what you own (your data, right ?).</p>
<p>To wrap up, this is what your konnector should look like all together: </p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">DEFAULT_SOURCE_ACCOUNT_IDENTIFIER</span> <span class="o">=</span> <span class="s2">&quot;bookstoscrape&quot;</span>

<span class="kr">class</span> <span class="nx">TemplateContentScript</span> <span class="kr">extends</span> <span class="nx">ContentScript</span> <span class="p">{</span>
<span class="c1">//////////</span>
<span class="c1">//PILOT //</span>
<span class="c1">//////////</span>
<span class="nx">async</span> <span class="nx">ensureAuthenticated</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">defaultSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">defaultSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">race</span><span class="p">([</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">loginLinkSelector</span><span class="p">),</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">logoutLinkSelector</span><span class="p">)</span>
  <span class="p">])</span>
  <span class="kr">const</span> <span class="nx">authenticated</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkAuthenticated&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">authenticated</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;not authenticated&#39;</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">showLoginFormAndWaitForAuthentication</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="nx">showLoginFormAndWaitForAuthentication</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;showLoginFormAndWaitForAuthentication start&#39;</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">loginLinkSelector</span><span class="p">,</span> <span class="s1">&#39;#username&#39;</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">setWorkerState</span><span class="p">({</span> <span class="nx">visible</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorkerUntilTrue</span><span class="p">({</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;waitForAuthenticated&#39;</span> <span class="p">})</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">setWorkerState</span><span class="p">({</span> <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="nx">getUserDataFromWebsite</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">musicSectionSelector</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">waitForElementInWorker</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">isRight</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">isRight</span><span class="p">){</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getMusicBooksData&#39;</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">personnalInfoSectionSelector</span><span class="p">,</span> <span class="nx">sectionHeaderSelector</span><span class="p">)</span>
    <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">runInWorker</span><span class="p">(</span><span class="s1">&#39;getUserData&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">userIdentity</span><span class="p">.</span><span class="nx">email</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">sourceAccountIdentifier</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">userIdentity</span><span class="p">.</span><span class="nx">email</span> <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get a sourceAccountIdentifier, using default&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">sourceAccountIdentifier</span><span class="o">:</span> <span class="nx">DEFAULT_SOURCE_ACCOUNT_IDENTIFIER</span> <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;fetch starts&quot;</span><span class="p">)</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">saveFiles</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">allBooks</span><span class="p">,</span> <span class="p">{</span> 
    <span class="nx">context</span><span class="p">,</span>
    <span class="nx">contentType</span><span class="o">:</span> <span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
    <span class="nx">fileIdAttributes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
    <span class="nx">qualificationLabel</span><span class="o">:</span> <span class="s1">&#39;digital_book&#39;</span>
  <span class="p">})</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickAndWait</span><span class="p">(</span><span class="nx">logoutButtonSelector</span><span class="p">,</span> <span class="nx">loginButtonSelector</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//////////</span>
<span class="c1">//WORKER//</span>
<span class="c1">//////////</span>

<span class="nx">async</span> <span class="nx">checkAuthenticated</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">logoutLinkSelector</span><span class="p">)){</span> 
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Auth Check succeeded&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="nx">checkIfRightPage</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">selectorContent</span> <span class="o">=</span>  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">sectionHeaderSelector</span><span class="p">).</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">selectorContent</span> <span class="o">===</span> <span class="s2">&quot;Music&quot;</span><span class="p">){</span>
    <span class="k">return</span> <span class="kc">true</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="nx">getUserData</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">userInfos</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">userInfosSelector</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">street</span><span class="p">,</span> <span class="nx">city</span><span class="p">,</span> <span class="nx">postCode</span><span class="p">,</span> <span class="nx">country</span><span class="p">]</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">mobilePhoneNumber</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">textContent</span>
  <span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">textContent</span>
  <span class="kr">const</span> <span class="nx">userIdentity</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">email</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">firstName</span><span class="p">,</span>
      <span class="nx">lastName</span><span class="p">,</span>
      <span class="nx">fullName</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">firstName</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">lastName</span><span class="si">}</span><span class="sb">`</span>
    <span class="p">},</span>
    <span class="nx">address</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">formattedAddress</span> <span class="o">:</span> <span class="nx">userInfos</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
        <span class="nx">street</span><span class="p">,</span>
        <span class="nx">city</span><span class="p">,</span>
        <span class="nx">postCode</span><span class="p">,</span>
        <span class="nx">country</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nx">phone</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
        <span class="nx">number</span> <span class="o">:</span> <span class="nx">mobilePhoneNumber</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
  <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">sendToPilot</span><span class="p">(</span><span class="nx">userIdentity</span><span class="p">)</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">connector</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="nx">additionalExposedMethodsNames</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;checkIfRightPage&#39;</span><span class="p">,</span>
  <span class="s1">&#39;getMusicBooksData&#39;</span><span class="p">,</span>
  <span class="s1">&#39;getUserData&#39;</span><span class="p">,</span>
<span class="p">]</span> <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../extra.js"></script>
      
    
  </body>
</html>