<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/cozy-stack/sharing/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>/sharings - Sharing - Dev Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Dev Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tutorials/app/">Create Your Application</a>
</li>
                            
<li >
    <a href="../../tutorials/konnector/">Develop a Connector</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-to <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Self-Host</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/selfHost/debian/">Debian</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Dev</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/dev/hmr/">Use Hot Module Replacement in Your App</a>
</li>
            
<li >
    <a href="../../howTos/dev/cordova/">Make a Mobile App Using Cordova</a>
</li>
            
<li >
    <a href="../../howTos/dev/connect-mobile-app-local-stack/">Connect a Mobile App to Your Local Stack</a>
</li>
            
<li >
    <a href="../../howTos/dev/sendmail/">Send and Receive E-mails in Development</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Synchronize</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../howTos/sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../references/tech-intro/">Technical introduction to the Cozy platform</a>
</li>
                            
<li >
    <a href="../../references/git-flow/">Our Front-End Git Flow</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">Stack and tools</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client/guide/">Usage guide</a>
</li>
            
<li >
    <a href="../../cozy-client/api/">API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client-js/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intro/">Introduction</a>
</li>
            
<li >
    <a href="../../cozy-client-js/browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../../cozy-client-js/offline/">How to support offline</a>
</li>
            
<li >
    <a href="../../cozy-client-js/oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../../cozy-client-js/auth-api/">Authentication API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/data-api/">Data System API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/files-api/">Files API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.payslips/">Payslips</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-konnector-libs/api/">API</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/cli/">CLI</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/dev/">Develop</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/errors/">Errors</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/operation-linking/">Operation linking</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/synchronization/">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Architecture</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../architecture/">General overview</a>
</li>
            
<li >
    <a href="../security/">Security</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
            
<li >
    <a href="../config/">Configuration file</a>
</li>
            
<li >
    <a href="../instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../onboarding/">Onboarding</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">For developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../release/">Build a release</a>
</li>
            
<li >
    <a href="../CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../registry/">Apps registry</a>
</li>
            
<li >
    <a href="../data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../mango/">Mango</a>
</li>
            
<li >
    <a href="../replication/">Replication</a>
</li>
            
<li >
    <a href="../couchdb-quirks/">CouchDB Quirks</a>
</li>
            
<li >
    <a href="../pouchdb-quirks/">PouchDB Quirks</a>
</li>
            
<li >
    <a href="../files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../references-docs-in-vfs/">References of documents in VFS</a>
</li>
            
<li >
    <a href="../intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../jobs/">/jobs Jobs</a>
</li>
            
<li >
    <a href="../konnectors/">Konnectors</a>
</li>
            
<li >
    <a href="../workers/">Workers</a>
</li>
            
<li >
    <a href="../move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../settings/">/settings - Settings</a>
</li>
            
<li class="active">
    <a href="./">/sharings - Sharing</a>
</li>
            
<li >
    <a href="../sharing-design/">Request for comments</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">babel-preset-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../babel-preset-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">commitlint-config-cozy</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../commitlint-config-cozy/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-device-helper</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-device-helper/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">eslint-config-cozy-app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../eslint-config-cozy-app/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-flags</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-flags/README/">README</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-realtime</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-realtime/README/">README</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#sharing">Sharing</a></li>
            <li><a href="#sharing-by-links">Sharing by links</a></li>
            <li><a href="#cozy-to-cozy-sharing">Cozy to cozy sharing</a></li>
            <li><a href="#real-time-via-websockets">Real-time via websockets</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-stack/sharing.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-app-publish.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-client-js", "repo": "https://github.com/cozy/cozy-client-js.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/CPatchane/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "konitor", "repo": "https://github.com/konnectors/konitor.git", "subdir": "docs"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="../README/#table-of-contents">Table of contents</a></p>
<h1 id="sharing">Sharing<a class="headerlink" href="#sharing" title="Permanent link">&para;</a></h1>
<p>The owner of a cozy instance can share access to her documents to other users.</p>
<h2 id="sharing-by-links">Sharing by links<a class="headerlink" href="#sharing-by-links" title="Permanent link">&para;</a></h2>
<p>A client-side application can propose sharing by links:</p>
<ol>
<li>The application must have a public route in its manifest. See
   <a href="../apps/#routes">Apps documentation</a> for how to do that.</li>
<li>The application can create a set of permissions for the shared documents,
   with codes. See <a href="../permissions/">permissions documentation</a> for the details.</li>
<li>The application can then create a shareable link (e.g.
   <code>https://calendar.cozy.example.net/public?sharecode=eiJ3iepoaihohz1Y</code>) by
   putting together the app sub-domain, the public route path, and a code for
   the permissions set.</li>
<li>The app can then send this link by mail, via the <a href="../jobs/">jobs system</a>, or
   just give it to the user, so he can transmit it to her friends via chat or
   other ways.</li>
</ol>
<p>When someone opens the shared link, the stack will load the public route, find
the corresponding <code>index.html</code> file, and replace <code>{{.Token}}</code> inside it by a
token with the same set of permissions that <code>sharecode</code> offers. This token can
then be used as a <code>Bearer</code> token in the <code>Authorization</code> header for requests to
the stack (or via cozy-client-js).</p>
<p>If necessary, the application can list the permissions for the token by calling
<code>/permissions/self</code> with this token.</p>
<h2 id="cozy-to-cozy-sharing">Cozy to cozy sharing<a class="headerlink" href="#cozy-to-cozy-sharing" title="Permanent link">&para;</a></h2>
<p>The owner of a cozy instance can send and synchronize documents to others cozy
users.</p>
<h3 id="intents">Intents<a class="headerlink" href="#intents" title="Permanent link">&para;</a></h3>
<p>When a sharing is authorized, the user is redirected to their cozy on the
application that was used for the sharing (when possible). It&rsquo;s possible to
use a specific route to do so, via the intents. The application must declare
an intent in its manifest for the action <code>SHARING</code>. The doctype of the intent
must be the same as the doctype of the first rule of the sharing. In the
redirect URL, the query string will have a <code>sharing</code> parameter with the
sharing ID (but no intent parameter).</p>
<h3 id="routes">Routes<a class="headerlink" href="#routes" title="Permanent link">&para;</a></h3>
<h4 id="post-sharings">POST /sharings/<a class="headerlink" href="#post-sharings" title="Permanent link">&para;</a></h4>
<p>Create a new sharing. The sharing rules and recipients must be specified. The
<code>description</code>, <code>preview_path</code>, and <code>open_sharing</code> fields are optional. The
<code>app_slug</code> field is optional and is the slug of the web app by default.</p>
<p>To create a sharing, no permissions on <code>io.cozy.sharings</code> are needed: an
application can create a sharing on the documents for whose it has a
permission.</p>
<h5 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
      <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
          <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
          <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
          <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;recipients&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2a31ce0128b5f89e40fd90da3f014087&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.contacts&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-4859c6c755143adf0838d225c5e97882&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
      <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
      <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
      <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T12:35:08Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T13:45:43Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
          <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;mail-not-sent&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
          <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
          <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
          <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;self&quot;</span><span class="p">:</span> <span class="s2">&quot;/sharings/ce8835a061d0ef68947afe69a0046722&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="get-sharingssharing-iddiscovery">GET /sharings/:sharing-id/discovery<a class="headerlink" href="#get-sharingssharing-iddiscovery" title="Permanent link">&para;</a></h3>
<p>If no preview_path is set, it&rsquo;s an URL to this route that will be sent to the
users to notify them that someone wants to share something with them. On this
page, they can fill the URL of their Cozy (if the user has already filled its
Cozy URL in a previous sharing, the form will be pre-filled and the user will
just have to click OK).</p>
<h4 id="query-string">Query-String<a class="headerlink" href="#query-string" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>state</td>
<td>a code that identify the recipient</td>
</tr>
</tbody>
</table>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/discovery?state=eiJ3iepoaihohz1Y</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
</pre></div>


<h3 id="post-sharingssharing-iddiscovery">POST /sharings/:sharing-id/discovery<a class="headerlink" href="#post-sharingssharing-iddiscovery" title="Permanent link">&para;</a></h3>
<p>Give to the cozy of the sharer the URL of the Cozy of one recipient. The sharer
will register its-self as an OAuth client on the recipient cozy, and then will
ask the recipient to accept the permissions on its instance.</p>
<p>This route exists in two versions, the version is selected by the HTTP header
<code>Accept</code></p>
<h4 id="classical-x-www-url-encoded">Classical (<code>x-www-url-encoded</code>)<a class="headerlink" href="#classical-x-www-url-encoded" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>state</td>
<td>a code that identify the recipient</td>
</tr>
<tr>
<td>url</td>
<td>the URL of the Cozy for the recipient</td>
</tr>
</tbody>
</table>
<h5 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/discovery</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/html</span>

state=eiJ3iepoaihohz1Y&amp;url=https://bob.example.net/
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Moved Temporarily</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://bob.example.net/auth/sharing?...</span>
</pre></div>


<h4 id="json">JSON<a class="headerlink" href="#json" title="Permanent link">&para;</a></h4>
<p>This version can be more convenient for applications that implement the
preview page. To do that, an application must give a <code>preview_path</code> when
creating the sharing. This path must be a public route of this application.
The recipients will receive a link to the application subdomain, on this page,
and with a <code>sharecode</code> in the query string (like for a share by link).</p>
<p>To know the <code>sharing-id</code>, it&rsquo;s possible to ask <code>GET /permissions/self</code>, with
the <code>sharecode</code> in the <code>Authorization</code> header (it&rsquo;s a JWT token). In the
response, the <code>source_id</code> field will be <code>io.cozy.sharings/&lt;sharing-id&gt;</code>.</p>
<h5 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sharecode</td>
<td>a code that identify the recipient</td>
</tr>
<tr>
<td>url</td>
<td>the URL of the Cozy for the recipient</td>
</tr>
</tbody>
</table>
<h5 id="example_2">Example<a class="headerlink" href="#example_2" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/discovery</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>

sharecode=eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhcHAiLCJpYXQiOjE1MjAzNDM4NTc&amp;url=https://bob.example.net/
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;redirect&quot;</span><span class="p">:</span> <span class="s2">&quot;https://bob.example.net/auth/sharing?...&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="get-sharingssharing-id">GET /sharings/:sharing-id<a class="headerlink" href="#get-sharingssharing-id" title="Permanent link">&para;</a></h3>
<p>Get the information about a sharing. This includes the content of the rules,
the members, as well as the already shared documents for this sharing.</p>
<p>For a member, we can have the following fields:</p>
<ul>
<li>a contact name (<code>name</code>), that is the name of this user as it appears in its
  contact document (if there is one such document)</li>
<li>a public name (<code>public_name</code>), that is the name this user has put on his
  cozy as a public name (it is used for sending emails for example)</li>
<li>an email addresse (<code>email</code>)</li>
<li>an instance URL (<code>instance</code>)</li>
<li>and a status (<code>status</code>).</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>the first member is always the sharer</li>
<li>to display the list of members to a user, the <code>name</code> should be use if
  available, and if it is not the case, you can use the <code>public_name</code> or the
  <code>email</code></li>
<li>on a recipient, the only member with an <code>instance</code> is the local user.</li>
</ul>
<h4 id="request_1">Request<a class="headerlink" href="#request_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<h4 id="response_1">Response<a class="headerlink" href="#response_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-4859c6c755143adf0838d225c5e97882&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
      <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
      <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
      <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T12:35:08Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T13:45:43Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;initial_number_of_files_to_sync&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
      <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
          <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
          <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
          <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
          <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;shared_docs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;a34528d2-13fb-9482-8d20-bf1972531225&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;self&quot;</span><span class="p">:</span> <span class="s2">&quot;/sharings/ce8835a061d0ef68947afe69a0046722&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="get-sharingsdoctypedoctype">GET /sharings/doctype/:doctype<a class="headerlink" href="#get-sharingsdoctypedoctype" title="Permanent link">&para;</a></h3>
<p>Get information about all the sharings that have a rule for the given doctype.
This includes the content of the rules, the members, as well as the already
shared documents for this sharing.</p>
<h4 id="request_2">Request<a class="headerlink" href="#request_2" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/sharings/doctype/io.cozy.files</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<h4 id="response_2">Response<a class="headerlink" href="#response_2" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
      <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
        <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
        <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
        <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T12:35:08Z&quot;</span><span class="p">,</span>
        <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T13:45:43Z&quot;</span><span class="p">,</span>
        <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
            <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
            <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
            <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
            <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
            <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
            <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
            <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-4859c6c755143adf0838d225c5e97882&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;self&quot;</span><span class="p">:</span> <span class="s2">&quot;/sharings/ce8835a061d0ef68947afe69a0046722&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shared_docs&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;a34528d2-13fb-9482-8d20-bf1972531225&quot;</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;b4e58d039c03d01742085de5e505284e&quot;</span><span class="p">,</span>
      <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;another sharing test&quot;</span><span class="p">,</span>
        <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
        <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
        <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-04T12:35:08Z&quot;</span><span class="p">,</span>
        <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-04T13:45:43Z&quot;</span><span class="p">,</span>
        <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
            <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
            <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Singapore&quot;</span><span class="p">,</span>
            <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
            <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;e18e30e2-8eda-1bde-afce-edafc6b1a91b&quot;</span><span class="p">],</span>
            <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
            <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
            <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-7ac5f1252a0c513186a5d35b1a6fd350&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;self&quot;</span><span class="p">:</span> <span class="s2">&quot;/sharings/b4e58d039c03d01742085de5e505284e&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shared_docs&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;dcc52bee-1277-a6b3-b36f-369ffd81a4ee&quot;</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;count&quot;</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="put-sharingssharing-id">PUT /sharings/:sharing-id<a class="headerlink" href="#put-sharingssharing-id" title="Permanent link">&para;</a></h3>
<p>The sharer&rsquo;s cozy sends a request to this route on the recipient&rsquo;s cozy to
create a sharing request, with most of the information about the sharing. This
request will be displayed to the recipient just before its final acceptation
of the sharing, to be sure he/she knows what will be shared.</p>
<h4 id="request_3">Request<a class="headerlink" href="#request_3" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">PUT</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
      <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
      <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
      <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T12:35:08Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T13:45:43Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
          <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;mail-not-sent&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;bob.example.net&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
          <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
          <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
          <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_3">Response<a class="headerlink" href="#response_3" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-f579a69a9fa5dd720010a1dbb82320be&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
      <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
      <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
      <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T12:35:08Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T13:45:43Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
          <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;mail-not-sent&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;bob.example.net&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
          <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
          <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
          <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;self&quot;</span><span class="p">:</span> <span class="s2">&quot;/sharings/ce8835a061d0ef68947afe69a0046722&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-sharingssharing-idanswer">POST /sharings/:sharing-id/answer<a class="headerlink" href="#post-sharingssharing-idanswer" title="Permanent link">&para;</a></h3>
<p>This route is used by the Cozy of a recipient to exchange credentials with the
Cozy of the sharer, after the recipient has accepted a sharing.</p>
<h4 id="request_4">Request<a class="headerlink" href="#request_4" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/answer</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings.answer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;eiJ3iepoaihohz1Y&quot;</span><span class="p">,</span>
      <span class="nt">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">},</span>
      <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_4">Response<a class="headerlink" href="#response_4" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings.answer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">},</span>
      <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-sharingssharing-idrecipients">POST /sharings/:sharing-id/recipients<a class="headerlink" href="#post-sharingssharing-idrecipients" title="Permanent link">&para;</a></h3>
<p>This route allows the sharer to add new recipients to a sharing. It can also
be used by a recipient when the sharing has <code>open_sharing</code> set to true if the
recipient doesn&rsquo;t have the <code>read_only</code> flag</p>
<h4 id="request_5">Request<a class="headerlink" href="#request_5" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;recipients&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce7b1dfbd460039159f228298a29b2aa&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.contacts&quot;</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&quot;read_only_recipients&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;e15384a1223ae2501cc1c4fa94008ea0&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.contacts&quot;</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_5">Response<a class="headerlink" href="#response_5" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-4859c6c755143adf0838d225c5e97882&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;sharing test&quot;</span><span class="p">,</span>
      <span class="nt">&quot;preview_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/preview-sharing&quot;</span><span class="p">,</span>
      <span class="nt">&quot;app_slug&quot;</span><span class="p">:</span> <span class="s2">&quot;drive&quot;</span><span class="p">,</span>
      <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T12:35:08Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-04T13:45:43Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
          <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
          <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;charlie@example.net&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dave&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;dave@example.net&quot;</span><span class="p">,</span>
          <span class="nt">&quot;read_only&quot;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hawaii&quot;</span><span class="p">,</span>
          <span class="nt">&quot;doctype&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span><span class="p">,</span>
          <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">],</span>
          <span class="nt">&quot;add&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;update&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span><span class="p">,</span>
          <span class="nt">&quot;remove&quot;</span><span class="p">:</span> <span class="s2">&quot;sync&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;shared_docs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;612acf1c-1d72-11e8-b043-ef239d3074dd&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;a34528d2-13fb-9482-8d20-bf1972531225&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;self&quot;</span><span class="p">:</span> <span class="s2">&quot;/sharings/ce8835a061d0ef68947afe69a0046722&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-sharingssharing-idrecipientsdelegated">POST /sharings/:sharing-id/recipients/delegated<a class="headerlink" href="#post-sharingssharing-idrecipientsdelegated" title="Permanent link">&para;</a></h3>
<p>This is an internal route for the stack. It is called by the recipient cozy on
the owner cozy to add recipients to the sharing (<code>open_sharing: true</code> only).</p>
<h4 id="request_6">Request<a class="headerlink" href="#request_6" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/delegated</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ce8835a061d0ef68947afe69a0046722&quot;</span><span class="p">,</span>
    <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;recipients&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;dave@example.net&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_6">Response<a class="headerlink" href="#response_6" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;dave@example.net&quot;</span><span class="p">:</span> <span class="s2">&quot;uS6wN7fTYaLZ-GdC_P6UWA&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="put-sharingssharing-idrecipients">PUT /sharings/:sharing-id/recipients<a class="headerlink" href="#put-sharingssharing-idrecipients" title="Permanent link">&para;</a></h3>
<p>This internal route is used to update the list of members, their states and
names, on the recipients cozy.</p>
<h4 id="request_7">Request<a class="headerlink" href="#request_7" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">PUT</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span>
      <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
      <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.net&quot;</span><span class="p">,</span>
      <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;alice.example.net&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
      <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.net&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">,</span>
      <span class="nt">&quot;public_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">,</span>
      <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;charlie@example.net&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dave&quot;</span><span class="p">,</span>
      <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;dave@example.net&quot;</span><span class="p">,</span>
      <span class="nt">&quot;read_only&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_7">Response<a class="headerlink" href="#response_7" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="post-sharingssharing-idrecipientsindexreadonly">POST /sharings/:sharing-id/recipients/:index/readonly<a class="headerlink" href="#post-sharingssharing-idrecipientsindexreadonly" title="Permanent link">&para;</a></h3>
<p>This route is used to add the read-only flag on a recipient of a sharing.</p>
<p><strong>Note</strong>: 0 is not accepted for <code>index</code>, as it is the sharer him-self.</p>
<h5 id="request_8">Request<a class="headerlink" href="#request_8" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/3/readonly</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
</pre></div>


<h4 id="response_8">Response<a class="headerlink" href="#response_8" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="post-sharingssharing-idrecipientsselfreadonly">POST /sharings/:sharing-id/recipients/self/readonly<a class="headerlink" href="#post-sharingssharing-idrecipientsselfreadonly" title="Permanent link">&para;</a></h3>
<p>This is an internal route for the stack. It&rsquo;s used to inform the recipient&rsquo;s
cozy that it is no longer in read-write mode. It also gives it an access token
with a short validity (1 hour) to let it try to synchronize its last changes
before going to read-only mode.</p>
<h4 id="request_9">Request<a class="headerlink" href="#request_9" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/self/readonly</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings.answer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;4dadbcae3f2d7a982e1b308eea000751&quot;</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">},</span>
      <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_9">Response<a class="headerlink" href="#response_9" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idrecipientsindexreadonly">DELETE /sharings/:sharing-id/recipients/:index/readonly<a class="headerlink" href="#delete-sharingssharing-idrecipientsindexreadonly" title="Permanent link">&para;</a></h3>
<p>This route is used to remove the read-only flag on a recipient of a sharing.</p>
<p><strong>Note</strong>: 0 is not accepted for <code>index</code>, as it is the sharer him-self.</p>
<h5 id="request_10">Request<a class="headerlink" href="#request_10" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/3/readonly</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
</pre></div>


<h4 id="response_10">Response<a class="headerlink" href="#response_10" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idrecipientsselfreadonly">DELETE /sharings/:sharing-id/recipients/self/readonly<a class="headerlink" href="#delete-sharingssharing-idrecipientsselfreadonly" title="Permanent link">&para;</a></h3>
<p>This is an internal route for the stack. It&rsquo;s used to inform the recipient&rsquo;s
cozy that it is no longer in read-only mode, and to give it the credentials
for sending its updates.</p>
<h4 id="request_11">Request<a class="headerlink" href="#request_11" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/self/readonly</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/vnd.api+json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.sharings.answer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;4dadbcae3f2d7a982e1b308eea000751&quot;</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">},</span>
      <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="p">{</span><span class="err">...</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_11">Response<a class="headerlink" href="#response_11" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idrecipients">DELETE /sharings/:sharing-id/recipients<a class="headerlink" href="#delete-sharingssharing-idrecipients" title="Permanent link">&para;</a></h3>
<p>This route is used by an application on the owner&rsquo;s cozy to revoke the sharing
for all the members. After that, the sharing active flag will be false, the
credentials for all members will be revoked, the members that have accepted
the sharing will have their cozy informed that the sharing has been revoked,
and pending members can no longer accept this sharing.</p>
<h4 id="request_12">Request<a class="headerlink" href="#request_12" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
</pre></div>


<h4 id="response_12">Response<a class="headerlink" href="#response_12" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idrecipientsindex">DELETE /sharings/:sharing-id/recipients/:index<a class="headerlink" href="#delete-sharingssharing-idrecipientsindex" title="Permanent link">&para;</a></h3>
<p>This route is used to revoke only one recipient of the sharing. The parameter
is the index of this recipient in the <code>members</code> array of the sharing. The
status for this member will be set to <code>revoked</code>, its cozy will be informed of
the revokation, and the credentials for this cozy will be deleted.</p>
<p><strong>Note</strong>: 0 is not accepted for <code>index</code>, as it is the sharer him-self.</p>
<h4 id="request_13">Request<a class="headerlink" href="#request_13" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
</pre></div>


<h4 id="response_13">Response<a class="headerlink" href="#response_13" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idrecipientsself">DELETE /sharings/:sharing-id/recipients/self<a class="headerlink" href="#delete-sharingssharing-idrecipientsself" title="Permanent link">&para;</a></h3>
<p>This route can be used by an application in the cozy of a recipient to remove
it from the sharing.</p>
<h4 id="request_14">Request<a class="headerlink" href="#request_14" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/recipients/self</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
</pre></div>


<h4 id="response_14">Response<a class="headerlink" href="#response_14" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-id">DELETE /sharings/:sharing-id<a class="headerlink" href="#delete-sharingssharing-id" title="Permanent link">&para;</a></h3>
<p>This is an internal route used by the cozy of the sharing&rsquo;s owner to inform a
recipient&rsquo;s cozy that it was revoked.</p>
<h4 id="request_15">Request<a class="headerlink" href="#request_15" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
</pre></div>


<h4 id="response_15">Response<a class="headerlink" href="#response_15" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idanswer">DELETE /sharings/:sharing-id/answer<a class="headerlink" href="#delete-sharingssharing-idanswer" title="Permanent link">&para;</a></h3>
<p>This is an internal route used by a recipient&rsquo;s cozy to inform the owner&rsquo;s
cozy that this recipient no longer wants to be part of the sharing.</p>
<h4 id="request_16">Request<a class="headerlink" href="#request_16" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/answer</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
</pre></div>


<h4 id="response_16">Response<a class="headerlink" href="#response_16" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="post-sharingssharing-id95revs_diff">POST /sharings/:sharing-id/_revs_diff<a class="headerlink" href="#post-sharingssharing-id95revs_diff" title="Permanent link">&para;</a></h3>
<p>This endpoint is used by the sharing replicator of the stack to know which
documents must be sent to the other cozy. It is inspired by
http://docs.couchdb.org/en/stable/api/database/misc.html#db-revs-diff.</p>
<h4 id="request_17">Request<a class="headerlink" href="#request_17" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/_revs_diff</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;io.cozy.files/29631902-2cec-11e8-860d-435b24c2cc58&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;2-4a7e4ae49c4366eaed8edeaea8f784ad&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;io.cozy.files/44f5752a-2cec-11e8-b227-abfc3cfd4b6e&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;4-2ee767305024673cfb3f5af037cd2729&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4-efc54218773c6acd910e2e97fea2a608&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_17">Response<a class="headerlink" href="#response_17" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;io.cozy.files/44f5752a-2cec-11e8-b227-abfc3cfd4b6e&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;missing&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;4-2ee767305024673cfb3f5af037cd2729&quot;</span><span class="p">],</span>
    <span class="nt">&quot;possible_ancestors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;3-753875d51501a6b1883a9d62b4d33f91&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-sharingssharing-id95bulk_docs">POST /sharings/:sharing-id/_bulk_docs<a class="headerlink" href="#post-sharingssharing-id95bulk_docs" title="Permanent link">&para;</a></h3>
<p>This endpoint is used by the sharing replicator of the stack to send
documents in a bulk to the other cozy. It is inspired by
http://docs.couchdb.org/en/stable/api/database/bulk-api.html#db-bulk-docs.</p>
<p><strong>Note</strong>: we force <code>new_edits</code> to <code>false</code>.</p>
<h4 id="request_18">Request<a class="headerlink" href="#request_18" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/_bulk_docs</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;io.cozy.files&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;44f5752a-2cec-11e8-b227-abfc3cfd4b6e&quot;</span><span class="p">,</span>
      <span class="nt">&quot;_rev&quot;</span><span class="p">:</span> <span class="s2">&quot;4-2ee767305024673cfb3f5af037cd2729&quot;</span><span class="p">,</span>
      <span class="nt">&quot;_revisions&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nt">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&quot;2ee767305024673cfb3f5af037cd2729&quot;</span><span class="p">,</span>
          <span class="s2">&quot;753875d51501a6b1883a9d62b4d33f91&quot;</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_18">Response<a class="headerlink" href="#response_18" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">[]</span>
</pre></div>


<h3 id="get-sharingssharing-idiocozyfilesfile-id">GET /sharings/:sharing-id/io.cozy.files/:file-id<a class="headerlink" href="#get-sharingssharing-idiocozyfilesfile-id" title="Permanent link">&para;</a></h3>
<p>This is an internal endpoint used by a stack to get information about a
folder. It is used when a cozy sent to another cozy a file or folder inside a
folder that was trashed (and trash was emptied): the recipient does no longer
have information about the parent directory. To resolve the conflict, it
recreates the missing parent directory by asking the other cozy informations
about it.</p>
<h4 id="request_19">Request<a class="headerlink" href="#request_19" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/io.cozy.files/6d245d072be5522bd3a6f273dd000c65</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.net</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
</pre></div>


<h4 id="response_19">Response<a class="headerlink" href="#response_19" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;6d245d072be5522bd3a6f273dd000c65&quot;</span><span class="p">,</span>
  <span class="nt">&quot;_rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-de4ec176ffa9ddafe8bdcc739dc60fed&quot;</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;directory&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;phone&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dir_id&quot;</span><span class="p">:</span> <span class="s2">&quot;6d245d072be5522bd3a6f273dd007396&quot;</span><span class="p">,</span>
  <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-19T12:35:08Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-19T12:35:08Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bills&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>


<h3 id="put-sharingssharing-idiocozyfilesfile-idmetadata">PUT /sharings/:sharing-id/io.cozy.files/:file-id/metadata<a class="headerlink" href="#put-sharingssharing-idiocozyfilesfile-idmetadata" title="Permanent link">&para;</a></h3>
<p>This is an internal endpoint used by a stack to send the new metadata about a
file that has changed.</p>
<h4 id="request_20">Request<a class="headerlink" href="#request_20" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">PUT</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/io.cozy.files/0c1116b028c6ae6f5cdafb949c088265/metadata</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;4b24ab130b2538b7b444fc65430198ad&quot;</span><span class="p">,</span>
  <span class="nt">&quot;_rev&quot;</span><span class="p">:</span> <span class="s2">&quot;1-356bf77c03baa1da851a2be1f06aba81&quot;</span><span class="p">,</span>
  <span class="nt">&quot;_revisions&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;356bf77c03baa1da851a2be1f06aba81&quot;</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cloudy.jpg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dir_id&quot;</span><span class="p">:</span> <span class="s2">&quot;4b24ab130b2538b7b444fc65430188cd&quot;</span><span class="p">,</span>
  <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-03T16:10:36.885807013+01:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-03T16:10:36.885807013+01:00&quot;</span><span class="p">,</span>
  <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;84980&quot;</span><span class="p">,</span>
  <span class="nt">&quot;md5sum&quot;</span><span class="p">:</span> <span class="s2">&quot;SuRJOiD/QPwDUpKpQujcVA==&quot;</span><span class="p">,</span>
  <span class="nt">&quot;mime&quot;</span><span class="p">:</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
  <span class="nt">&quot;executable&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;trashed&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-01-03T16:10:36.89118949+01:00&quot;</span><span class="p">,</span>
    <span class="nt">&quot;extractor_version&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nt">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="nt">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1600</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_20">Response<a class="headerlink" href="#response_20" title="Permanent link">&para;</a></h4>
<p>If only the metadata has changed (not the content), the response will be a
204:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<p>Else, the content will need to be uploaded:</p>
<div class="codehilite"><pre><span></span>HTTP/1.1 200 OK
Content-Type: application/json
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;dcd478c6-46cf-11e8-9c3f-535468cbce7b&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="put-sharingssharing-idiocozyfileskey">PUT /sharings/:sharing-id/io.cozy.files/:key<a class="headerlink" href="#put-sharingssharing-idiocozyfileskey" title="Permanent link">&para;</a></h3>
<p>Upload the content of a file (new file or its content has changed since the
last synchronization).</p>
<h4 id="request_21">Request<a class="headerlink" href="#request_21" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">PUT</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/io.cozy.files/dcd478c6-46cf-11e8-9c3f-535468cbce7b</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">image/jpeg</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
</pre></div>


<h4 id="response_21">Response<a class="headerlink" href="#response_21" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="delete-sharingssharing-idinitial">DELETE /sharings/:sharing-id/initial<a class="headerlink" href="#delete-sharingssharing-idinitial" title="Permanent link">&para;</a></h3>
<p>This internal route is used by the sharer to inform a recipient&rsquo;s cozy that
the initial sync is finished.</p>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/sharings/ce8835a061d0ef68947afe69a0046722/initial</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">bob.example.net</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer ...</span>
</pre></div>


<h4 id="response_22">Response<a class="headerlink" href="#response_22" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h2 id="real-time-via-websockets">Real-time via websockets<a class="headerlink" href="#real-time-via-websockets" title="Permanent link">&para;</a></h2>
<p>You can subscribe to the <a href="../realtime/">realtime</a> API for the normal doctypes,
but also for a special <code>io.cozy.sharings.initial-sync</code> doctype. For this
doctype, you can give the id of a sharing and you will be notified when a file
will be received during the initial synchronisation (<code>UPDATED</code>), and when the
sync will be done (<code>DELETED</code>).</p>
<h3 id="example_3">Example<a class="headerlink" href="#example_3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>client &gt; {&quot;method&quot;: &quot;AUTH&quot;,
          &quot;payload&quot;: &quot;xxAppOrAuthTokenxx=&quot;}
client &gt; {&quot;method&quot;: &quot;SUBSCRIBE&quot;,
          &quot;payload&quot;: {&quot;type&quot;: &quot;io.cozy.sharings.initial-sync&quot;, &quot;id&quot;: &quot;ce8835a061d0ef68947afe69a0046722&quot;}
server &gt; {&quot;event&quot;: &quot;UPDATED&quot;,
          &quot;payload&quot;: {&quot;id&quot;: &quot;ce8835a061d0ef68947afe69a0046722&quot;, &quot;type&quot;: &quot;io.cozy.sharings.initial-sync&quot;, &quot;doc&quot;: {&quot;count&quot;: 12}}}
server &gt; {&quot;event&quot;: &quot;UPDATED&quot;,
          &quot;payload&quot;: {&quot;id&quot;: &quot;ce8835a061d0ef68947afe69a0046722&quot;, &quot;type&quot;: &quot;io.cozy.sharings.initial-sync&quot;, &quot;doc&quot;: {&quot;count&quot;: 13}}}
server &gt; {&quot;event&quot;: &quot;DELETED&quot;,
          &quot;payload&quot;: {&quot;id&quot;: &quot;ce8835a061d0ef68947afe69a0046722&quot;, &quot;type&quot;: &quot;io.cozy.sharings.initial-sync&quot;}}
</pre></div></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//piwik.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//piwik.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
