



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cozy documentation">
      
      
        <link rel="canonical" href="https://docs.cozy.io/cozy-stack/auth/">
      
      
        <meta name="author" content="CozyCloud - https://cozy.io">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[^a-zа-яё0-9\-\.]">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-4.4.0">
    
    
      
        <title>/auth - Authentication & OAuth - Cozy Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    <script type="text/javascript">
        // Used in extra.js, we have to define the variable here since
        // we need access to the "config" jinja variable
        window.outsideDocs = [{"name": "cozy-app-publish", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-app-publish"}, {"name": "cozy-apps-registry", "repo": "https://github.com/cozy/cozy-apps-registry.git", "subdir": "."}, {"name": "cozy-client", "repo": "https://github.com/cozy/cozy-client.git", "subdir": "docs"}, {"name": "cozy-ui", "repo": "https://github.com/cozy/cozy-ui.git", "subdir": "docs"}, {"name": "cozy-doctypes", "repo": "https://github.com/cozy/cozy-doctypes.git", "subdir": "."}, {"name": "cozy-konnector-libs", "repo": "https://github.com/konnectors/libs.git", "subdir": "packages/cozy-konnector-libs/docs"}, {"name": "cozy-scripts", "repo": "https://github.com/cozy/create-cozy-app.git", "subdir": "packages/cozy-scripts/docs"}, {"name": "cozy-stack", "repo": "https://github.com/cozy/cozy-stack.git", "subdir": "docs"}, {"name": "cozy-desktop", "repo": "https://github.com/cozy-labs/cozy-desktop.git", "subdir": "doc"}, {"name": "babel-preset-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/babel-preset-cozy-app"}, {"name": "commitlint-config-cozy", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/commitlint-config-cozy"}, {"name": "cozy-device-helper", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-device-helper"}, {"name": "eslint-config-cozy-app", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/eslint-config-cozy-app"}, {"name": "cozy-notifications", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-notifications"}, {"name": "cozy-flags", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-flags"}, {"name": "cozy-realtime", "repo": "https://github.com/cozy/cozy-libs.git", "subdir": "packages/cozy-realtime"}, {"name": "cozy-banks", "repo": "https://github.com/cozy/cozy-banks.git", "subdir": "."}, {"name": "cozy-home", "repo": "https://github.com/cozy/cozy-home.git", "subdir": "."}, {"name": "ach", "repo": "https://github.com/cozy/ach.git", "subdir": "."}]
    </script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Ubuntu+Mono&display=fallback">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#authentication-and-access-delegations" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Cozy Developer Documentation
            </span>
            <span class="md-header-nav__topic">
              
                /auth - Authentication & OAuth
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cozy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorials/app/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../howTos/dev/runCozyDocker/" title="How-to" class="md-tabs__link">
          How-to
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../cozy-client/getting-started/" title="Libraries" class="md-tabs__link">
          Libraries
        </a>
      
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../projects/" title="Projects" class="md-tabs__link">
          Projects
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.cozy.io/" title="Cozy Developer Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Cozy Developer Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cozy/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/app/" title="Create Your Application" class="md-nav__link">
      Create Your Application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Develop a Connector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Develop a Connector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/konnector/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/konnector/getting-started/" title="Basic structure" class="md-nav__link">
      Basic structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/konnector/scrape-data/" title="Scrape data" class="md-nav__link">
      Scrape data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/konnector/save-data/" title="Save data" class="md-nav__link">
      Save data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/konnector/packaging/" title="Package your connector" class="md-nav__link">
      Package your connector
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Manipulate data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Manipulate data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/data/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/data/queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/data/pouchdb/" title="PouchDB" class="md-nav__link">
      PouchDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/data/doctypes/" title="DocTypes" class="md-nav__link">
      DocTypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/data/qualification/" title="Qualification" class="md-nav__link">
      Qualification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/data/advanced/" title="Advanced" class="md-nav__link">
      Advanced
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/translate/" title="Translate Apps" class="md-nav__link">
      Translate Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Self-Hosting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Self-Hosting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/docker/" title="Running inside Docker" class="md-nav__link">
      Running inside Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5-3" type="checkbox" id="nav-2-5-3">
    
    <label class="md-nav__link" for="nav-2-5-3">
      Traditional installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-5-3">
        Traditional installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5-3-1" type="checkbox" id="nav-2-5-3-1">
    
    <label class="md-nav__link" for="nav-2-5-3-1">
      Requirements
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-5-3-1">
        Requirements
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/requirements/" title="What you need" class="md-nav__link">
      What you need
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/requirements/couchdb/" title="Installing CouchDB" class="md-nav__link">
      Installing CouchDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/requirements/nodejs/" title="Installing NodeJS" class="md-nav__link">
      Installing NodeJS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5-3-2" type="checkbox" id="nav-2-5-3-2">
    
    <label class="md-nav__link" for="nav-2-5-3-2">
      Installing cozy-stack
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-5-3-2">
        Installing cozy-stack
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/install/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/install/package/" title="From precompiled package" class="md-nav__link">
      From precompiled package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/install/sources/" title="From sources" class="md-nav__link">
      From sources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5-3-3" type="checkbox" id="nav-2-5-3-3">
    
    <label class="md-nav__link" for="nav-2-5-3-3">
      Finalize installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-5-3-3">
        Finalize installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/finalize/nginx/" title="Nginx and certificates" class="md-nav__link">
      Nginx and certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/finalize/apache/" title="Using Apache instead of Nginx" class="md-nav__link">
      Using Apache instead of Nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/finalize/create_instance/" title="Create first instance" class="md-nav__link">
      Create first instance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5-3-4" type="checkbox" id="nav-2-5-3-4">
    
    <label class="md-nav__link" for="nav-2-5-3-4">
      Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-2-5-3-4">
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/administration/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/administration/more_instances/" title="Create more instances" class="md-nav__link">
      Create more instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/administration/upgrade/" title="Upgrade cozy-stack" class="md-nav__link">
      Upgrade cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/administration/mail/" title="Configure mail sending" class="md-nav__link">
      Configure mail sending
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/selfhosting/administration/office/" title="Online edition of office documents" class="md-nav__link">
      Online edition of office documents
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How-to
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How-to
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Dev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Dev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/runCozyDocker/" title="Run an App in a Cozy using Docker" class="md-nav__link">
      Run an App in a Cozy using Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/services/" title="Develop a service from your application" class="md-nav__link">
      Develop a service from your application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/hmr/" title="Use Hot Module Replacement in Your App" class="md-nav__link">
      Use Hot Module Replacement in Your App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/cordova/" title="Make a Mobile App Using Cordova" class="md-nav__link">
      Make a Mobile App Using Cordova
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/connect-mobile-app-local-stack/" title="Connect a Mobile App to Your Local Stack" class="md-nav__link">
      Connect a Mobile App to Your Local Stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/run-connectors-on-local-cozy-stack/" title="Run Connectors With a Local cozy-stack" class="md-nav__link">
      Run Connectors With a Local cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/dev/sendmail/" title="Send and Receive E-mails in Development" class="md-nav__link">
      Send and Receive E-mails in Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../references/git-flow/" title="Our Front-End Git Flow" class="md-nav__link">
      Our Front-End Git Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../references/tech-intro/" title="Technical introduction to the Cozy platform" class="md-nav__link">
      Technical introduction to the Cozy platform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Synchronize
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Synchronize
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../howTos/sync/linux/" title="Install Cozy Drive on GNU/Linux" class="md-nav__link">
      Install Cozy Drive on GNU/Linux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Libraries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Libraries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Develop an application
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Develop an application
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-1" type="checkbox" id="nav-4-1-1">
    
    <label class="md-nav__link" for="nav-4-1-1">
      Access data (client)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-1">
        Access data (client)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/relationships/" title="Using relationships" class="md-nav__link">
      Using relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/timeseries/" title="Using time series" class="md-nav__link">
      Using time series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/react-integration/" title="React integration" class="md-nav__link">
      React integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/hooks/" title="Hooks" class="md-nav__link">
      Hooks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/metadata/" title="Metadata" class="md-nav__link">
      Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/node/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/api/cozy-client/" title="Cozy Client API" class="md-nav__link">
      Cozy Client API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/api/cozy-pouch-link.md" title="Cozy Pouch Link API" class="md-nav__link">
      Cozy Pouch Link API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-client/api/cozy-stack-client/" title="Cozy Stack Client API" class="md-nav__link">
      Cozy Stack Client API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-ui/" title="Build the user interface (ui)" class="md-nav__link">
      Build the user interface (ui)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1-3" type="checkbox" id="nav-4-1-3">
    
    <label class="md-nav__link" for="nav-4-1-3">
      Define data (doctypes)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-1-3">
        Define data (doctypes)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/" title="Accounts" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.ai.chat.conversations/" title="AI" class="md-nav__link">
      AI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.apps/" title="Apps" class="md-nav__link">
      Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.apps.suggestions/" title="App suggestions" class="md-nav__link">
      App suggestions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.bank/" title="Banking doctypes" class="md-nav__link">
      Banking doctypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.bills/" title="Bills" class="md-nav__link">
      Bills
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.calendar/" title="Calendar" class="md-nav__link">
      Calendar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/" title="Connectors" class="md-nav__link">
      Connectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.coachco2/" title="CoachCO2" class="md-nav__link">
      CoachCO2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/" title="Contacts" class="md-nav__link">
      Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.docrules/" title="DocRules" class="md-nav__link">
      DocRules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.files/" title="Files" class="md-nav__link">
      Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.files_metadata/" title="Files metadata" class="md-nav__link">
      Files metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.home.settings/" title="Home settings" class="md-nav__link">
      Home settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.identities/" title="Identities" class="md-nav__link">
      Identities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.notes/" title="Notes" class="md-nav__link">
      Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/" title="Notifications" class="md-nav__link">
      Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.photos/" title="Photos" class="md-nav__link">
      Photos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.procedures/" title="Procedures" class="md-nav__link">
      Procedures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/" title="Sessions Logins" class="md-nav__link">
      Sessions Logins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/" title="Sharings" class="md-nav__link">
      Sharings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.tags/" title="Tags" class="md-nav__link">
      Tags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.timeseries/" title="Time series" class="md-nav__link">
      Time series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.todos/" title="Todos" class="md-nav__link">
      Todos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.account_types/" title="Accounts Types" class="md-nav__link">
      Accounts Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/cc.cozycloud.autocategorization/" title="Autocategorization" class="md-nav__link">
      Autocategorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.exports/" title="Exports" class="md-nav__link">
      Exports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.oauth.clients/" title="OAuth Clients" class="md-nav__link">
      OAuth Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.oauth.access_codes/" title="OAuth Access Codes" class="md-nav__link">
      OAuth Access Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/" title="Triggers" class="md-nav__link">
      Triggers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.triggers.state/" title="Triggers state" class="md-nav__link">
      Triggers state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.remote.nextcloud.files/" title="Remote NextCloud files" class="md-nav__link">
      Remote NextCloud files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/" title="Remote requests" class="md-nav__link">
      Remote requests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.sessions/" title="Sessions" class="md-nav__link">
      Sessions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.shared/" title="Shared" class="md-nav__link">
      Shared
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/io.cozy.terms/" title="Terms" class="md-nav__link">
      Terms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/com.bitwarden.ciphers/" title="Bitwarden ciphers" class="md-nav__link">
      Bitwarden ciphers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/com.bitwarden.folders/" title="Bitwarden folders" class="md-nav__link">
      Bitwarden folders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/com.bitwarden.organizations/" title="Bitwarden organizations" class="md-nav__link">
      Bitwarden organizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/com.bitwarden.contacts/" title="Bitwarden contacts" class="md-nav__link">
      Bitwarden contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/com.unibet.bets/" title="Bets Unibet" class="md-nav__link">
      Bets Unibet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-doctypes/docs/cc.cozycloud.announcements/" title="Announcements" class="md-nav__link">
      Announcements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-realtime/" title="Realtime data (realtime)" class="md-nav__link">
      Realtime data (realtime)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-device-helper/" title="Native devices (device-helper)" class="md-nav__link">
      Native devices (device-helper)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Develop a konnector
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Develop a konnector
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/dev/" title="Develop" class="md-nav__link">
      Develop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/operation-linking/" title="Operation linking" class="md-nav__link">
      Operation linking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-konnector-libs/synchronization/" title="Synchronization" class="md-nav__link">
      Synchronization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-app-publish/" title="Publish on the store (app-publish)" class="md-nav__link">
      Publish on the store (app-publish)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-notifications/" title="Send notifications (cozy-notifications)" class="md-nav__link">
      Send notifications (cozy-notifications)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Dev tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Dev tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../babel-preset-cozy-app/" title="Babel preset" class="md-nav__link">
      Babel preset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../commitlint-config-cozy/" title="Commitlint" class="md-nav__link">
      Commitlint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../eslint-config-cozy-app/" title="ESLint" class="md-nav__link">
      ESLint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ach/" title="ACH" class="md-nav__link">
      ACH
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6" checked>
    
    <label class="md-nav__link" for="nav-4-6">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1" type="checkbox" id="nav-4-6-1" checked>
    
    <label class="md-nav__link" for="nav-4-6-1">
      Stack server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-6-1">
        Stack server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-2" type="checkbox" id="nav-4-6-1-2">
    
    <label class="md-nav__link" for="nav-4-6-1-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL/" title="Install the cozy-stack" class="md-nav__link">
      Install the cozy-stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/" title="Configuration file" class="md-nav__link">
      Configuration file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../instance/" title="Managing Instances" class="md-nav__link">
      Managing Instances
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cozy-stack/" title="Manpages of the command-line tool" class="md-nav__link">
      Manpages of the command-line tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../admin/" title="Using the admin API" class="md-nav__link">
      Using the admin API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../important-changes/" title="Important changes" class="md-nav__link">
      Important changes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-3" type="checkbox" id="nav-4-6-1-3">
    
    <label class="md-nav__link" for="nav-4-6-1-3">
      How-to guides for developpers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-3">
        How-to guides for developpers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../http-api/" title="Using the HTTP API" class="md-nav__link">
      Using the HTTP API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client-app-dev/" title="Develop a client-side app" class="md-nav__link">
      Develop a client-side app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="Running and building Docker images" class="md-nav__link">
      Running and building Docker images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../konnectors-dev/" title="Running a konnector locally" class="md-nav__link">
      Running a konnector locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../doctype/" title="Adding a new doctype" class="md-nav__link">
      Adding a new doctype
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../assets/" title="Working with the stack assets" class="md-nav__link">
      Working with the stack assets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../release/" title="Build a release" class="md-nav__link">
      Build a release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONTRIBUTING/" title="The contributing guide" class="md-nav__link">
      The contributing guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-4" type="checkbox" id="nav-4-6-1-4">
    
    <label class="md-nav__link" for="nav-4-6-1-4">
      Explanations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-4">
        Explanations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../flagship/" title="Flagship app" class="md-nav__link">
      Flagship app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../move-design/" title="Move design" class="md-nav__link">
      Move design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../realtime-internals/" title="Realtime internals" class="md-nav__link">
      Realtime internals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sharing-design/" title="Sharing design" class="md-nav__link">
      Sharing design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../konnectors-workflow/" title="Workflow of the konnectors" class="md-nav__link">
      Workflow of the konnectors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6-1-5" type="checkbox" id="nav-4-6-1-5" checked>
    
    <label class="md-nav__link" for="nav-4-6-1-5">
      List of services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-4-6-1-5">
        List of services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ai/" title="/ai - AI" class="md-nav__link">
      /ai - AI
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        /auth - Authentication & OAuth
      </label>
    
    <a href="./" title="/auth - Authentication & OAuth" class="md-nav__link md-nav__link--active">
      /auth - Authentication & OAuth
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-about-oauth2" title="What about OAuth2?" class="md-nav__link">
    What about OAuth2?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-cozy-stack-as-an-authorization-server" title="The cozy stack as an authorization server" class="md-nav__link">
    The cozy stack as an authorization server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-authlogin" title="GET /auth/login" class="md-nav__link">
    GET /auth/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authlogin" title="POST /auth/login" class="md-nav__link">
    POST /auth/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authtwofactor" title="POST /auth/twofactor" class="md-nav__link">
    POST /auth/twofactor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authloginflagship" title="POST /auth/login/flagship" class="md-nav__link">
    POST /auth/login/flagship
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-authlogin" title="DELETE /auth/login" class="md-nav__link">
    DELETE /auth/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-authloginothers" title="DELETE /auth/login/others" class="md-nav__link">
    DELETE /auth/login/others
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authmagic_link" title="POST /auth/magic_link" class="md-nav__link">
    POST /auth/magic_link
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authmagic_linkcode" title="GET /auth/magic_link?code=..." class="md-nav__link">
    GET /auth/magic_link?code=...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authmagic_linktwofactor" title="POST /auth/magic_link/twofactor" class="md-nav__link">
    POST /auth/magic_link/twofactor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authmagic_linkflagship" title="POST /auth/magic_link/flagship" class="md-nav__link">
    POST /auth/magic_link/flagship
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_1" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authpassphrase_reset" title="GET /auth/passphrase_reset" class="md-nav__link">
    GET /auth/passphrase_reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authhint" title="POST /auth/hint" class="md-nav__link">
    POST /auth/hint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authonboardingresend" title="POST /auth/onboarding/resend" class="md-nav__link">
    POST /auth/onboarding/resend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authpassphrase_reset" title="POST /auth/passphrase_reset" class="md-nav__link">
    POST /auth/passphrase_reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authpassphrase_renew" title="GET /auth/passphrase_renew" class="md-nav__link">
    GET /auth/passphrase_renew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authpassphrase_renew" title="POST /auth/passphrase_renew" class="md-nav__link">
    POST /auth/passphrase_renew
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authpassphrase" title="GET /auth/passphrase" class="md-nav__link">
    GET /auth/passphrase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authconfirm" title="GET /auth/confirm" class="md-nav__link">
    GET /auth/confirm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authconfirm" title="POST /auth/confirm" class="md-nav__link">
    POST /auth/confirm
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redirection" title="Redirection" class="md-nav__link">
    Redirection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-via-websockets" title="Real-time via websockets" class="md-nav__link">
    Real-time via websockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authconfirmcode" title="GET /auth/confirm/:code" class="md-nav__link">
    GET /auth/confirm/:code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authregister" title="POST /auth/register" class="md-nav__link">
    POST /auth/register
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linked-applications" title="Linked applications" class="md-nav__link">
    Linked applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authregisterclient-id" title="GET /auth/register/:client-id" class="md-nav__link">
    GET /auth/register/:client-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-authregisterclient-id" title="PUT /auth/register/:client-id" class="md-nav__link">
    PUT /auth/register/:client-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-authregisterclient-id" title="DELETE /auth/register/:client-id" class="md-nav__link">
    DELETE /auth/register/:client-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authclientsclient-idchallenge" title="POST /auth/clients/:client-id/challenge" class="md-nav__link">
    POST /auth/clients/:client-id/challenge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authclientsclient-idattestation" title="POST /auth/clients/:client-id/attestation" class="md-nav__link">
    POST /auth/clients/:client-id/attestation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authclientsclient-idflagship" title="POST /auth/clients/:client-id/flagship" class="md-nav__link">
    POST /auth/clients/:client-id/flagship
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authauthorize" title="GET /auth/authorize" class="md-nav__link">
    GET /auth/authorize
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pkce-extension" title="PKCE extension" class="md-nav__link">
    PKCE extension
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authauthorize" title="POST /auth/authorize" class="md-nav__link">
    POST /auth/authorize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authauthorizesharing-post-authauthorizesharing" title="GET /auth/authorize/sharing &amp; POST /auth/authorize/sharing" class="md-nav__link">
    GET /auth/authorize/sharing &amp; POST /auth/authorize/sharing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authauthorizemove-post-authauthorizemove" title="GET /auth/authorize/move &amp; POST /auth/authorize/move" class="md-nav__link">
    GET /auth/authorize/move &amp; POST /auth/authorize/move
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-get" title="Request GET" class="md-nav__link">
    Request GET
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-get" title="Response GET" class="md-nav__link">
    Response GET
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-post" title="Request POST" class="md-nav__link">
    Request POST
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-post" title="Response POST" class="md-nav__link">
    Response POST
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authaccess_token" title="POST /auth/access_token" class="md-nav__link">
    POST /auth/access_token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authsession_code" title="POST /auth/session_code" class="md-nav__link">
    POST /auth/session_code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-access-token-variant" title="Request (access token variant)" class="md-nav__link">
    Request (access token variant)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-passphrase-variant" title="Request (passphrase variant)" class="md-nav__link">
    Request (passphrase variant)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_2" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-2fa-needed" title="Response (2FA needed)" class="md-nav__link">
    Response (2FA needed)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faq" title="FAQ" class="md-nav__link">
    FAQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authtokenskonnectorsslug" title="POST /auth/tokens/konnectors/:slug" class="md-nav__link">
    POST /auth/tokens/konnectors/:slug
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_2" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_3" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authshare-by-linkpassword" title="POST /auth/share-by-link/password" class="md-nav__link">
    POST /auth/share-by-link/password
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_3" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_4" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faq_1" title="FAQ" class="md-nav__link">
    FAQ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side-apps" title="Client-side apps" class="md-nav__link">
    Client-side apps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-register-the-application" title="How to register the application?" class="md-nav__link">
    How to register the application?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-get-a-token" title="How to get a token?" class="md-nav__link">
    How to get a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-a-token" title="How to use a token?" class="md-nav__link">
    How to use a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-refresh-a-token" title="How to refresh a token?" class="md-nav__link">
    How to refresh a token?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#third-party-websites" title="Third-party websites" class="md-nav__link">
    Third-party websites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-register-the-application_1" title="How to register the application?" class="md-nav__link">
    How to register the application?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-get-a-token_1" title="How to get a token?" class="md-nav__link">
    How to get a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-a-token_1" title="How to use a token?" class="md-nav__link">
    How to use a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-refresh-a-token_1" title="How to refresh a token?" class="md-nav__link">
    How to refresh a token?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devices-and-browser-extensions" title="Devices and browser extensions" class="md-nav__link">
    Devices and browser extensions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#native-apps-on-desktop" title="Native apps on desktop" class="md-nav__link">
    Native apps on desktop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-apps-on-mobile" title="Native apps on mobile" class="md-nav__link">
    Native apps on mobile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chrome-extensions" title="Chrome extensions" class="md-nav__link">
    Chrome extensions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefox-extensions" title="Firefox extensions" class="md-nav__link">
    Firefox extensions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" title="Security considerations" class="md-nav__link">
    Security considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" title="Conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../delegated-auth/" title="/oidc - Delegated authentication" class="md-nav__link">
       /oidc - Delegated authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apps/" title="/apps - Applications Management" class="md-nav__link">
      /apps - Applications Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../registry/" title="/apps - Apps registry" class="md-nav__link">
       /apps - Apps registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bitwarden/" title="/bitwarden - Bitwarden" class="md-nav__link">
      /bitwarden - Bitwarden
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connection-check/" title="/connection_check - Connection check" class="md-nav__link">
      /connection_check - Connection check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../contacts/" title="/contacts - Contacts" class="md-nav__link">
      /contacts - Contacts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-system/" title="/data - Data System" class="md-nav__link">
      /data - Data System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mango/" title="/data - Mango" class="md-nav__link">
       /data - Mango
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../couchdb-quirks/" title="/data - CouchDB Quirks" class="md-nav__link">
       /data - CouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pouchdb-quirks/" title="/data - PouchDB Quirks" class="md-nav__link">
       /data - PouchDB Quirks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../files/" title="/files - Virtual File System" class="md-nav__link">
      /files - Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../not-synchronized-vfs/" title="/files - Not synchronized directories" class="md-nav__link">
       /files - Not synchronized directories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../references-docs-in-vfs/" title="/files - References of documents in VFS" class="md-nav__link">
       /files - References of documents in VFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intents/" title="/intents - Intents" class="md-nav__link">
      /intents - Intents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jobs/" title="/jobs - Jobs" class="md-nav__link">
      /jobs - Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../workers/" title="/jobs - Workers" class="md-nav__link">
       /jobs - Workers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../konnectors/" title="/konnectors - Konnectors" class="md-nav__link">
      /konnectors - Konnectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../move/" title="/move - Move, export and import an instance" class="md-nav__link">
      /move - Move, export and import an instance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../notes/" title="/notes - Notes for collaborative edition" class="md-nav__link">
      /notes - Notes for collaborative edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../notifications/" title="/notifications - Notifications" class="md-nav__link">
      /notifications - Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../office/" title="/office - Collaborative edition of Office documents" class="md-nav__link">
      /office - Collaborative edition of Office documents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../public/" title="/public - Public" class="md-nav__link">
      /public - Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../permissions/" title="/permissions - Permissions" class="md-nav__link">
      /permissions - Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../realtime/" title="/realtime - Realtime" class="md-nav__link">
      /realtime - Realtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../remote/" title="/remote - Proxy for remote data/API" class="md-nav__link">
      /remote - Proxy for remote data/API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nextcloud/" title="/remote/nextcloud - NextCloud" class="md-nav__link">
       /remote/nextcloud - NextCloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../settings/" title="/settings - Settings" class="md-nav__link">
      /settings - Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user-action-required/" title="/settings - Terms of Services" class="md-nav__link">
       /settings - Terms of Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sharing/" title="/sharings - Sharing" class="md-nav__link">
      /sharings - Sharing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../shortcuts/" title="/shortcuts - Shortcuts" class="md-nav__link">
      /shortcuts - Shortcuts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wellknown/" title="/.well-known - Well-known" class="md-nav__link">
      /.well-known - Well-known
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-apps-registry/" title="Registry server" class="md-nav__link">
      Registry server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Projects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/" title="Documentations" class="md-nav__link">
      Documentations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Cozy Desktop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Cozy Desktop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/" title="README" class="md-nav__link">
      README
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2-2" type="checkbox" id="nav-5-2-2">
    
    <label class="md-nav__link" for="nav-5-2-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/file_systems/" title="Filesystems" class="md-nav__link">
      Filesystems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/ignore_files/" title="Ignore files" class="md-nav__link">
      Ignore files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/inotify/" title="inotify" class="md-nav__link">
      inotify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/limitations/" title="Limitations" class="md-nav__link">
      Limitations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/macos/" title="MacOS" class="md-nav__link">
      MacOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/usage/windows/" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2-3" type="checkbox" id="nav-5-2-3">
    
    <label class="md-nav__link" for="nav-5-2-3">
      Developer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2-3">
        Developer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/api_doc/" title="API Documentation" class="md-nav__link">
      API Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/coffeescript.md" title="Cofeescript" class="md-nav__link">
      Cofeescript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/log_analysis/" title="Log analysis" class="md-nav__link">
      Log analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/requirements/" title="Requirements" class="md-nav__link">
      Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/developer/setup/" title="Test" class="md-nav__link">
      Test
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cozy-desktop/feedback/" title="Feddback" class="md-nav__link">
      Feddback
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-about-oauth2" title="What about OAuth2?" class="md-nav__link">
    What about OAuth2?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-cozy-stack-as-an-authorization-server" title="The cozy stack as an authorization server" class="md-nav__link">
    The cozy stack as an authorization server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-authlogin" title="GET /auth/login" class="md-nav__link">
    GET /auth/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authlogin" title="POST /auth/login" class="md-nav__link">
    POST /auth/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authtwofactor" title="POST /auth/twofactor" class="md-nav__link">
    POST /auth/twofactor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authloginflagship" title="POST /auth/login/flagship" class="md-nav__link">
    POST /auth/login/flagship
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-authlogin" title="DELETE /auth/login" class="md-nav__link">
    DELETE /auth/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-authloginothers" title="DELETE /auth/login/others" class="md-nav__link">
    DELETE /auth/login/others
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authmagic_link" title="POST /auth/magic_link" class="md-nav__link">
    POST /auth/magic_link
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authmagic_linkcode" title="GET /auth/magic_link?code=..." class="md-nav__link">
    GET /auth/magic_link?code=...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authmagic_linktwofactor" title="POST /auth/magic_link/twofactor" class="md-nav__link">
    POST /auth/magic_link/twofactor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authmagic_linkflagship" title="POST /auth/magic_link/flagship" class="md-nav__link">
    POST /auth/magic_link/flagship
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_1" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authpassphrase_reset" title="GET /auth/passphrase_reset" class="md-nav__link">
    GET /auth/passphrase_reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authhint" title="POST /auth/hint" class="md-nav__link">
    POST /auth/hint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authonboardingresend" title="POST /auth/onboarding/resend" class="md-nav__link">
    POST /auth/onboarding/resend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authpassphrase_reset" title="POST /auth/passphrase_reset" class="md-nav__link">
    POST /auth/passphrase_reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authpassphrase_renew" title="GET /auth/passphrase_renew" class="md-nav__link">
    GET /auth/passphrase_renew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authpassphrase_renew" title="POST /auth/passphrase_renew" class="md-nav__link">
    POST /auth/passphrase_renew
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authpassphrase" title="GET /auth/passphrase" class="md-nav__link">
    GET /auth/passphrase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authconfirm" title="GET /auth/confirm" class="md-nav__link">
    GET /auth/confirm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authconfirm" title="POST /auth/confirm" class="md-nav__link">
    POST /auth/confirm
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redirection" title="Redirection" class="md-nav__link">
    Redirection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-via-websockets" title="Real-time via websockets" class="md-nav__link">
    Real-time via websockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authconfirmcode" title="GET /auth/confirm/:code" class="md-nav__link">
    GET /auth/confirm/:code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authregister" title="POST /auth/register" class="md-nav__link">
    POST /auth/register
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linked-applications" title="Linked applications" class="md-nav__link">
    Linked applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authregisterclient-id" title="GET /auth/register/:client-id" class="md-nav__link">
    GET /auth/register/:client-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-authregisterclient-id" title="PUT /auth/register/:client-id" class="md-nav__link">
    PUT /auth/register/:client-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-authregisterclient-id" title="DELETE /auth/register/:client-id" class="md-nav__link">
    DELETE /auth/register/:client-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authclientsclient-idchallenge" title="POST /auth/clients/:client-id/challenge" class="md-nav__link">
    POST /auth/clients/:client-id/challenge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authclientsclient-idattestation" title="POST /auth/clients/:client-id/attestation" class="md-nav__link">
    POST /auth/clients/:client-id/attestation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authclientsclient-idflagship" title="POST /auth/clients/:client-id/flagship" class="md-nav__link">
    POST /auth/clients/:client-id/flagship
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authauthorize" title="GET /auth/authorize" class="md-nav__link">
    GET /auth/authorize
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pkce-extension" title="PKCE extension" class="md-nav__link">
    PKCE extension
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authauthorize" title="POST /auth/authorize" class="md-nav__link">
    POST /auth/authorize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authauthorizesharing-post-authauthorizesharing" title="GET /auth/authorize/sharing &amp; POST /auth/authorize/sharing" class="md-nav__link">
    GET /auth/authorize/sharing &amp; POST /auth/authorize/sharing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-authauthorizemove-post-authauthorizemove" title="GET /auth/authorize/move &amp; POST /auth/authorize/move" class="md-nav__link">
    GET /auth/authorize/move &amp; POST /auth/authorize/move
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-get" title="Request GET" class="md-nav__link">
    Request GET
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-get" title="Response GET" class="md-nav__link">
    Response GET
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-post" title="Request POST" class="md-nav__link">
    Request POST
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-post" title="Response POST" class="md-nav__link">
    Response POST
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authaccess_token" title="POST /auth/access_token" class="md-nav__link">
    POST /auth/access_token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authsession_code" title="POST /auth/session_code" class="md-nav__link">
    POST /auth/session_code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-access-token-variant" title="Request (access token variant)" class="md-nav__link">
    Request (access token variant)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-passphrase-variant" title="Request (passphrase variant)" class="md-nav__link">
    Request (passphrase variant)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_2" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-2fa-needed" title="Response (2FA needed)" class="md-nav__link">
    Response (2FA needed)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faq" title="FAQ" class="md-nav__link">
    FAQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authtokenskonnectorsslug" title="POST /auth/tokens/konnectors/:slug" class="md-nav__link">
    POST /auth/tokens/konnectors/:slug
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_2" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_3" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-authshare-by-linkpassword" title="POST /auth/share-by-link/password" class="md-nav__link">
    POST /auth/share-by-link/password
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_3" title="Request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_4" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faq_1" title="FAQ" class="md-nav__link">
    FAQ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side-apps" title="Client-side apps" class="md-nav__link">
    Client-side apps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-register-the-application" title="How to register the application?" class="md-nav__link">
    How to register the application?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-get-a-token" title="How to get a token?" class="md-nav__link">
    How to get a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-a-token" title="How to use a token?" class="md-nav__link">
    How to use a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-refresh-a-token" title="How to refresh a token?" class="md-nav__link">
    How to refresh a token?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#third-party-websites" title="Third-party websites" class="md-nav__link">
    Third-party websites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-register-the-application_1" title="How to register the application?" class="md-nav__link">
    How to register the application?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-get-a-token_1" title="How to get a token?" class="md-nav__link">
    How to get a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-a-token_1" title="How to use a token?" class="md-nav__link">
    How to use a token?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-refresh-a-token_1" title="How to refresh a token?" class="md-nav__link">
    How to refresh a token?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devices-and-browser-extensions" title="Devices and browser extensions" class="md-nav__link">
    Devices and browser extensions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#native-apps-on-desktop" title="Native apps on desktop" class="md-nav__link">
    Native apps on desktop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-apps-on-mobile" title="Native apps on mobile" class="md-nav__link">
    Native apps on mobile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chrome-extensions" title="Chrome extensions" class="md-nav__link">
    Chrome extensions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefox-extensions" title="Firefox extensions" class="md-nav__link">
    Firefox extensions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" title="Security considerations" class="md-nav__link">
    Security considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" title="Conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cozy/cozy.github.io/edit/dev/src/cozy-stack/auth.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><a href="../#table-of-contents">Table of contents</a></p>
<h1 id="authentication-and-access-delegations">Authentication and access delegations<a class="headerlink" href="#authentication-and-access-delegations" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this document, we will cover how to protect the usage of the cozy-stack. When
the cozy-stack receives a request, it checks that the request is authorized, and
if yes, it processes it and answers it.</p>
<h2 id="what-about-oauth2">What about OAuth2?<a class="headerlink" href="#what-about-oauth2" title="Permanent link">&para;</a></h2>
<p>OAuth2 is about delegating an access to resources on a server to another party.
It is a framework, not a strictly defined protocol, for organizing the
interactions between these 4 actors:</p>
<ul>
<li>the resource owner, the &ldquo;user&rdquo; that can click on buttons</li>
<li>the client, the website or application that would like to access the
    resources</li>
<li>the authorization server, whose role is limited to give tokens but is
    central in OAuth2 interactions</li>
<li>the resources server, the server that controls the resources.</li>
</ul>
<p>For cozy, both the authorization server and the resources server roles are
played by the cozy-stack. The resource owner is the owner of a cozy instance.
The client can be the cozy-desktop app, cozy-mobile, or many other applications.</p>
<p>OAuth2, and its extensions, is a large world. At its core, there is 2 things:
letting the client get a token issued by the authorization server, and using
this token to access to the resources. OAuth2 describe 4 flows, called grant
types, for the first part:</p>
<ul>
<li>Authorization code</li>
<li>Implicit grant type</li>
<li>Client credentials grant type</li>
<li>Resource owner credentials grant type.</li>
</ul>
<p>On cozy, only the most typical one is used: authorization code. To start this
flow, the client must have a <code>client_id</code> and <code>client_secret</code>. The Cozy stack
implements the OAuth2 Dynamic Client Registration Protocol (an extension to
OAuth2) to allow the clients to obtain them.</p>
<p>OAuth2 has also 3 ways to use a token:</p>
<ul>
<li>in the query-string (even if the spec does not recommended it)</li>
<li>in the POST body</li>
<li>in the HTTP Authorization header.</li>
</ul>
<p>On cozy, only the HTTP header is supported.</p>
<p>OAuth2 has a lot of assumptions. Let&rsquo;s see some of them and their consequences
on Cozy:</p>
<ul>
<li>
<p>TLS is very important to secure the communications. in OAuth 1, there was a
    mechanism to sign the requests. But it was very difficult to get it right
    for the developers and was abandonned in OAuth2, in favor of using TLS. The
    Cozy instance are already accessible only in HTTPS, so there is nothing
    particular to do for that.</p>
</li>
<li>
<p>There is a principle called TOFU, Trust On First Use. It said that if the
    user will give his permission for delegating access to its resources when
    the client will try to access them for the first time. Later, the client
    will be able to keep accessing them even if the user is no longer here to
    give his permissions.</p>
</li>
<li>
<p>The client can&rsquo;t make the assumptions about when its tokens will work. The
    tokens have no meaning for him (like cookies in a browser), they are just
    something it got from the authorization server and can send with its
    request. The access token can expire, the user can revoke them, etc.</p>
</li>
<li>
<p>OAuth 2.0 defines no cryptographic methods. But a developer that want to use
    it will have to put her hands in that.</p>
</li>
</ul>
<p>If you want to learn OAuth 2 in details, I recommend the
<a href="https://www.manning.com/books/oauth-2-in-action">OAuth 2 in Action book</a>.</p>
<h2 id="the-cozy-stack-as-an-authorization-server">The cozy stack as an authorization server<a class="headerlink" href="#the-cozy-stack-as-an-authorization-server" title="Permanent link">&para;</a></h2>
<p>In general, the cozy stack manages the authentication itself. This is what is
described below. In some special cases, an integration with other softwares can
be mandatory: this is possible to configure via
<a href="../delegated-auth/">delegated authentication</a>.</p>
<h3 id="get-authlogin">GET /auth/login<a class="headerlink" href="#get-authlogin" title="Permanent link">&para;</a></h3>
<p>Display a form with a password field to let the user authenticates herself to
the cozy stack.</p>
<p>This endpoint accepts a <code>redirect</code> parameter. If the user is already logged in,
she will be redirected immediately. Else, the parameter will be transfered in
the POST. This parameter can only contain a link to an application installed on
the cozy (thus to a subdomain of the cozy instance). To protect against stealing
authorization code with redirection, the fragment is always overriden:</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/login?redirect=https://contacts.cozy.example.org/foo?bar#baz</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">...</span>
</pre></div>


<p><strong>Note</strong>: the redirect parameter should be URL-encoded. We haven&rsquo;t done that to
make it clear what the path (<code>foo</code>), the query-string (<code>bar</code>), and the fragment
(<code>baz</code>) are.</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Moved Temporarily</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://contacts.cozy.example.org/foo?bar#</span>
</pre></div>


<p>If the <code>redirect</code> parameter is invalid, the response will be <code>400 Bad Request</code>.
Same for other parameters, the redirection will happen only on success (even if
OAuth2 says the authorization server can redirect on errors, it&rsquo;s very
complicated to do it safely, and it is better to avoid this trap).</p>
<h3 id="post-authlogin">POST /auth/login<a class="headerlink" href="#post-authlogin" title="Permanent link">&para;</a></h3>
<p>After the user has typed her passphrase and clicked on <code>Login</code>, a request is
made to this endpoint.</p>
<p>The <code>redirect</code> parameter is passed inside the body. If it is missing, the
redirection will be made against the default target: the home application of
this cozy instance. The redirect can be a full URL (like
<code>http://cozy-drive.example.org/#/folder</code>), or just a slug+path+hash (like
<code>drive/#/folder</code>).</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/login</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

passphrase=p4ssw0rd&amp;redirect=https%3A%2F%2Fcontacts.cozy.example.org
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Moved Temporarily</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">...</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://contacts.cozy.example.org/foo</span>
</pre></div>


<p>When two-factor authentication (2FA) authentication is activated, this endpoint
will not directly sent a redirection after this first passphrase step. In such
case, a <code>200 OK</code> response is sent along with a token value in the response
(either in JSON if requested or directly in a new HTML form).</p>
<p>Along with this token, a 2FA passcode is sent to the user via another transport
(email for instance, depending on the user&rsquo;s preferences). Another request
should be sent to <code>/auth/twofactor</code> with a valid pair <code>(token, passcode)</code>,
ensuring that the user correctly entered its passphrase <em>and</em> received a fresh
passcode by another mean.</p>
<h3 id="post-authtwofactor">POST /auth/twofactor<a class="headerlink" href="#post-authtwofactor" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/twofactor</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

two-factor-token=123123123123&amp;two-factor-passcode=678678&amp;redirect=https%3A%2F%2Fcontacts.cozy.example.org
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Moved Temporarily</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">...</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://contacts.cozy.example.org/foo</span>
</pre></div>


<h3 id="post-authloginflagship">POST /auth/login/flagship<a class="headerlink" href="#post-authloginflagship" title="Permanent link">&para;</a></h3>
<p>This endpoint is similar to <code>POST /auth/login</code>, but it allows the flagship app
to also obtain OAuth access and register tokens without having to make the
OAuth dance (which can be awkward for the user).</p>
<h4 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/login/flagship</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;passphrase&quot;</span><span class="p">:</span> <span class="s2">&quot;4f58133ea0f415424d0a856e0d3d2e0cd28e4358fce7e333cb524729796b2791&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span>
<span class="p">}</span>
</pre></div>


<h4 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;OWY0MjNjMGEtOTNmNi0xMWVjLWIyZGItN2I5YjgwNmRjYzBiCg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;YTUwMjcyYjgtOTNmNi0xMWVjLWE4YTQtZWJhMzlmMTAwMWJiCg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
<span class="p">}</span>
</pre></div>


<p><strong>Note:</strong> if two-factor authentication is enabled on the Cozy, an email
will be sent to the user with a code, and this request will return:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;two_factor_token&quot;</span><span class="p">:</span> <span class="s2">&quot;123123123123&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Then, the client can retry by sending the two-factor token and code:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;passphrase&quot;</span><span class="p">:</span> <span class="s2">&quot;4f58133ea0f415424d0a856e0d3d2e0cd28e4358fce7e333cb524729796b2791&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span><span class="p">,</span>
  <span class="nt">&quot;two_factor_token&quot;</span><span class="p">:</span> <span class="s2">&quot;123123123123&quot;</span><span class="p">,</span>
  <span class="nt">&quot;two_factor_code&quot;</span><span class="p">:</span> <span class="s2">&quot;123456&quot;</span>
<span class="p">}</span>
</pre></div>


<p><strong>Note:</strong> if the two-factor authentication is enabled, and the cloudery has
already verified the email address, a parameter <code>email_verified_code</code> can be sent
to skip another 2FA code sent by mail.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;passphrase&quot;</span><span class="p">:</span> <span class="s2">&quot;4f58133ea0f415424d0a856e0d3d2e0cd28e4358fce7e333cb524729796b2791&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email_verified_code&quot;</span><span class="p">:</span> <span class="s2">&quot;987456321&quot;</span>
<span class="p">}</span>
</pre></div>


<p><strong>Note:</strong> if the OAuth client has not been certified as the flagship app,
this request will return:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">202</span> <span class="ne">Accepted</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;session_code&quot;</span><span class="p">:</span> <span class="s2">&quot;ZmY4ODI3NGMtOTY1Yy0xMWVjLThkMDgtMmI5M2&quot;</span>
<span class="p">}</span>
</pre></div>


<p>The <code>session_code</code> can be put in the query string while opening the OAuth
authorize page. It will be used to open the session, and let the user type the
6-digits code they have received by mail to confirm that they want to use this
app as the flagship app.</p>
<h3 id="delete-authlogin">DELETE /auth/login<a class="headerlink" href="#delete-authlogin" title="Permanent link">&para;</a></h3>
<p>This can be used to log-out the user. An app token must be passed in the
<code>Authorization</code> header, to protect against CSRF attack on this (this can part of
bigger attacks like session fixation).</p>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/auth/login</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">seesioncookie....</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer app-token</span>
</pre></div>


<h3 id="delete-authloginothers">DELETE /auth/login/others<a class="headerlink" href="#delete-authloginothers" title="Permanent link">&para;</a></h3>
<p>This can be used to log-out all active sessions except the one used by the
request. This allow to disconnect any other users currenctly authenticated on
the system. An app token must be passed in the <code>Authorization</code> header, to
protect against CSRF attack on this (this can part of bigger attacks like
session fixation).</p>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/auth/login/others</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">seesioncookie....</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer app-token</span>
</pre></div>


<h3 id="post-authmagic_link">POST /auth/magic_link<a class="headerlink" href="#post-authmagic_link" title="Permanent link">&para;</a></h3>
<p>If the authentication via magic link is enabled on this instance, this endpoint
will send an email to the user with a magic link. If the user clicks on this
link, they will be authenticated on the Cozy.</p>
<h3 id="get-authmagic_linkcode">GET /auth/magic_link?code=&hellip;<a class="headerlink" href="#get-authmagic_linkcode" title="Permanent link">&para;</a></h3>
<p>When the user has received an email with a magic link, the link goes to the
endpoint, where the user will be allowed to enter the Cozy.</p>
<h3 id="post-authmagic_linktwofactor">POST /auth/magic_link/twofactor<a class="headerlink" href="#post-authmagic_linktwofactor" title="Permanent link">&para;</a></h3>
<p>When two-factor authentication is enabled on a Cozy, this endpoint can be used
to create a session.</p>
<h3 id="post-authmagic_linkflagship">POST /auth/magic_link/flagship<a class="headerlink" href="#post-authmagic_linkflagship" title="Permanent link">&para;</a></h3>
<p>This endpoint allows the flagship app to also obtain OAuth access and register
tokens without having to make the OAuth dance (which can be awkward for the
user). It requires a code sent by email to the user.</p>
<h4 id="request_1">Request<a class="headerlink" href="#request_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/magic_link/flagship</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">alice.example.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;magic_code&quot;</span><span class="p">:</span> <span class="s2">&quot;ODFhNzkxYTAtYjZiYi0wMTNiLTE1YzQtMThjMDRkYWJhMzI2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_1">Response<a class="headerlink" href="#response_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;OWY0MjNjMGEtOTNmNi0xMWVjLWIyZGItN2I5YjgwNmRjYzBiCg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;YTUwMjcyYjgtOTNmNi0xMWVjLWE4YTQtZWJhMzlmMTAwMWJiCg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
<span class="p">}</span>
</pre></div>


<p><strong>Note:</strong> if two-factor authentication is enabled on the Cozy, an email
will be sent to the user with a code, and this request will return:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;passphrase is required as second authentication factor&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Then, the client can retry by sending the two-factor token and code:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;magic_code&quot;</span><span class="p">:</span> <span class="s2">&quot;ODFhNzkxYTAtYjZiYi0wMTNiLTE1YzQtMThjMDRkYWJhMzI2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span><span class="p">,</span>
  <span class="nt">&quot;passphrase&quot;</span><span class="p">:</span> <span class="s2">&quot;4f58133ea0f415424d0a856e0d3d2e0cd28e4358fce7e333cb524729796b2791&quot;</span>
<span class="p">}</span>
</pre></div>


<p><strong>Note:</strong> if the OAuth client has not been certified as the flagship app,
this request will return:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">202</span> <span class="ne">Accepted</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;session_code&quot;</span><span class="p">:</span> <span class="s2">&quot;ZmY4ODI3NGMtOTY1Yy0xMWVjLThkMDgtMmI5M2&quot;</span>
<span class="p">}</span>
</pre></div>


<p>The <code>session_code</code> can be put in the query string while opening the OAuth
authorize page. It will be used to open the session, and let the user type the
6-digits code they have received by mail to confirm that they want to use this
app as the flagship app.</p>
<h3 id="get-authpassphrase_reset">GET /auth/passphrase_reset<a class="headerlink" href="#get-authpassphrase_reset" title="Permanent link">&para;</a></h3>
<p>Display a form for the user to reset its password, in case he has forgotten it
for example. If the user is connected, he won&rsquo;t be shown this form and he will
be directly redirected to his cozy.</p>
<p>This endpoint accepts a <code>hideBackButton</code> parameter. If this parameter is present
and set to <code>true</code> then the passphrase reset page won&rsquo;t display any button to go
back to the login page.
This is useful when this page is opened in a different context from the one in
which the login page was opened (e.g. a browser vs a mobile native application).</p>
<p>It is also possible to use <code>from=settings</code> parameter in the query-string, to go
back to the settings app after the password has been reset. It is useful when
the user wants to change their email address, as the process for changing this
address requires the password.</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/passphrase_reset?hideBackButton=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">...</span>
</pre></div>


<h3 id="post-authhint">POST /auth/hint<a class="headerlink" href="#post-authhint" title="Permanent link">&para;</a></h3>
<p>Send the password hint by email.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/hint</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
</pre></div>


<h3 id="post-authonboardingresend">POST /auth/onboarding/resend<a class="headerlink" href="#post-authonboardingresend" title="Permanent link">&para;</a></h3>
<p>Resend the activation link by email to finalize the onboarding.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/onboarding/resend</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
</pre></div>


<h3 id="post-authpassphrase_reset">POST /auth/passphrase_reset<a class="headerlink" href="#post-authpassphrase_reset" title="Permanent link">&para;</a></h3>
<p>After the user has clicked on the reset button of the passphrase reset form, it
will execute a request to this endpoint.</p>
<p>This endpoint will create a token for the user to actually renew his passphrase.
The token has a short-live duration of about 15 minutes. After the token is
created, it is sent to the user on its mailbox.</p>
<p>This endpoint will redirect the user on the login form page.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/passphrase_reset</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

csrf_token=123456890
</pre></div>


<h3 id="get-authpassphrase_renew">GET /auth/passphrase_renew<a class="headerlink" href="#get-authpassphrase_renew" title="Permanent link">&para;</a></h3>
<p>Display a form for the user to enter a new password. This endpoint should be
used with a <code>token</code> query parameter. This token makes sure that the user has
actually reset its passphrase and should have been sent via its mailbox.</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/passphrase_renew?token=123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">...</span>
</pre></div>


<h3 id="post-authpassphrase_renew">POST /auth/passphrase_renew<a class="headerlink" href="#post-authpassphrase_renew" title="Permanent link">&para;</a></h3>
<p>After the user has entered its new passphrase in the renew passphrase form, a
request is made to this endpoint to renew the passphrase.</p>
<p>This endpoint requires a valid token to actually work. In case of a success, the
user is redirected to the login form.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/passphrase_reset</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

csrf_token=123456890&amp;passphrase_reset_token=123456789&amp;passphrase=mynewpassphrase
</pre></div>


<h4 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Form parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>passphrase_reset_token</td>
<td>the token to authenticate the request</td>
</tr>
<tr>
<td>csrf_token</td>
<td>the token to protect against CSRF attacks</td>
</tr>
<tr>
<td>passphrase</td>
<td>the new password</td>
</tr>
<tr>
<td>hint</td>
<td>the hint to find again the password</td>
</tr>
<tr>
<td>iterations</td>
<td>the number of PBKDF2 iterations</td>
</tr>
<tr>
<td>key</td>
<td>the encrypted master key for bitwarden</td>
</tr>
<tr>
<td>public_key</td>
<td>the public key for the cozy organization</td>
</tr>
<tr>
<td>private_key</td>
<td>the private key for the cozy organization</td>
</tr>
</tbody>
</table>
<h3 id="get-authpassphrase">GET /auth/passphrase<a class="headerlink" href="#get-authpassphrase" title="Permanent link">&para;</a></h3>
<p>This page renders a form to set the password for an onboarding instance. This
endpoint expects a valid <code>registerToken</code> parameter.</p>
<p>In case of success, the instance is marked as onboarded and the user is
redirected to his home.</p>
<p>If the instance is already onboarded, the user is redirected to his home.</p>
<p>It is also possible to give a <code>redirection</code> parameter to redirect the user to
another application.</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/passphrase/?registerToken=e0fbe2c5b90cdcdd9b3487b48b480e0b&amp;redirection=drive/%23/files</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html</span>
</pre></div>


<h3 id="get-authconfirm">GET /auth/confirm<a class="headerlink" href="#get-authconfirm" title="Permanent link">&para;</a></h3>
<p>An application can ask the user to re-authenticate them-selves before making an
important action (like erasing a pin code). To do that, the application will
sent the user to this page where the stack will show a form.</p>
<p>Two parameters in the query string can be sent:</p>
<ul>
<li><code>state</code> (mandatory), which can be seen as an identifier for the confirmation</li>
<li><code>redirect</code> (optional), where the user will be redirected after the confirmation.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/confirm?state=51814f30-5818-0139-9348-543d7eb8149c&amp;redirect=http://banks.cozy.localhost:8080/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>


<p>The application can know the user has confirmed their identity by subscribing
to a real-time event or by looking at the URL after the redirection. The URL
must contain the state given by the app, and a code that can be checked by
calling <code>POST /auth/confirm/code</code> (see below).</p>
<h3 id="post-authconfirm">POST /auth/confirm<a class="headerlink" href="#post-authconfirm" title="Permanent link">&para;</a></h3>
<p>Send the hashed password for confirming the authentication.</p>
<h4 id="redirection">Redirection<a class="headerlink" href="#redirection" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Moved Temporarily</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">http://banks.cozy.localhost:8080/?state=51814f30-5818-0139-9348-543d7eb8149c&amp;code=543d7eb8149c</span>
</pre></div>


<h4 id="real-time-via-websockets">Real-time via websockets<a class="headerlink" href="#real-time-via-websockets" title="Permanent link">&para;</a></h4>
<p>If it succeeds, a real-time event will be sent:</p>
<div class="codehilite"><pre><span></span>client &gt; {&quot;method&quot;: &quot;AUTH&quot;,
          &quot;payload&quot;: &quot;xxAppOrAuthTokenxx=&quot;}
client &gt; {&quot;method&quot;: &quot;SUBSCRIBE&quot;,
          &quot;payload&quot;: {&quot;type&quot;: &quot;io.cozy.auth.confirmations&quot;}}
server &gt; {&quot;event&quot;: &quot;CREATED&quot;,
          &quot;payload&quot;: {&quot;id&quot;: &quot;51814f30-5818-0139-9348-543d7eb8149c&quot;,
                      &quot;type&quot;: &quot;io.cozy.auth.confirmations&quot;}}
</pre></div>


<h3 id="get-authconfirmcode">GET /auth/confirm/:code<a class="headerlink" href="#get-authconfirmcode" title="Permanent link">&para;</a></h3>
<p>Send the code from the URL to check that the user has really confirmed their
identity (and not just typed the URL them-self).</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/confirm/543d7eb8149c</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>


<p>The response will be a 204 No Content if the code is valid (and a 401 else).</p>
<h3 id="post-authregister">POST /auth/register<a class="headerlink" href="#post-authregister" title="Permanent link">&para;</a></h3>
<p>This route is used by OAuth2 clients to dynamically register them-selves.</p>
<p>See
<a href="https://tools.ietf.org/html/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a>
for the details.</p>
<p>The client must send a JSON request, with at least:</p>
<ul>
<li><code>redirect_uris</code>, an array of strings with the redirect URIs that the client
    will use in the authorization flow</li>
<li><code>client_name</code>, human-readable string name of the client to be presented to
    the end-user during authorization</li>
<li><code>software_id</code>, an identifier of the software used by the client (it should
    remain the same for all instances of the client software, whereas
    <code>client_id</code> varies between instances).</li>
</ul>
<p>It can also send the optional fields:</p>
<ul>
<li><code>client_kind</code> (possible values: web, desktop, mobile, browser, etc.)</li>
<li><code>client_uri</code>, URL string of a web page providing information about the
    client</li>
<li><code>logo_uri</code>, to display an icon to the user in the authorization flow</li>
<li><code>policy_uri</code>, URL string that points to a human-readable privacy policy
    document that describes how the deployment organization collects, uses,
    retains, and discloses personal data</li>
<li><code>software_version</code>, a version identifier string for the client software.</li>
<li><code>notification_platform</code>, to activate notifications on the associated device,
    this field specify the platform used to send notifications:<ul>
<li><code>"android"</code>: for Android devices with notifications via Firebase Cloud
  Messaging</li>
<li><code>"ios"</code>: for iOS devices with notifications via Firebase Cloud
  Messaging or APNS/2</li>
<li><code>"huawei"</code>: for huawei devices with Push Kit</li>
</ul>
</li>
<li><code>notification_device_token</code>, the token used to identify the mobile device
    for notifications.</li>
</ul>
<p>The server gives to the client the previous fields and these informations:</p>
<ul>
<li><code>client_id</code></li>
<li><code>client_secret</code></li>
<li><code>registration_access_token</code></li>
</ul>
<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/register</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;redirect_uris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://client.example.org/oauth/callback&quot;</span><span class="p">],</span>
    <span class="nt">&quot;client_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_id&quot;</span><span class="p">:</span> <span class="s2">&quot;github.com/example/client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/&quot;</span><span class="p">,</span>
    <span class="nt">&quot;logo_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/logo.svg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;policy_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client/example.org/policy&quot;</span>
<span class="p">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret_expires_at&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;registration_access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;J9l-ZhwP[...omitted for brevity...]&quot;</span><span class="p">,</span>
    <span class="nt">&quot;grant_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span>
    <span class="nt">&quot;response_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">],</span>
    <span class="nt">&quot;redirect_uris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://client.example.org/oauth/callback&quot;</span><span class="p">],</span>
    <span class="nt">&quot;client_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_id&quot;</span><span class="p">:</span> <span class="s2">&quot;github.com/example/client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/&quot;</span><span class="p">,</span>
    <span class="nt">&quot;logo_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/logo.svg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;policy_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client/example.org/policy&quot;</span>
<span class="p">}</span>
</pre></div>


<h4 id="linked-applications">Linked applications<a class="headerlink" href="#linked-applications" title="Permanent link">&para;</a></h4>
<p>Some OAuth applications are a mobile or desktop version of a Cozy webapp. For
them, it&rsquo;s possible to use a special <code>software_id</code> to make a link between the
mobile/desktop application and the webapp. The <code>software_id</code> must be in a
<code>registry://slug</code> format, like <code>registry://drive</code> for Cozy-Drive for example.
When it is the case, the mobile/desktop will share its permissions with the
webapp. It means several things:</p>
<ul>
<li>The mobile/desktop app will have the same permissions that the linked webapp.</li>
<li>When a sharing by link is done in the mobile/desktop application, the linked
  webapp will be able to revoke it later, and vice versa.</li>
<li>When the user accepts to give access to its Cozy to the mobile/desktop app,
  the linked webapp will be installed on the Cozy if it was not already the
  case.</li>
<li>When the linked webapp is uninstalled, the right to access the Cozy for the
  mobile/desktop app will be revoked.</li>
</ul>
<h3 id="get-authregisterclient-id">GET /auth/register/:client-id<a class="headerlink" href="#get-authregisterclient-id" title="Permanent link">&para;</a></h3>
<p>This route is used by the clients to get informations about them-selves. The
client has to send its registration access token to be able to use this
endpoint.</p>
<p>See
<a href="https://tools.ietf.org/html/rfc7592">OAuth 2.0 Dynamic Client Registration Management Protocol</a>
for more details.</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/register/64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer J9l-ZhwP...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret_expires_at&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;grant_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span>
    <span class="nt">&quot;response_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">],</span>
    <span class="nt">&quot;redirect_uris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://client.example.org/oauth/callback&quot;</span><span class="p">],</span>
    <span class="nt">&quot;client_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_id&quot;</span><span class="p">:</span> <span class="s2">&quot;github.com/example/client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/&quot;</span><span class="p">,</span>
    <span class="nt">&quot;logo_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/logo.svg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;policy_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client/example.org/policy&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="put-authregisterclient-id">PUT /auth/register/:client-id<a class="headerlink" href="#put-authregisterclient-id" title="Permanent link">&para;</a></h3>
<p>This route is used by the clients to update informations about them-selves. The
client has to send its registration access token to be able to use this
endpoint.</p>
<p><strong>Note:</strong> the client can ask to change its <code>client_secret</code>. To do that, it must
send the current <code>client_secret</code>, and the server will respond with the new
<code>client_secret</code>.</p>
<div class="codehilite"><pre><span></span><span class="nf">PUT</span> <span class="nn">/auth/register/64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer J9l-ZhwP...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJpc3Mi[...omitted for brevity...]&quot;</span><span class="p">,</span>
    <span class="nt">&quot;redirect_uris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://client.example.org/oauth/callback&quot;</span><span class="p">],</span>
    <span class="nt">&quot;client_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_id&quot;</span><span class="p">:</span> <span class="s2">&quot;github.com/example/client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/&quot;</span><span class="p">,</span>
    <span class="nt">&quot;logo_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/client-logo.svg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;policy_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client/example.org/policy&quot;</span><span class="p">,</span>
    <span class="nt">&quot;notification_platform&quot;</span><span class="p">:</span> <span class="s2">&quot;android&quot;</span><span class="p">,</span>
    <span class="nt">&quot;notification_device_token&quot;</span><span class="p">:</span> <span class="s2">&quot;XXXXxxxx...&quot;</span>
<span class="p">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;IFais2Ah[...omitted for brevity...]&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_secret_expires_at&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;grant_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">],</span>
    <span class="nt">&quot;response_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">],</span>
    <span class="nt">&quot;redirect_uris&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://client.example.org/oauth/callback&quot;</span><span class="p">],</span>
    <span class="nt">&quot;client_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_id&quot;</span><span class="p">:</span> <span class="s2">&quot;github.com/example/client&quot;</span><span class="p">,</span>
    <span class="nt">&quot;software_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
    <span class="nt">&quot;client_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/&quot;</span><span class="p">,</span>
    <span class="nt">&quot;logo_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client.example.org/client-logo.svg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;policy_uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://client/example.org/policy&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="delete-authregisterclient-id">DELETE /auth/register/:client-id<a class="headerlink" href="#delete-authregisterclient-id" title="Permanent link">&para;</a></h3>
<p>This route is used by the clients to unregister them-selves. The client has to
send its registration access token to be able to use this endpoint.</p>
<div class="codehilite"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/auth/register/64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer J9l-ZhwP...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="post-authclientsclient-idchallenge">POST /auth/clients/:client-id/challenge<a class="headerlink" href="#post-authclientsclient-idchallenge" title="Permanent link">&para;</a></h3>
<p>This route can be used to start the process for certifying that an app is
really what it tells to be by using the android/iOS APIs
(PlayIntegrity/SafetyNet/AppleAttestation). It returns a nonce that must be
used in the certificate.</p>
<p>The client must send its registration access token to use this endpoint.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/clients/64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3/challenge</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer J9l-ZhwP...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;nonce&quot;</span><span class="p">:</span> <span class="s2">&quot;MmE3OTM1ZDItNWY0ZC0xMWVjLTg3NT&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-authclientsclient-idattestation">POST /auth/clients/:client-id/attestation<a class="headerlink" href="#post-authclientsclient-idattestation" title="Permanent link">&para;</a></h3>
<p>This route can be used to finish the process for certifying that an app is
really what it tells to be by using the android/iOS APIs. The client can send
its attestation.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/clients/64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3/attestation</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;android&quot;</span><span class="p">,</span>
  <span class="nt">&quot;challenge&quot;</span><span class="p">:</span> <span class="s2">&quot;MmE3OTM1ZDItNWY0ZC0xMWVjLTg3NT&quot;</span><span class="p">,</span>
  <span class="nt">&quot;attestation&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFtcGxlLmNvbS9pc19yb290Ijp0cnVlfQ.dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Note: the <code>platform</code> parameter can be <code>"android"</code> or <code>"ios"</code>. For <code>ios</code>, a
<code>"keyId"</code> parameter is also required. For <code>android</code>, the <code>"issuer"</code> can be
<code>"playintegrity"</code> to use the Play Integrity API instead of the SafetyNet API.</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="post-authclientsclient-idflagship">POST /auth/clients/:client-id/flagship<a class="headerlink" href="#post-authclientsclient-idflagship" title="Permanent link">&para;</a></h3>
<p>This route can be used to send a 6-digits code to manually certify a client as
belonging to the flagship app.</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/clients/64ce5cb0-bd4c-11e6-880e-b3b7dfda89d3/flagship</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

code=123456&amp;token=123123123123123
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>


<h3 id="get-authauthorize">GET /auth/authorize<a class="headerlink" href="#get-authauthorize" title="Permanent link">&para;</a></h3>
<p>When an OAuth2 client wants to get access to the data of the cozy owner, it
starts the OAuth2 dance with this step. The user is shown what the client asks
and has an accept button if she is OK with that.</p>
<p>In case a limit has been set on the Cozy to the number of user-connected OAuth
clients, and this limit has been reached already, the user will be presented a
screen requesting to either remove some existing clients or, if enabled,
increase the limit (e.g. by subscribing to a plan with a greater limit). Once
the number of connected clients is brought back under the limit, the OAuth flow
will resume and the permissions screen will be displayed.</p>
<p>The parameters are:</p>
<ul>
<li><code>client_id</code>, that identify the client</li>
<li><code>redirect_uri</code>, it has to be exactly the same as the one used in
    registration</li>
<li><code>state</code>, it&rsquo;s a protection against CSRF on the client (a random string
    generated by the client, that it can check when the user will be redirected
    with the authorization code. It can be used as a key in local storage for
    storing a state in a SPA).</li>
<li><code>response_type</code>, only <code>code</code> is supported</li>
<li><code>scope</code>, a space separated list of the <a href="../permissions/">permissions</a> asked
    (like <code>io.cozy.files:GET</code> for read-only access to files).</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/authorize?client_id=oauth-client-1&amp;response_type=code&amp;scope=io.cozy.files%3AGET%20io.cozy.contacts&amp;state=Eh6ahshepei5Oojo&amp;redirect_uri=https%3A%2F%2Fclient.org%2F</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
</pre></div>


<p><strong>Note</strong> we warn the user that he is about to share his data with an application
which only the callback URI is guaranteed.</p>
<h4 id="pkce-extension">PKCE extension<a class="headerlink" href="#pkce-extension" title="Permanent link">&para;</a></h4>
<p>To improve security, the client can use the <a href="https://oauth.net/2/pkce/">PKCE for OAuth
2</a>. In that case, two additional parameters must be
send to <code>GET /auth/authorize</code>:</p>
<ul>
<li><code>code_challenge</code>: the client creates a <code>code_verifier</code>, and then derive the
  <code>code_challenge</code> from it.</li>
<li><code>code_challenge_method</code>: it must be <code>S256</code> (the only supported method).</li>
</ul>
<p>As a reminder, the relation between <code>code_verifier</code> and <code>code_challenge</code> is the
following:</p>
<div class="codehilite"><pre><span></span>code_challenge = BASE64URL-ENCODE(SHA256(code_verifier))
</pre></div>


<p>And, the <code>code_verifier</code> parameter must be sent to <code>POST /auth/access_token</code>
(see below).</p>
<h3 id="post-authauthorize">POST /auth/authorize<a class="headerlink" href="#post-authauthorize" title="Permanent link">&para;</a></h3>
<p>When the user accepts, her browser send a request to this endpoint:</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/authorize</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

state=Eh6ahshepei5Oojo&amp;client_id=oauth-client-1&amp;scope=io.cozy.files%3AGET%20io.cozy.contacts&amp;csrf_token=johw6Sho&amp;response_type=code&amp;redirect_uri=https%3A%2F%2Fclient.org%2F
</pre></div>


<p><strong>Note</strong>: this endpoint is protected against CSRF attacks.</p>
<p>The user is then redirected to the original client, with an access code in the
URL:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Moved Temporarily</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://client.org/?state=Eh6ahshepei5Oojo&amp;code=Aih7ohth#</span>
</pre></div>


<h3 id="get-authauthorizesharing-post-authauthorizesharing">GET /auth/authorize/sharing &amp; POST /auth/authorize/sharing<a class="headerlink" href="#get-authauthorizesharing-post-authauthorizesharing" title="Permanent link">&para;</a></h3>
<p>They are similar to <code>/auth/authorize</code>: they also make the user accept an OAuth
thing, but it is specialized for sharing. They are a few differences, like the
scope format (sharing rules, not permissions) and the redirection after the
POST (with <code>sharing=&lt;sharing-id&gt;</code> in the query string).</p>
<h3 id="get-authauthorizemove-post-authauthorizemove">GET /auth/authorize/move &amp; POST /auth/authorize/move<a class="headerlink" href="#get-authauthorizemove-post-authauthorizemove" title="Permanent link">&para;</a></h3>
<p>They are similar to <code>/auth/authorize</code>, but instead of a page that lists the
permissions, the user will be asked to type their password to confirm the
action (even if they are already logged-in). If the 2FA is activated, the code
will be asked too. This strong action seems adequate for authorizing to erase
the data in the Cozy before importing data from another Cozy.</p>
<h4 id="request-get">Request GET<a class="headerlink" href="#request-get" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/auth/authorize/move?state=8d560d60&amp;client_id=oauth-client-2&amp;redirect_uri=https://move.cozycloud.cc/callback/target</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">target.cozy.example</span>
</pre></div>


<h4 id="response-get">Response GET<a class="headerlink" href="#response-get" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/html</span>
</pre></div>


<h4 id="request-post">Request POST<a class="headerlink" href="#request-post" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/authorize/move</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">target.cozy.example</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

passphrase=hashed&amp;state=8d560d60&amp;client_id=oauth-client-2&amp;csrf_token=johw6Sho&amp;redirect_uri=https%3A%2F%2Fmove.cozycloud.cc%2Fcallback%2Ftarget
</pre></div>


<h4 id="response-post">Response POST<a class="headerlink" href="#response-post" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;redirect&quot;</span><span class="p">:</span> <span class="s2">&quot;https://move.cozycloud.cc/callback/target?code=543d7eb8149c&amp;used=123456&amp;quota=5000000&amp;state=8d560d60&amp;vault=true&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-authaccess_token">POST /auth/access_token<a class="headerlink" href="#post-authaccess_token" title="Permanent link">&para;</a></h3>
<p>Now, the client can check that the state is correct, and if it is the case, ask
for an <code>access_token</code>. It can use this route with the <code>code</code> given above.</p>
<p>This endpoint is also used to refresh the access token, by sending the
<code>refresh_token</code> instead of the <code>code</code>.</p>
<p>The parameters are:</p>
<ul>
<li><code>grant_type</code>, with <code>authorization_code</code> or <code>refresh_token</code> as value</li>
<li><code>code</code> or <code>refresh_token</code>, depending on which grant type is used</li>
<li><code>client_id</code></li>
<li><code>client_secret</code></li>
</ul>
<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/access_token</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>

grant_type=authorization_code&amp;code=Aih7ohth&amp;client_id=oauth-client-1&amp;client_secret=Oung7oi5
</pre></div>


<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;ooch1Yei&quot;</span><span class="p">,</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;ui0Ohch8&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;io.cozy.files:GET io.cozy.contacts&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="post-authsession_code">POST /auth/session_code<a class="headerlink" href="#post-authsession_code" title="Permanent link">&para;</a></h3>
<p>This endpoint can be used by the flagship application in order to create a
session code: this code can be added to the URL of a cozy application (in the
query string, as <code>session_code</code>) to create a session. The flagship can create
this code with its access token, and then use it in a webview to avoid the
reauthentication of the user. It can also create the code with the hashed
passphrase (and 2FA if needed) to create a session for the authorize page.</p>
<p>Note that the difference between a <code>session_code</code> and a <code>magic_code</code> (code in a
magic link sent by email) is the behavior when two-factor authentication is
enabled. The <code>session_code</code> will open the session while the <code>magic_code</code> will
require the password for that.</p>
<h4 id="request-access-token-variant">Request (access token variant)<a class="headerlink" href="#request-access-token-variant" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/session_code</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJpc3Mi...</span>
</pre></div>


<h4 id="request-passphrase-variant">Request (passphrase variant)<a class="headerlink" href="#request-passphrase-variant" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/session_code</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;passphrase&quot;</span><span class="p">:</span> <span class="s2">&quot;hashed&quot;</span><span class="p">,</span>
  <span class="nt">&quot;two_factor_token&quot;</span><span class="p">:</span> <span class="s2">&quot;123123123123&quot;</span><span class="p">,</span>
  <span class="nt">&quot;two_factor_passcode&quot;</span><span class="p">:</span> <span class="s2">&quot;678678&quot;</span>
<span class="p">}</span>
</pre></div>


<h4 id="response_2">Response<a class="headerlink" href="#response_2" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;session_code&quot;</span><span class="p">:</span> <span class="s2">&quot;HzEFM3JREpIB6532fQc1FP2t4YJKt3gI&quot;</span>
<span class="p">}</span>
</pre></div>


<p>The flagship will then be able to open a webview for
<code>https://cozy-home.example.org/?session_code=HzEFM3JREpIB6532fQc1FP2t4YJKt3gI</code>.</p>
<h4 id="response-2fa-needed">Response (2FA needed)<a class="headerlink" href="#response-2fa-needed" title="Permanent link">&para;</a></h4>
<p>In case of error where 2FA is needed, the response will be:</p>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">403</span> <span class="ne">Forbidden</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;two factor needed&quot;</span><span class="p">,</span>
  <span class="nt">&quot;two_factor_token&quot;</span><span class="p">:</span> <span class="s2">&quot;123123123123&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">&para;</a></h3>
<blockquote>
<p>What format is used for tokens?</p>
</blockquote>
<p>The access tokens are formatted as <a href="https://jwt.io/">JSON Web Tokens (JWT)</a>,
like this:</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Fullname</th>
<th>What it identifies</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aud</code></td>
<td>Audience</td>
<td>Identify the recipient where the token can be used (like <code>access</code>)</td>
</tr>
<tr>
<td><code>iss</code></td>
<td>Issuer</td>
<td>Identify the Cozy instance (its domain in fact)</td>
</tr>
<tr>
<td><code>iat</code></td>
<td>Issued At</td>
<td>Identify when the token was issued (Unix timestamp)</td>
</tr>
<tr>
<td><code>sub</code></td>
<td>Subject</td>
<td>Identify the client that can use the token</td>
</tr>
<tr>
<td><code>scope</code></td>
<td>Scope</td>
<td>Identify the scope of actions that the client can accomplish</td>
</tr>
</tbody>
</table>
<p>The <code>scope</code> is used for <a href="../permissions/">permissions</a>.</p>
<p>Other tokens can be JWT with a similar formalism, or be a simple random value
(when we want to have a clear revocation process).</p>
<blockquote>
<p>What happens when the user has lost her passphrase?</p>
</blockquote>
<p>She can reset it from the command-line, like this:</p>
<div class="codehilite"><pre><span></span>$ cozy-stack instances reset-passphrase cozy.example.org
ek0Jah1R
</pre></div>


<p>A new password is generated and print in the console.</p>
<blockquote>
<p>Is two-factor authentication (2FA) possible?</p>
</blockquote>
<p>Yes, it&rsquo;s possible. Via the cozy-settings application, the two-factor
authentication can be activated.</p>
<p>Here is how it works in more details:</p>
<p>On each connection, when the 2FA is activated, the user is asked for its
passphrase first. When entering correct passphrase, the user is then asked for:</p>
<ul>
<li>a TOTP (Timebased One-Time password, RFC 6238) derived from a secret
    associated with the instance.</li>
<li>a short term timestamped MAC with the same validity time-range and also
    derived from the same secret.</li>
</ul>
<p>The TOTP is valid for a time range of about 5 minutes. When sending a correct
and still-valid pair <code>(passcode, token)</code>, the user is granted with
authentication cookie.</p>
<p>The passcode can be sent to the instance&rsquo;s owner via email — more transport
shall be added later.</p>
<h3 id="post-authtokenskonnectorsslug">POST /auth/tokens/konnectors/:slug<a class="headerlink" href="#post-authtokenskonnectorsslug" title="Permanent link">&para;</a></h3>
<p>This endpoint can be used by the flagship application in order to create a
token for the konnector with the given slug. This token can then be used by the
client-side konnector to make requests to cozy-stack.
The flagship app will need to use its own access token to request the konnector 
token.</p>
<h4 id="request_2">Request<a class="headerlink" href="#request_2" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/tokens/konnectors/impots</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJpc3Mi...</span>
</pre></div>


<h4 id="response_3">Response<a class="headerlink" href="#response_3" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="s2">&quot;OWY0MjNjMGEtOTNmNi0xMWVjLWIyZGItN2I5YjgwNmRjYzBiCg&quot;</span>
</pre></div>


<h3 id="post-authshare-by-linkpassword">POST /auth/share-by-link/password<a class="headerlink" href="#post-authshare-by-linkpassword" title="Permanent link">&para;</a></h3>
<p>This route is used when a share by link is protected by password. The password
can be sent to this route to create a cookie that will allow to use the
sharecode and access the shared page.</p>
<h4 id="request_3">Request<a class="headerlink" href="#request_3" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nf">POST</span> <span class="nn">/auth/clients/share-by-link/password</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

password=HelloWorld!&amp;perm_id=123456789
</pre></div>


<h4 id="response_4">Response<a class="headerlink" href="#response_4" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">pass123...</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="faq_1">FAQ<a class="headerlink" href="#faq_1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>What format is used for tokens?</p>
</blockquote>
<p>The access tokens are formatted as <a href="https://jwt.io/">JSON Web Tokens (JWT)</a>,
like this:</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>Fullname</th>
<th>What it identifies</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aud</code></td>
<td>Audience</td>
<td>Identify the recipient where the token can be used (i.e. <code>konn</code>)</td>
</tr>
<tr>
<td><code>iss</code></td>
<td>Issuer</td>
<td>Identify the Cozy instance (its domain in fact)</td>
</tr>
<tr>
<td><code>iat</code></td>
<td>Issued At</td>
<td>Identify when the token was issued (Unix timestamp)</td>
</tr>
<tr>
<td><code>sub</code></td>
<td>Subject</td>
<td>Identify the client that can use the token (i.e. the konnector slug)</td>
</tr>
<tr>
<td><code>scope</code></td>
<td>Scope</td>
<td>Konnector tokens don&rsquo;t have any scope</td>
</tr>
</tbody>
</table>
<h2 id="client-side-apps">Client-side apps<a class="headerlink" href="#client-side-apps" title="Permanent link">&para;</a></h2>
<p><strong>Important</strong>: OAuth2 is not used here! The steps looks similar (like obtaining
a token), but when going in the details, it doesn&rsquo;t match.</p>
<h3 id="how-to-register-the-application">How to register the application?<a class="headerlink" href="#how-to-register-the-application" title="Permanent link">&para;</a></h3>
<p>The application is registered at install. See <a href="../apps/">app management</a> for
details.</p>
<h3 id="how-to-get-a-token">How to get a token?<a class="headerlink" href="#how-to-get-a-token" title="Permanent link">&para;</a></h3>
<p>When a user access an application, she first loads the HTML page. Inside this
page, a token specific to this app is injected (only for private routes), via a
templating method.</p>
<p>We have prefered our custom solution to the implicit grant type of OAuth2 for 2
reasons:</p>
<ol>
<li>
<p>It has a better User Experience. The implicit grant type works with 2
   redirections (the application to the stack, and then the stack to the
   application), and the first one needs JS to detect if the token is present or
   not in the fragment hash. It has a strong impact on the time to load the
   application.</p>
</li>
<li>
<p>The implicit grant type of OAuth2 has a severe drawback on security: the
   token appears in the URL and is shown by the browser. It can also be leaked
   with the HTTP <code>Referer</code> header.</p>
</li>
</ol>
<p>The token will be given only for the authenticated user. For nested subdomains
(like <code>calendar.joe.example.net</code>), the session cookie from the stack is enough
(it is for <code>.joe.example.net</code>).</p>
<p>But for flat subdomains (like <code>joe-calendar.example.net</code>), it&rsquo;s more
complicated. On the first try of the user, she will be redirected to the stack.
As she is already logged-in, she will be redirected to the app with a session
code (else she can login). This session code can be exchanged to a session
cookie. A redirection will still happen to remove the code from the URL (it
helps to avoid the code being saved in the browser history). For security
reasons, the session code have the following properties:</p>
<ul>
<li>It can only be used once.</li>
<li>It is tied to an application (<code>calendar</code> in our example).</li>
<li>It has a very short time span of validity (1 minute).</li>
</ul>
<h3 id="how-to-use-a-token">How to use a token?<a class="headerlink" href="#how-to-use-a-token" title="Permanent link">&para;</a></h3>
<p>The token can be sent to the cozy-stack as a <code>Bearer</code> token in the
<code>Authorization</code> header, like this:</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/data/io.cozy.events/6494e0ac-dfcb-11e5-88c1-472e84a9cbee</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer application-token</span>
</pre></div>


<p>If the user is authenticated, her cookies will be sent automatically. The
cookies are needed for a token to be valid.</p>
<h3 id="how-to-refresh-a-token">How to refresh a token?<a class="headerlink" href="#how-to-refresh-a-token" title="Permanent link">&para;</a></h3>
<p>The token is valid only for 24 hours. If the application is opened for more than
that, it will need to get a new token. But most applications won&rsquo;t be kept open
for so long and it&rsquo;s okay if they don&rsquo;t try to refresh tokens. At worst, the
user just had to reload its page and it will work again.</p>
<p>The app can know it&rsquo;s time to get a new token when the stack starts sending 401
Unauthorized responses. In that case, it can fetches the same html page that it
was loaded initially, parses it and extracts the new token.</p>
<h2 id="third-party-websites">Third-party websites<a class="headerlink" href="#third-party-websites" title="Permanent link">&para;</a></h2>
<h3 id="how-to-register-the-application_1">How to register the application?<a class="headerlink" href="#how-to-register-the-application_1" title="Permanent link">&para;</a></h3>
<p>If a third-party websites would like to access a cozy, it had to register first.
For example, a big company can have data about a user and may want to offer her
a way to get her data back in her cozy. When the user is connected on the
website of this company, she can give her cozy address. The website will then
register on this cozy, using the OAuth2 Dynamic Client Registration Protocol, as
explained <a href="#post-authregister">above</a>.</p>
<h3 id="how-to-get-a-token_1">How to get a token?<a class="headerlink" href="#how-to-get-a-token_1" title="Permanent link">&para;</a></h3>
<p>To get an access token, it&rsquo;s enough to follow the authorization code flow of
OAuth2:</p>
<ul>
<li>sending the user to the cozy, on the authorize page</li>
<li>if the user approves, she is then redirected back to the client</li>
<li>the client gets the access code and can exchange it to an access token.</li>
</ul>
<h3 id="how-to-use-a-token_1">How to use a token?<a class="headerlink" href="#how-to-use-a-token_1" title="Permanent link">&para;</a></h3>
<p>The access token can be sent as a bearer token, in the Authorization header of
HTTP:</p>
<div class="codehilite"><pre><span></span><span class="nf">GET</span> <span class="nn">/data/io.cozy.contacts/6494e0ac-dfcb-11e5-88c1-472e84a9cbee</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">cozy.example.org</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span>
</pre></div>


<h3 id="how-to-refresh-a-token_1">How to refresh a token?<a class="headerlink" href="#how-to-refresh-a-token_1" title="Permanent link">&para;</a></h3>
<p>The access token will be valid only for 24 hours. After that, a new access token
must be asked. To do that, just follow the refresh token flow, as explained
<a href="#post-authaccess_token">above</a>.</p>
<h2 id="devices-and-browser-extensions">Devices and browser extensions<a class="headerlink" href="#devices-and-browser-extensions" title="Permanent link">&para;</a></h2>
<p>For devices and browser extensions, it is nearly the same than for third-party
websites. The main difficulty is the redirect_uri. In OAuth2, the access code is
given to the client by redirecting the user to an URL controlled by the client.
But devices and browser extensions don&rsquo;t have an obvious URL for that.</p>
<p>The IETF has published an RFC called
<a href="https://tools.ietf.org/html/draft-ietf-oauth-native-apps-05">OAuth 2.0 for Native Apps</a>.</p>
<h3 id="native-apps-on-desktop">Native apps on desktop<a class="headerlink" href="#native-apps-on-desktop" title="Permanent link">&para;</a></h3>
<p>A desktop native application can start an embedded webserver on localhost. The
redirect_uri will be something like <code>http://127.0.0.1:19856/callback</code>.</p>
<h3 id="native-apps-on-mobile">Native apps on mobile<a class="headerlink" href="#native-apps-on-mobile" title="Permanent link">&para;</a></h3>
<p>On mobile, the native apps can often register a custom URI scheme, like
<code>com.example.oauthclient:/</code>. Just be sure that no other app has registered
itself with the same URI.</p>
<h3 id="chrome-extensions">Chrome extensions<a class="headerlink" href="#chrome-extensions" title="Permanent link">&para;</a></h3>
<p>Chrome extensions can use URL like
<code>https://&lt;extension-id&gt;.chromiumapp.org/&lt;anything-here&gt;</code> for their usage. See
https://developer.chrome.com/apps/app_identity#non for more details. It has also
a method to simplify the creation of such an URL:
<a href="https://developer.chrome.com/apps/identity#method-getRedirectURL"><code>chrome.identity.getRedirectURL</code></a>.</p>
<h3 id="firefox-extensions">Firefox extensions<a class="headerlink" href="#firefox-extensions" title="Permanent link">&para;</a></h3>
<p>It is possible to use an <em>out of band</em> URN: <code>urn:ietf:wg:oauth:2.0:oob:auto</code>.
The token is then extracted from the title of the page. See
<a href="https://github.com/AdrianArroyoCalle/firefox-addons/blob/master/addon-google-oauth2/addon-google-oauth2.js">this addon for google oauth2</a>
as an example.</p>
<h2 id="security-considerations">Security considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<p>The master password, the password known by the user, is derived on the clients
to give two keys. The first key is used to login on the stack, the second key
is used to do client-side encryption. The derivation for the login password is
currently done with the PBKDF2 algorithm (with SHA256), but we have anticipated
the possibility of changing to another algorithm if desirable.</p>
<p>The derived password is stored on the server in a secure fashion, with a
password hashing function. The hashing function and its parameter are stored
with the hash, in order to make it possible to change the algorithm and/or the
parameters later if we had any suspicion that it became too weak. The initial
algorithm is <a href="https://pkg.go.dev/golang.org/x/crypto/scrypt">scrypt</a>.</p>
<p>The access code is valid only once, and will expire after 5 minutes</p>
<p>Dynamically registered applications won&rsquo;t have access to all possible scopes.
For example, an application that has been dynamically registered can&rsquo;t ask the
cozy owner to give it the right to install other applications. This limitation
should improve security, as avoiding too powerful scopes to be used with unknown
applications.</p>
<p>The cozy stack will apply rate limiting to avoid brute-force attacks.</p>
<p>The cozy stack offers
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">CORS</a>
for most of its services. But it&rsquo;s disabled for <code>/auth</code> (it doesn&rsquo;t make sense
here) and for the client-side applications (to avoid leaking their tokens).</p>
<p>The client should really use HTTPS for its <code>redirect_uri</code> parameter, but it&rsquo;s
allowed to use HTTP for localhost, as in the native desktop app example.</p>
<p>OAuth2 says that the <code>state</code> parameter is optional in the authorization code
flow. But it is mandatory to use it with Cozy.</p>
<p>For more on this subject, here is a list of links:</p>
<ul>
<li>https://www.owasp.org/index.php/Authentication_Cheat_Sheet</li>
<li>https://tools.ietf.org/html/rfc6749#page-53</li>
<li>https://tools.ietf.org/html/rfc6819</li>
<li>https://tools.ietf.org/html/draft-ietf-oauth-closing-redirectors-00</li>
<li>http://www.oauthsecurity.com/</li>
</ul>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>Security is hard. If you want to share some concerns with us, do not hesitate to
send us an email to security AT cozycloud.cc.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ai/" title="/ai - AI" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                /ai - AI
              </span>
            </div>
          </a>
        
        
          <a href="../delegated-auth/" title=" /oidc - Delegated authentication" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                 /oidc - Delegated authentication
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href="/en/privacy">privacy</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.2.3",url:{base:"../.."}})</script>
      
        <script src="../../extra.js"></script>
      
    
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="https://matomo.cozycloud.cc/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '25']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->

  </body>
</html>